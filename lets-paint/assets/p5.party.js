"use strict";(()=>{var sc=Object.create;var dr=Object.defineProperty;var cc=Object.getOwnPropertyDescriptor;var ac=Object.getOwnPropertyNames,Sn=Object.getOwnPropertySymbols,uc=Object.getPrototypeOf,On=Object.prototype.hasOwnProperty,lc=Object.prototype.propertyIsEnumerable;var D=Math.pow,_n=(i,t,e)=>t in i?dr(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,He=(i,t)=>{for(var e in t||(t={}))On.call(t,e)&&_n(i,e,t[e]);if(Sn)for(var e of Sn(t))lc.call(t,e)&&_n(i,e,t[e]);return i};var hc=(i,t)=>()=>(i&&(t=i(i=0)),t);var y=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var fc=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ac(t))!On.call(i,n)&&n!==e&&dr(i,n,{get:()=>t[n],enumerable:!(r=cc(t,n))||r.enumerable});return i};var Er=(i,t,e)=>(e=i!=null?sc(uc(i)):{},fc(t||!i||!i.__esModule?dr(e,"default",{value:i,enumerable:!0}):e,i));var pr=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var E=(i,t,e)=>(pr(i,t,"read from private field"),e?e.call(i):t.get(i)),P=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},U=(i,t,e,r)=>(pr(i,t,"write to private field"),r?r.call(i,e):t.set(i,e),e);var It=(i,t,e)=>(pr(i,t,"access private method"),e);var st=(i,t,e)=>new Promise((r,n)=>{var o=a=>{try{c(e.next(a))}catch(l){n(l)}},s=a=>{try{c(e.throw(a))}catch(l){n(l)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);c((e=e.apply(i,t)).next())});var In=y(li=>{"use strict";u();li.byteLength=Ec;li.toByteArray=Rc;li.fromByteArray=_c;var Ct=[],ut=[],dc=typeof Uint8Array!="undefined"?Uint8Array:Array,Rr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(oe=0,Nn=Rr.length;oe<Nn;++oe)Ct[oe]=Rr[oe],ut[Rr.charCodeAt(oe)]=oe;var oe,Nn;ut["-".charCodeAt(0)]=62;ut["_".charCodeAt(0)]=63;function Tn(i){var t=i.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=i.indexOf("=");e===-1&&(e=t);var r=e===t?0:4-e%4;return[e,r]}function Ec(i){var t=Tn(i),e=t[0],r=t[1];return(e+r)*3/4-r}function pc(i,t,e){return(t+e)*3/4-e}function Rc(i){var t,e=Tn(i),r=e[0],n=e[1],o=new dc(pc(i,r,n)),s=0,c=n>0?r-4:r,a;for(a=0;a<c;a+=4)t=ut[i.charCodeAt(a)]<<18|ut[i.charCodeAt(a+1)]<<12|ut[i.charCodeAt(a+2)]<<6|ut[i.charCodeAt(a+3)],o[s++]=t>>16&255,o[s++]=t>>8&255,o[s++]=t&255;return n===2&&(t=ut[i.charCodeAt(a)]<<2|ut[i.charCodeAt(a+1)]>>4,o[s++]=t&255),n===1&&(t=ut[i.charCodeAt(a)]<<10|ut[i.charCodeAt(a+1)]<<4|ut[i.charCodeAt(a+2)]>>2,o[s++]=t>>8&255,o[s++]=t&255),o}function yc(i){return Ct[i>>18&63]+Ct[i>>12&63]+Ct[i>>6&63]+Ct[i&63]}function Sc(i,t,e){for(var r,n=[],o=t;o<e;o+=3)r=(i[o]<<16&16711680)+(i[o+1]<<8&65280)+(i[o+2]&255),n.push(yc(r));return n.join("")}function _c(i){for(var t,e=i.length,r=e%3,n=[],o=16383,s=0,c=e-r;s<c;s+=o)n.push(Sc(i,s,s+o>c?c:s+o));return r===1?(t=i[e-1],n.push(Ct[t>>2]+Ct[t<<4&63]+"==")):r===2&&(t=(i[e-2]<<8)+i[e-1],n.push(Ct[t>>10]+Ct[t>>4&63]+Ct[t<<2&63]+"=")),n.join("")}});var Cn=y(yr=>{u();yr.read=function(i,t,e,r,n){var o,s,c=n*8-r-1,a=(1<<c)-1,l=a>>1,f=-7,p=e?n-1:0,T=e?-1:1,I=i[t+p];for(p+=T,o=I&(1<<-f)-1,I>>=-f,f+=c;f>0;o=o*256+i[t+p],p+=T,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=r;f>0;s=s*256+i[t+p],p+=T,f-=8);if(o===0)o=1-l;else{if(o===a)return s?NaN:(I?-1:1)*(1/0);s=s+Math.pow(2,r),o=o-l}return(I?-1:1)*s*Math.pow(2,o-r)};yr.write=function(i,t,e,r,n,o){var s,c,a,l=o*8-n-1,f=(1<<l)-1,p=f>>1,T=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=r?0:o-1,q=r?1:-1,B=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(c=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-s))<1&&(s--,a*=2),s+p>=1?t+=T/a:t+=T*Math.pow(2,1-p),t*a>=2&&(s++,a/=2),s+p>=f?(c=0,s=f):s+p>=1?(c=(t*a-1)*Math.pow(2,n),s=s+p):(c=t*Math.pow(2,p-1)*Math.pow(2,n),s=0));n>=8;i[e+I]=c&255,I+=q,c/=256,n-=8);for(s=s<<n|c,l+=n;l>0;i[e+I]=s&255,I+=q,s/=256,l-=8);i[e+I-q]|=B*128}});var Fn=y(Se=>{"use strict";u();var Sr=In(),Re=Cn(),vn=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Se.Buffer=h;Se.SlowBuffer=vc;Se.INSPECT_MAX_BYTES=50;var hi=2147483647;Se.kMaxLength=hi;h.TYPED_ARRAY_SUPPORT=Oc();!h.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Oc(){try{let i=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(i,t),i.foo()===42}catch(i){return!1}}Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(!!h.isBuffer(this))return this.buffer}});Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(!!h.isBuffer(this))return this.byteOffset}});function Mt(i){if(i>hi)throw new RangeError('The value "'+i+'" is invalid for option "size"');let t=new Uint8Array(i);return Object.setPrototypeOf(t,h.prototype),t}function h(i,t,e){if(typeof i=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Tr(i)}return An(i,t,e)}h.poolSize=8192;function An(i,t,e){if(typeof i=="string")return Tc(i,t);if(ArrayBuffer.isView(i))return Ic(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(vt(i,ArrayBuffer)||i&&vt(i.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(vt(i,SharedArrayBuffer)||i&&vt(i.buffer,SharedArrayBuffer)))return Or(i,t,e);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let r=i.valueOf&&i.valueOf();if(r!=null&&r!==i)return h.from(r,t,e);let n=Cc(i);if(n)return n;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return h.from(i[Symbol.toPrimitive]("string"),t,e);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}h.from=function(i,t,e){return An(i,t,e)};Object.setPrototypeOf(h.prototype,Uint8Array.prototype);Object.setPrototypeOf(h,Uint8Array);function Dn(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function Nc(i,t,e){return Dn(i),i<=0?Mt(i):t!==void 0?typeof e=="string"?Mt(i).fill(t,e):Mt(i).fill(t):Mt(i)}h.alloc=function(i,t,e){return Nc(i,t,e)};function Tr(i){return Dn(i),Mt(i<0?0:Ir(i)|0)}h.allocUnsafe=function(i){return Tr(i)};h.allocUnsafeSlow=function(i){return Tr(i)};function Tc(i,t){if((typeof t!="string"||t==="")&&(t="utf8"),!h.isEncoding(t))throw new TypeError("Unknown encoding: "+t);let e=wn(i,t)|0,r=Mt(e),n=r.write(i,t);return n!==e&&(r=r.slice(0,n)),r}function _r(i){let t=i.length<0?0:Ir(i.length)|0,e=Mt(t);for(let r=0;r<t;r+=1)e[r]=i[r]&255;return e}function Ic(i){if(vt(i,Uint8Array)){let t=new Uint8Array(i);return Or(t.buffer,t.byteOffset,t.byteLength)}return _r(i)}function Or(i,t,e){if(t<0||i.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<t+(e||0))throw new RangeError('"length" is outside of buffer bounds');let r;return t===void 0&&e===void 0?r=new Uint8Array(i):e===void 0?r=new Uint8Array(i,t):r=new Uint8Array(i,t,e),Object.setPrototypeOf(r,h.prototype),r}function Cc(i){if(h.isBuffer(i)){let t=Ir(i.length)|0,e=Mt(t);return e.length===0||i.copy(e,0,0,t),e}if(i.length!==void 0)return typeof i.length!="number"||vr(i.length)?Mt(0):_r(i);if(i.type==="Buffer"&&Array.isArray(i.data))return _r(i.data)}function Ir(i){if(i>=hi)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+hi.toString(16)+" bytes");return i|0}function vc(i){return+i!=i&&(i=0),h.alloc(+i)}h.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==h.prototype};h.compare=function(t,e){if(vt(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),vt(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(t)||!h.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,n=e.length;for(let o=0,s=Math.min(r,n);o<s;++o)if(t[o]!==e[o]){r=t[o],n=e[o];break}return r<n?-1:n<r?1:0};h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};h.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return h.alloc(0);let r;if(e===void 0)for(e=0,r=0;r<t.length;++r)e+=t[r].length;let n=h.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){let s=t[r];if(vt(s,Uint8Array))o+s.length>n.length?(h.isBuffer(s)||(s=h.from(s)),s.copy(n,o)):Uint8Array.prototype.set.call(n,s,o);else if(h.isBuffer(s))s.copy(n,o);else throw new TypeError('"list" argument must be an Array of Buffers');o+=s.length}return n};function wn(i,t){if(h.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||vt(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);let e=i.length,r=arguments.length>2&&arguments[2]===!0;if(!r&&e===0)return 0;let n=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":return Nr(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return e*2;case"hex":return e>>>1;case"base64":return Vn(i).length;default:if(n)return r?-1:Nr(i).length;t=(""+t).toLowerCase(),n=!0}}h.byteLength=wn;function bc(i,t,e){let r=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((e===void 0||e>this.length)&&(e=this.length),e<=0)||(e>>>=0,t>>>=0,e<=t))return"";for(i||(i="utf8");;)switch(i){case"hex":return Bc(this,t,e);case"utf8":case"utf-8":return Un(this,t,e);case"ascii":return Lc(this,t,e);case"latin1":case"binary":return Mc(this,t,e);case"base64":return Pc(this,t,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return kc(this,t,e);default:if(r)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),r=!0}}h.prototype._isBuffer=!0;function se(i,t,e){let r=i[t];i[t]=i[e],i[e]=r}h.prototype.swap16=function(){let t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)se(this,e,e+1);return this};h.prototype.swap32=function(){let t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)se(this,e,e+3),se(this,e+1,e+2);return this};h.prototype.swap64=function(){let t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)se(this,e,e+7),se(this,e+1,e+6),se(this,e+2,e+5),se(this,e+3,e+4);return this};h.prototype.toString=function(){let t=this.length;return t===0?"":arguments.length===0?Un(this,0,t):bc.apply(this,arguments)};h.prototype.toLocaleString=h.prototype.toString;h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:h.compare(this,t)===0};h.prototype.inspect=function(){let t="",e=Se.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"};vn&&(h.prototype[vn]=h.prototype.inspect);h.prototype.compare=function(t,e,r,n,o){if(vt(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(e===void 0&&(e=0),r===void 0&&(r=t?t.length:0),n===void 0&&(n=0),o===void 0&&(o=this.length),e<0||r>t.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&e>=r)return 0;if(n>=o)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,o>>>=0,this===t)return 0;let s=o-n,c=r-e,a=Math.min(s,c),l=this.slice(n,o),f=t.slice(e,r);for(let p=0;p<a;++p)if(l[p]!==f[p]){s=l[p],c=f[p];break}return s<c?-1:c<s?1:0};function Pn(i,t,e,r,n){if(i.length===0)return-1;if(typeof e=="string"?(r=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,vr(e)&&(e=n?0:i.length-1),e<0&&(e=i.length+e),e>=i.length){if(n)return-1;e=i.length-1}else if(e<0)if(n)e=0;else return-1;if(typeof t=="string"&&(t=h.from(t,r)),h.isBuffer(t))return t.length===0?-1:bn(i,t,e,r,n);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?n?Uint8Array.prototype.indexOf.call(i,t,e):Uint8Array.prototype.lastIndexOf.call(i,t,e):bn(i,[t],e,r,n);throw new TypeError("val must be string, number or Buffer")}function bn(i,t,e,r,n){let o=1,s=i.length,c=t.length;if(r!==void 0&&(r=String(r).toLowerCase(),r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le")){if(i.length<2||t.length<2)return-1;o=2,s/=2,c/=2,e/=2}function a(f,p){return o===1?f[p]:f.readUInt16BE(p*o)}let l;if(n){let f=-1;for(l=e;l<s;l++)if(a(i,l)===a(t,f===-1?0:l-f)){if(f===-1&&(f=l),l-f+1===c)return f*o}else f!==-1&&(l-=l-f),f=-1}else for(e+c>s&&(e=s-c),l=e;l>=0;l--){let f=!0;for(let p=0;p<c;p++)if(a(i,l+p)!==a(t,p)){f=!1;break}if(f)return l}return-1}h.prototype.includes=function(t,e,r){return this.indexOf(t,e,r)!==-1};h.prototype.indexOf=function(t,e,r){return Pn(this,t,e,r,!0)};h.prototype.lastIndexOf=function(t,e,r){return Pn(this,t,e,r,!1)};function mc(i,t,e,r){e=Number(e)||0;let n=i.length-e;r?(r=Number(r),r>n&&(r=n)):r=n;let o=t.length;r>o/2&&(r=o/2);let s;for(s=0;s<r;++s){let c=parseInt(t.substr(s*2,2),16);if(vr(c))return s;i[e+s]=c}return s}function gc(i,t,e,r){return fi(Nr(t,i.length-e),i,e,r)}function Ac(i,t,e,r){return fi(Fc(t),i,e,r)}function Dc(i,t,e,r){return fi(Vn(t),i,e,r)}function wc(i,t,e,r){return fi(Hc(t,i.length-e),i,e,r)}h.prototype.write=function(t,e,r,n){if(e===void 0)n="utf8",r=this.length,e=0;else if(r===void 0&&typeof e=="string")n=e,r=this.length,e=0;else if(isFinite(e))e=e>>>0,isFinite(r)?(r=r>>>0,n===void 0&&(n="utf8")):(n=r,r=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let o=this.length-e;if((r===void 0||r>o)&&(r=o),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return mc(this,t,e,r);case"utf8":case"utf-8":return gc(this,t,e,r);case"ascii":case"latin1":case"binary":return Ac(this,t,e,r);case"base64":return Dc(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wc(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}};h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Pc(i,t,e){return t===0&&e===i.length?Sr.fromByteArray(i):Sr.fromByteArray(i.slice(t,e))}function Un(i,t,e){e=Math.min(i.length,e);let r=[],n=t;for(;n<e;){let o=i[n],s=null,c=o>239?4:o>223?3:o>191?2:1;if(n+c<=e){let a,l,f,p;switch(c){case 1:o<128&&(s=o);break;case 2:a=i[n+1],(a&192)===128&&(p=(o&31)<<6|a&63,p>127&&(s=p));break;case 3:a=i[n+1],l=i[n+2],(a&192)===128&&(l&192)===128&&(p=(o&15)<<12|(a&63)<<6|l&63,p>2047&&(p<55296||p>57343)&&(s=p));break;case 4:a=i[n+1],l=i[n+2],f=i[n+3],(a&192)===128&&(l&192)===128&&(f&192)===128&&(p=(o&15)<<18|(a&63)<<12|(l&63)<<6|f&63,p>65535&&p<1114112&&(s=p))}}s===null?(s=65533,c=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|s&1023),r.push(s),n+=c}return Uc(r)}var mn=4096;function Uc(i){let t=i.length;if(t<=mn)return String.fromCharCode.apply(String,i);let e="",r=0;for(;r<t;)e+=String.fromCharCode.apply(String,i.slice(r,r+=mn));return e}function Lc(i,t,e){let r="";e=Math.min(i.length,e);for(let n=t;n<e;++n)r+=String.fromCharCode(i[n]&127);return r}function Mc(i,t,e){let r="";e=Math.min(i.length,e);for(let n=t;n<e;++n)r+=String.fromCharCode(i[n]);return r}function Bc(i,t,e){let r=i.length;(!t||t<0)&&(t=0),(!e||e<0||e>r)&&(e=r);let n="";for(let o=t;o<e;++o)n+=Gc[i[o]];return n}function kc(i,t,e){let r=i.slice(t,e),n="";for(let o=0;o<r.length-1;o+=2)n+=String.fromCharCode(r[o]+r[o+1]*256);return n}h.prototype.slice=function(t,e){let r=this.length;t=~~t,e=e===void 0?r:~~e,t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),e<t&&(e=t);let n=this.subarray(t,e);return Object.setPrototypeOf(n,h.prototype),n};function W(i,t,e){if(i%1!==0||i<0)throw new RangeError("offset is not uint");if(i+t>e)throw new RangeError("Trying to access beyond buffer length")}h.prototype.readUintLE=h.prototype.readUIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||W(t,e,this.length);let n=this[t],o=1,s=0;for(;++s<e&&(o*=256);)n+=this[t+s]*o;return n};h.prototype.readUintBE=h.prototype.readUIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||W(t,e,this.length);let n=this[t+--e],o=1;for(;e>0&&(o*=256);)n+=this[t+--e]*o;return n};h.prototype.readUint8=h.prototype.readUInt8=function(t,e){return t=t>>>0,e||W(t,1,this.length),this[t]};h.prototype.readUint16LE=h.prototype.readUInt16LE=function(t,e){return t=t>>>0,e||W(t,2,this.length),this[t]|this[t+1]<<8};h.prototype.readUint16BE=h.prototype.readUInt16BE=function(t,e){return t=t>>>0,e||W(t,2,this.length),this[t]<<8|this[t+1]};h.prototype.readUint32LE=h.prototype.readUInt32LE=function(t,e){return t=t>>>0,e||W(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};h.prototype.readUint32BE=h.prototype.readUInt32BE=function(t,e){return t=t>>>0,e||W(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};h.prototype.readBigUInt64LE=xt(function(t){t=t>>>0,ye(t,"offset");let e=this[t],r=this[t+7];(e===void 0||r===void 0)&&Ge(t,this.length-8);let n=e+this[++t]*D(2,8)+this[++t]*D(2,16)+this[++t]*D(2,24),o=this[++t]+this[++t]*D(2,8)+this[++t]*D(2,16)+r*D(2,24);return BigInt(n)+(BigInt(o)<<BigInt(32))});h.prototype.readBigUInt64BE=xt(function(t){t=t>>>0,ye(t,"offset");let e=this[t],r=this[t+7];(e===void 0||r===void 0)&&Ge(t,this.length-8);let n=e*D(2,24)+this[++t]*D(2,16)+this[++t]*D(2,8)+this[++t],o=this[++t]*D(2,24)+this[++t]*D(2,16)+this[++t]*D(2,8)+r;return(BigInt(n)<<BigInt(32))+BigInt(o)});h.prototype.readIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||W(t,e,this.length);let n=this[t],o=1,s=0;for(;++s<e&&(o*=256);)n+=this[t+s]*o;return o*=128,n>=o&&(n-=Math.pow(2,8*e)),n};h.prototype.readIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||W(t,e,this.length);let n=e,o=1,s=this[t+--n];for(;n>0&&(o*=256);)s+=this[t+--n]*o;return o*=128,s>=o&&(s-=Math.pow(2,8*e)),s};h.prototype.readInt8=function(t,e){return t=t>>>0,e||W(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]};h.prototype.readInt16LE=function(t,e){t=t>>>0,e||W(t,2,this.length);let r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r};h.prototype.readInt16BE=function(t,e){t=t>>>0,e||W(t,2,this.length);let r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r};h.prototype.readInt32LE=function(t,e){return t=t>>>0,e||W(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};h.prototype.readInt32BE=function(t,e){return t=t>>>0,e||W(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};h.prototype.readBigInt64LE=xt(function(t){t=t>>>0,ye(t,"offset");let e=this[t],r=this[t+7];(e===void 0||r===void 0)&&Ge(t,this.length-8);let n=this[t+4]+this[t+5]*D(2,8)+this[t+6]*D(2,16)+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(e+this[++t]*D(2,8)+this[++t]*D(2,16)+this[++t]*D(2,24))});h.prototype.readBigInt64BE=xt(function(t){t=t>>>0,ye(t,"offset");let e=this[t],r=this[t+7];(e===void 0||r===void 0)&&Ge(t,this.length-8);let n=(e<<24)+this[++t]*D(2,16)+this[++t]*D(2,8)+this[++t];return(BigInt(n)<<BigInt(32))+BigInt(this[++t]*D(2,24)+this[++t]*D(2,16)+this[++t]*D(2,8)+r)});h.prototype.readFloatLE=function(t,e){return t=t>>>0,e||W(t,4,this.length),Re.read(this,t,!0,23,4)};h.prototype.readFloatBE=function(t,e){return t=t>>>0,e||W(t,4,this.length),Re.read(this,t,!1,23,4)};h.prototype.readDoubleLE=function(t,e){return t=t>>>0,e||W(t,8,this.length),Re.read(this,t,!0,52,8)};h.prototype.readDoubleBE=function(t,e){return t=t>>>0,e||W(t,8,this.length),Re.read(this,t,!1,52,8)};function it(i,t,e,r,n,o){if(!h.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<o)throw new RangeError('"value" argument is out of bounds');if(e+r>i.length)throw new RangeError("Index out of range")}h.prototype.writeUintLE=h.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e=e>>>0,r=r>>>0,!n){let c=Math.pow(2,8*r)-1;it(this,t,e,r,c,0)}let o=1,s=0;for(this[e]=t&255;++s<r&&(o*=256);)this[e+s]=t/o&255;return e+r};h.prototype.writeUintBE=h.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e=e>>>0,r=r>>>0,!n){let c=Math.pow(2,8*r)-1;it(this,t,e,r,c,0)}let o=r-1,s=1;for(this[e+o]=t&255;--o>=0&&(s*=256);)this[e+o]=t/s&255;return e+r};h.prototype.writeUint8=h.prototype.writeUInt8=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,1,255,0),this[e]=t&255,e+1};h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,2,65535,0),this[e]=t&255,this[e+1]=t>>>8,e+2};h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=t&255,e+2};h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t&255,e+4};h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};function Ln(i,t,e,r,n){jn(t,r,n,i,e,7);let o=Number(t&BigInt(4294967295));i[e++]=o,o=o>>8,i[e++]=o,o=o>>8,i[e++]=o,o=o>>8,i[e++]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return i[e++]=s,s=s>>8,i[e++]=s,s=s>>8,i[e++]=s,s=s>>8,i[e++]=s,e}function Mn(i,t,e,r,n){jn(t,r,n,i,e,7);let o=Number(t&BigInt(4294967295));i[e+7]=o,o=o>>8,i[e+6]=o,o=o>>8,i[e+5]=o,o=o>>8,i[e+4]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return i[e+3]=s,s=s>>8,i[e+2]=s,s=s>>8,i[e+1]=s,s=s>>8,i[e]=s,e+8}h.prototype.writeBigUInt64LE=xt(function(t,e=0){return Ln(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))});h.prototype.writeBigUInt64BE=xt(function(t,e=0){return Mn(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))});h.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e=e>>>0,!n){let a=Math.pow(2,8*r-1);it(this,t,e,r,a-1,-a)}let o=0,s=1,c=0;for(this[e]=t&255;++o<r&&(s*=256);)t<0&&c===0&&this[e+o-1]!==0&&(c=1),this[e+o]=(t/s>>0)-c&255;return e+r};h.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e=e>>>0,!n){let a=Math.pow(2,8*r-1);it(this,t,e,r,a-1,-a)}let o=r-1,s=1,c=0;for(this[e+o]=t&255;--o>=0&&(s*=256);)t<0&&c===0&&this[e+o+1]!==0&&(c=1),this[e+o]=(t/s>>0)-c&255;return e+r};h.prototype.writeInt8=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=t&255,e+1};h.prototype.writeInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,2,32767,-32768),this[e]=t&255,this[e+1]=t>>>8,e+2};h.prototype.writeInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=t&255,e+2};h.prototype.writeInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,4,2147483647,-2147483648),this[e]=t&255,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4};h.prototype.writeInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||it(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};h.prototype.writeBigInt64LE=xt(function(t,e=0){return Ln(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});h.prototype.writeBigInt64BE=xt(function(t,e=0){return Mn(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Bn(i,t,e,r,n,o){if(e+r>i.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function kn(i,t,e,r,n){return t=+t,e=e>>>0,n||Bn(i,t,e,4,34028234663852886e22,-34028234663852886e22),Re.write(i,t,e,r,23,4),e+4}h.prototype.writeFloatLE=function(t,e,r){return kn(this,t,e,!0,r)};h.prototype.writeFloatBE=function(t,e,r){return kn(this,t,e,!1,r)};function xn(i,t,e,r,n){return t=+t,e=e>>>0,n||Bn(i,t,e,8,17976931348623157e292,-17976931348623157e292),Re.write(i,t,e,r,52,8),e+8}h.prototype.writeDoubleLE=function(t,e,r){return xn(this,t,e,!0,r)};h.prototype.writeDoubleBE=function(t,e,r){return xn(this,t,e,!1,r)};h.prototype.copy=function(t,e,r,n){if(!h.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),!n&&n!==0&&(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||t.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);let o=n-r;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),o};h.prototype.fill=function(t,e,r,n){if(typeof t=="string"){if(typeof e=="string"?(n=e,e=0,r=this.length):typeof r=="string"&&(n=r,r=this.length),n!==void 0&&typeof n!="string")throw new TypeError("encoding must be a string");if(typeof n=="string"&&!h.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(t.length===1){let s=t.charCodeAt(0);(n==="utf8"&&s<128||n==="latin1")&&(t=s)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;e=e>>>0,r=r===void 0?this.length:r>>>0,t||(t=0);let o;if(typeof t=="number")for(o=e;o<r;++o)this[o]=t;else{let s=h.isBuffer(t)?t:h.from(t,n),c=s.length;if(c===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=s[o%c]}return this};var pe={};function Cr(i,t,e){pe[i]=class extends e{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${i}]`,this.stack,delete this.name}get code(){return i}set code(n){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:n,writable:!0})}toString(){return`${this.name} [${i}]: ${this.message}`}}}Cr("ERR_BUFFER_OUT_OF_BOUNDS",function(i){return i?`${i} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);Cr("ERR_INVALID_ARG_TYPE",function(i,t){return`The "${i}" argument must be of type number. Received type ${typeof t}`},TypeError);Cr("ERR_OUT_OF_RANGE",function(i,t,e){let r=`The value of "${i}" is out of range.`,n=e;return Number.isInteger(e)&&Math.abs(e)>D(2,32)?n=gn(String(e)):typeof e=="bigint"&&(n=String(e),(e>D(BigInt(2),BigInt(32))||e<-D(BigInt(2),BigInt(32)))&&(n=gn(n)),n+="n"),r+=` It must be ${t}. Received ${n}`,r},RangeError);function gn(i){let t="",e=i.length,r=i[0]==="-"?1:0;for(;e>=r+4;e-=3)t=`_${i.slice(e-3,e)}${t}`;return`${i.slice(0,e)}${t}`}function xc(i,t,e){ye(t,"offset"),(i[t]===void 0||i[t+e]===void 0)&&Ge(t,i.length-(e+1))}function jn(i,t,e,r,n,o){if(i>e||i<t){let s=typeof t=="bigint"?"n":"",c;throw o>3?t===0||t===BigInt(0)?c=`>= 0${s} and < 2${s} ** ${(o+1)*8}${s}`:c=`>= -(2${s} ** ${(o+1)*8-1}${s}) and < 2 ** ${(o+1)*8-1}${s}`:c=`>= ${t}${s} and <= ${e}${s}`,new pe.ERR_OUT_OF_RANGE("value",c,i)}xc(r,n,o)}function ye(i,t){if(typeof i!="number")throw new pe.ERR_INVALID_ARG_TYPE(t,"number",i)}function Ge(i,t,e){throw Math.floor(i)!==i?(ye(i,e),new pe.ERR_OUT_OF_RANGE(e||"offset","an integer",i)):t<0?new pe.ERR_BUFFER_OUT_OF_BOUNDS:new pe.ERR_OUT_OF_RANGE(e||"offset",`>= ${e?1:0} and <= ${t}`,i)}var jc=/[^+/0-9A-Za-z-_]/g;function Vc(i){if(i=i.split("=")[0],i=i.trim().replace(jc,""),i.length<2)return"";for(;i.length%4!==0;)i=i+"=";return i}function Nr(i,t){t=t||1/0;let e,r=i.length,n=null,o=[];for(let s=0;s<r;++s){if(e=i.charCodeAt(s),e>55295&&e<57344){if(!n){if(e>56319){(t-=3)>-1&&o.push(239,191,189);continue}else if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}n=e;continue}if(e<56320){(t-=3)>-1&&o.push(239,191,189),n=e;continue}e=(n-55296<<10|e-56320)+65536}else n&&(t-=3)>-1&&o.push(239,191,189);if(n=null,e<128){if((t-=1)<0)break;o.push(e)}else if(e<2048){if((t-=2)<0)break;o.push(e>>6|192,e&63|128)}else if(e<65536){if((t-=3)<0)break;o.push(e>>12|224,e>>6&63|128,e&63|128)}else if(e<1114112){if((t-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,e&63|128)}else throw new Error("Invalid code point")}return o}function Fc(i){let t=[];for(let e=0;e<i.length;++e)t.push(i.charCodeAt(e)&255);return t}function Hc(i,t){let e,r,n,o=[];for(let s=0;s<i.length&&!((t-=2)<0);++s)e=i.charCodeAt(s),r=e>>8,n=e%256,o.push(n),o.push(r);return o}function Vn(i){return Sr.toByteArray(Vc(i))}function fi(i,t,e,r){let n;for(n=0;n<r&&!(n+e>=t.length||n>=i.length);++n)t[n+e]=i[n];return n}function vt(i,t){return i instanceof t||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===t.name}function vr(i){return i!==i}var Gc=function(){let i="0123456789abcdef",t=new Array(256);for(let e=0;e<16;++e){let r=e*16;for(let n=0;n<16;++n)t[r+n]=i[e]+i[n]}return t}();function xt(i){return typeof BigInt=="undefined"?qc:i}function qc(){throw new Error("BigInt not supported")}});var Buffer,u=hc(()=>{"use strict";Buffer=Fn().Buffer});var Gn=y(_e=>{"use strict";u();Object.defineProperty(_e,"__esModule",{value:!0});_e.LOCAL_WINS=_e.REMOTE_WINS=void 0;var Wc=function(i,t,e,r,n){n(null,e)};_e.REMOTE_WINS=Wc;var Yc=function(i,t,e,r,n){n(null,i)};_e.LOCAL_WINS=Yc});var qn=y(pi=>{"use strict";u();Object.defineProperty(pi,"__esModule",{value:!0});pi.DefaultOptions=void 0;var Jc=Gn();pi.DefaultOptions={nativeTimerRegistry:!0,intervalTimerResolution:50,subscriptionInterval:100,heartbeatInterval:3e4,reconnectIntervalIncrement:4e3,maxReconnectInterval:18e4,maxReconnectAttempts:5,subscriptionTimeout:2e3,recordReadAckTimeout:15e3,recordReadTimeout:15e3,recordDeleteTimeout:15e3,offlineBufferTimeout:2e3,recordDiscardTimeout:5e3,offlineEnabled:!1,saveUpdatesOffline:!1,recordReadOnlyMode:!1,recordPrefixWriteWhitelist:[],path:"/deepstream",mergeStrategy:Jc.REMOTE_WINS,recordDeepCopy:!0,dirtyStorageName:"__ds__dirty_records",nodeStoragePath:"./local-storage",indexdb:{autoVersion:!1,dbVersion:1,primaryKey:"id",storageDatabaseName:"deepstream",defaultObjectStoreName:"records",objectStoreNames:[],ignorePrefixes:[],flushTimeout:50},nodeStorageSize:5,lazyConnect:!1,debug:!1,initialRecordVersion:1}});var Wn=y(Ri=>{"use strict";u();Object.defineProperty(Ri,"__esModule",{value:!0});var Kc;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.PARSER=1]="PARSER",i[i.CONNECTION=2]="CONNECTION",i[i.AUTH=3]="AUTH",i[i.EVENT=4]="EVENT",i[i.RECORD=5]="RECORD",i[i.RPC=6]="RPC",i[i.PRESENCE=7]="PRESENCE",i[i.MONITORING=8]="MONITORING",i[i.CLUSTER=9]="CLUSTER",i[i.LOCK=10]="LOCK",i[i.STATE_REGISTRY=11]="STATE_REGISTRY",i[i.ERROR=100]="ERROR"})(Kc=Ri.TOPIC||(Ri.TOPIC={}))});var Yn=y(yi=>{"use strict";u();Object.defineProperty(yi,"__esModule",{value:!0});var $c;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.ERROR=1]="ERROR",i[i.NOTIFY=2]="NOTIFY",i[i.READ=3]="READ",i[i.READ_RESPONSE=4]="READ_RESPONSE",i[i.HEAD=5]="HEAD",i[i.HEAD_RESPONSE=6]="HEAD_RESPONSE",i[i.HEAD_BULK=7]="HEAD_BULK",i[i.HEAD_RESPONSE_BULK=8]="HEAD_RESPONSE_BULK",i[i.DELETE=9]="DELETE",i[i.DELETE_SUCCESS=10]="DELETE_SUCCESS",i[i.DELETE_BULK=11]="DELETE_BULK",i[i.DELETE_BULK_SUCCESS=12]="DELETE_BULK_SUCCESS",i[i.DELETED=13]="DELETED",i[i.WRITE_ACKNOWLEDGEMENT=14]="WRITE_ACKNOWLEDGEMENT",i[i.CREATE=15]="CREATE",i[i.CREATEANDUPDATE=16]="CREATEANDUPDATE",i[i.CREATEANDPATCH=17]="CREATEANDPATCH",i[i.UPDATE=18]="UPDATE",i[i.PATCH=19]="PATCH",i[i.ERASE=20]="ERASE",i[i.SUBSCRIBEANDHEAD=21]="SUBSCRIBEANDHEAD",i[i.SUBSCRIBEANDREAD=22]="SUBSCRIBEANDREAD",i[i.SUBSCRIBECREATEANDREAD=23]="SUBSCRIBECREATEANDREAD",i[i.SUBSCRIBECREATEANDUPDATE=24]="SUBSCRIBECREATEANDUPDATE",i[i.SUBSCRIBE=25]="SUBSCRIBE",i[i.UNSUBSCRIBE=26]="UNSUBSCRIBE",i[i.LISTEN=27]="LISTEN",i[i.UNLISTEN=28]="UNLISTEN",i[i.LISTEN_ACCEPT=29]="LISTEN_ACCEPT",i[i.LISTEN_REJECT=30]="LISTEN_REJECT",i[i.SUBSCRIPTION_HAS_PROVIDER=31]="SUBSCRIPTION_HAS_PROVIDER",i[i.SUBSCRIPTION_HAS_NO_PROVIDER=32]="SUBSCRIPTION_HAS_NO_PROVIDER",i[i.SUBSCRIPTION_FOR_PATTERN_FOUND=33]="SUBSCRIPTION_FOR_PATTERN_FOUND",i[i.SUBSCRIPTION_FOR_PATTERN_REMOVED=34]="SUBSCRIPTION_FOR_PATTERN_REMOVED",i[i.CACHE_RETRIEVAL_TIMEOUT=100]="CACHE_RETRIEVAL_TIMEOUT",i[i.STORAGE_RETRIEVAL_TIMEOUT=101]="STORAGE_RETRIEVAL_TIMEOUT",i[i.VERSION_EXISTS=102]="VERSION_EXISTS",i[i.RECORD_LOAD_ERROR=103]="RECORD_LOAD_ERROR",i[i.RECORD_CREATE_ERROR=104]="RECORD_CREATE_ERROR",i[i.RECORD_UPDATE_ERROR=105]="RECORD_UPDATE_ERROR",i[i.RECORD_DELETE_ERROR=106]="RECORD_DELETE_ERROR",i[i.RECORD_NOT_FOUND=107]="RECORD_NOT_FOUND",i[i.INVALID_VERSION=108]="INVALID_VERSION",i[i.INVALID_PATCH_ON_HOTPATH=109]="INVALID_PATCH_ON_HOTPATH",i[i.INVALID_LISTEN_REGEX=110]="INVALID_LISTEN_REGEX",i[i.LISTEN_RESPONSE_TIMEOUT=111]="LISTEN_RESPONSE_TIMEOUT",i[i.LISTEN_UNSUCCESSFUL=112]="LISTEN_UNSUCCESSFUL",i[i.RECORD_NOTIFY_ERROR=113]="RECORD_NOTIFY_ERROR",i[i.MESSAGE_PERMISSION_ERROR=114]="MESSAGE_PERMISSION_ERROR",i[i.MESSAGE_DENIED=115]="MESSAGE_DENIED",i[i.INVALID_MESSAGE_DATA=116]="INVALID_MESSAGE_DATA",i[i.MULTIPLE_SUBSCRIPTIONS=117]="MULTIPLE_SUBSCRIPTIONS",i[i.NOT_SUBSCRIBED=118]="NOT_SUBSCRIBED"})($c=yi.RECORD_ACTION||(yi.RECORD_ACTION={}))});var Jn=y(Si=>{"use strict";u();Object.defineProperty(Si,"__esModule",{value:!0});var Qc;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.ERROR=1]="ERROR",i[i.REQUEST=2]="REQUEST",i[i.AUTH_SUCCESSFUL=3]="AUTH_SUCCESSFUL",i[i.AUTH_UNSUCCESSFUL=4]="AUTH_UNSUCCESSFUL",i[i.TOO_MANY_AUTH_ATTEMPTS=100]="TOO_MANY_AUTH_ATTEMPTS",i[i.INVALID_MESSAGE=101]="INVALID_MESSAGE",i[i.INVALID_MESSAGE_DATA=102]="INVALID_MESSAGE_DATA"})(Qc=Si.AUTH_ACTION||(Si.AUTH_ACTION={}))});var Kn=y(_i=>{"use strict";u();Object.defineProperty(_i,"__esModule",{value:!0});var zc;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.ERROR=1]="ERROR",i[i.EMIT=2]="EMIT",i[i.SUBSCRIBE=3]="SUBSCRIBE",i[i.UNSUBSCRIBE=4]="UNSUBSCRIBE",i[i.LISTEN=5]="LISTEN",i[i.UNLISTEN=6]="UNLISTEN",i[i.LISTEN_ACCEPT=7]="LISTEN_ACCEPT",i[i.LISTEN_REJECT=8]="LISTEN_REJECT",i[i.SUBSCRIPTION_HAS_PROVIDER=9]="SUBSCRIPTION_HAS_PROVIDER",i[i.SUBSCRIPTION_HAS_NO_PROVIDER=10]="SUBSCRIPTION_HAS_NO_PROVIDER",i[i.SUBSCRIPTION_FOR_PATTERN_FOUND=11]="SUBSCRIPTION_FOR_PATTERN_FOUND",i[i.SUBSCRIPTION_FOR_PATTERN_REMOVED=12]="SUBSCRIPTION_FOR_PATTERN_REMOVED",i[i.INVALID_LISTEN_REGEX=100]="INVALID_LISTEN_REGEX",i[i.LISTEN_RESPONSE_TIMEOUT=101]="LISTEN_RESPONSE_TIMEOUT",i[i.LISTEN_UNSUCCESSFUL=102]="LISTEN_UNSUCCESSFUL",i[i.MESSAGE_PERMISSION_ERROR=103]="MESSAGE_PERMISSION_ERROR",i[i.MESSAGE_DENIED=104]="MESSAGE_DENIED",i[i.INVALID_MESSAGE_DATA=105]="INVALID_MESSAGE_DATA",i[i.MULTIPLE_SUBSCRIPTIONS=106]="MULTIPLE_SUBSCRIPTIONS",i[i.NOT_SUBSCRIBED=107]="NOT_SUBSCRIBED"})(zc=_i.EVENT_ACTION||(_i.EVENT_ACTION={}))});var $n=y(Oi=>{"use strict";u();Object.defineProperty(Oi,"__esModule",{value:!0});var Xc;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.ERROR=1]="ERROR",i[i.REQUEST=2]="REQUEST",i[i.ACCEPT=4]="ACCEPT",i[i.RESPONSE=5]="RESPONSE",i[i.REJECT=6]="REJECT",i[i.REQUEST_ERROR=7]="REQUEST_ERROR",i[i.PROVIDE=8]="PROVIDE",i[i.UNPROVIDE=9]="UNPROVIDE",i[i.NO_RPC_PROVIDER=100]="NO_RPC_PROVIDER",i[i.ACCEPT_TIMEOUT=101]="ACCEPT_TIMEOUT",i[i.MULTIPLE_ACCEPT=102]="MULTIPLE_ACCEPT",i[i.INVALID_RPC_CORRELATION_ID=103]="INVALID_RPC_CORRELATION_ID",i[i.RESPONSE_TIMEOUT=104]="RESPONSE_TIMEOUT",i[i.MULTIPLE_RESPONSE=105]="MULTIPLE_RESPONSE",i[i.MESSAGE_PERMISSION_ERROR=106]="MESSAGE_PERMISSION_ERROR",i[i.MESSAGE_DENIED=107]="MESSAGE_DENIED",i[i.INVALID_MESSAGE_DATA=108]="INVALID_MESSAGE_DATA",i[i.MULTIPLE_PROVIDERS=109]="MULTIPLE_PROVIDERS",i[i.NOT_PROVIDED=110]="NOT_PROVIDED"})(Xc=Oi.RPC_ACTION||(Oi.RPC_ACTION={}))});var Qn=y(Ni=>{"use strict";u();Object.defineProperty(Ni,"__esModule",{value:!0});var Zc;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.ERROR=1]="ERROR",i[i.QUERY_ALL=2]="QUERY_ALL",i[i.QUERY_ALL_RESPONSE=3]="QUERY_ALL_RESPONSE",i[i.QUERY=4]="QUERY",i[i.QUERY_RESPONSE=5]="QUERY_RESPONSE",i[i.PRESENCE_JOIN=6]="PRESENCE_JOIN",i[i.PRESENCE_JOIN_ALL=7]="PRESENCE_JOIN_ALL",i[i.PRESENCE_LEAVE=8]="PRESENCE_LEAVE",i[i.PRESENCE_LEAVE_ALL=9]="PRESENCE_LEAVE_ALL",i[i.SUBSCRIBE=10]="SUBSCRIBE",i[i.UNSUBSCRIBE=11]="UNSUBSCRIBE",i[i.SUBSCRIBE_ALL=12]="SUBSCRIBE_ALL",i[i.UNSUBSCRIBE_ALL=13]="UNSUBSCRIBE_ALL",i[i.INVALID_PRESENCE_USERS=100]="INVALID_PRESENCE_USERS",i[i.MESSAGE_PERMISSION_ERROR=101]="MESSAGE_PERMISSION_ERROR",i[i.MESSAGE_DENIED=102]="MESSAGE_DENIED",i[i.MULTIPLE_SUBSCRIPTIONS=103]="MULTIPLE_SUBSCRIPTIONS",i[i.NOT_SUBSCRIBED=104]="NOT_SUBSCRIBED"})(Zc=Ni.PRESENCE_ACTION||(Ni.PRESENCE_ACTION={}))});var zn=y(Ti=>{"use strict";u();Object.defineProperty(Ti,"__esModule",{value:!0});var ta;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.ERROR=1]="ERROR",i[i.PING=2]="PING",i[i.PONG=3]="PONG",i[i.ACCEPT=4]="ACCEPT",i[i.CHALLENGE=5]="CHALLENGE",i[i.REJECT=6]="REJECT",i[i.REDIRECT=7]="REDIRECT",i[i.CLOSING=8]="CLOSING",i[i.CLOSED=9]="CLOSED",i[i.AUTHENTICATION_TIMEOUT=100]="AUTHENTICATION_TIMEOUT",i[i.INVALID_MESSAGE=101]="INVALID_MESSAGE"})(ta=Ti.CONNECTION_ACTION||(Ti.CONNECTION_ACTION={}))});var Xn=y(Ii=>{"use strict";u();Object.defineProperty(Ii,"__esModule",{value:!0});var ea;(function(i){i[i.REMOVE=1]="REMOVE",i[i.STATUS=2]="STATUS"})(ea=Ii.CLUSTER_ACTION||(Ii.CLUSTER_ACTION={}))});var Zn=y(Ci=>{"use strict";u();Object.defineProperty(Ci,"__esModule",{value:!0});var ia;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.ERROR=1]="ERROR",i[i.REQUEST=2]="REQUEST",i[i.RESPONSE=3]="RESPONSE",i[i.RELEASE=4]="RELEASE"})(ia=Ci.LOCK_ACTION||(Ci.LOCK_ACTION={}))});var to=y(vi=>{"use strict";u();Object.defineProperty(vi,"__esModule",{value:!0});var ra;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.UNKNOWN_TOPIC=1]="UNKNOWN_TOPIC",i[i.UNKNOWN_ACTION=2]="UNKNOWN_ACTION",i[i.INVALID_MESSAGE=3]="INVALID_MESSAGE",i[i.MESSAGE_PARSE_ERROR=4]="MESSAGE_PARSE_ERROR",i[i.MAXIMUM_MESSAGE_SIZE_EXCEEDED=5]="MAXIMUM_MESSAGE_SIZE_EXCEEDED",i[i.ERROR=6]="ERROR",i[i.INVALID_META_PARAMS=7]="INVALID_META_PARAMS"})(ra=vi.PARSER_ACTION||(vi.PARSER_ACTION={}))});var eo=y(bi=>{"use strict";u();Object.defineProperty(bi,"__esModule",{value:!0});var na;(function(i){})(na=bi.MONITORING_ACTION||(bi.MONITORING_ACTION={}))});var io=y(Oe=>{"use strict";u();Object.defineProperty(Oe,"__esModule",{value:!0});var oa;(function(i){i[i.EVENT_SUBSCRIPTIONS=11]="EVENT_SUBSCRIPTIONS",i[i.RECORD_SUBSCRIPTIONS=12]="RECORD_SUBSCRIPTIONS",i[i.SUBSCRIPTIONS=9]="SUBSCRIPTIONS",i[i.ONLINE_USERS=10]="ONLINE_USERS",i[i.MONITORING_SUBSCRIPTIONS=24]="MONITORING_SUBSCRIPTIONS",i[i.RPC_SUBSCRIPTIONS=13]="RPC_SUBSCRIPTIONS",i[i.PRESENCE_SUBSCRIPTIONS=14]="PRESENCE_SUBSCRIPTIONS",i[i.RECORD_LISTEN_PATTERNS=15]="RECORD_LISTEN_PATTERNS",i[i.EVENT_LISTEN_PATTERNS=16]="EVENT_LISTEN_PATTERNS",i[i.RECORD_PUBLISHED_SUBSCRIPTIONS=17]="RECORD_PUBLISHED_SUBSCRIPTIONS",i[i.EVENT_PUBLISHED_SUBSCRIPTIONS=18]="EVENT_PUBLISHED_SUBSCRIPTIONS",i[i.RECORD_LISTENING=19]="RECORD_LISTENING",i[i.EVENT_LISTENING=20]="EVENT_LISTENING",i[i.STATE_REGISTRY=21]="STATE_REGISTRY"})(oa=Oe.STATE_REGISTRY_TOPIC||(Oe.STATE_REGISTRY_TOPIC={}));var sa;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.ERROR=1]="ERROR",i[i.ADD=2]="ADD",i[i.REMOVE=3]="REMOVE",i[i.REQUEST_FULL_STATE=4]="REQUEST_FULL_STATE",i[i.FULL_STATE=5]="FULL_STATE",i[i.CHECKSUM=6]="CHECKSUM"})(sa=Oe.STATE_ACTION||(Oe.STATE_ACTION={}))});var Ne=y(Z=>{"use strict";u();Object.defineProperty(Z,"__esModule",{value:!0});var ca=Wn();Z.TOPIC=ca.TOPIC;var aa=Yn();Z.RECORD_ACTION=aa.RECORD_ACTION;var ua=Jn();Z.AUTH_ACTION=ua.AUTH_ACTION;var la=Kn();Z.EVENT_ACTION=la.EVENT_ACTION;var ha=$n();Z.RPC_ACTION=ha.RPC_ACTION;var fa=Qn();Z.PRESENCE_ACTION=fa.PRESENCE_ACTION;var da=zn();Z.CONNECTION_ACTION=da.CONNECTION_ACTION;var Ea=Xn();Z.CLUSTER_ACTION=Ea.CLUSTER_ACTION;var pa=Zn();Z.LOCK_ACTION=pa.LOCK_ACTION;var Ra=to();Z.PARSER_ACTION=Ra.PARSER_ACTION;var ya=eo();Z.MONITORING_ACTION=ya.MONITORING_ACTION;var ro=io();Z.STATE_ACTION=ro.STATE_ACTION;Z.STATE_REGISTRY_TOPIC=ro.STATE_REGISTRY_TOPIC});var gr=y(mr=>{"use strict";u();Object.defineProperty(mr,"__esModule",{value:!0});var M=Ne();mr.ACTIONS={[M.TOPIC.PARSER]:M.PARSER_ACTION,[M.TOPIC.CONNECTION]:M.CONNECTION_ACTION,[M.TOPIC.AUTH]:M.AUTH_ACTION,[M.TOPIC.EVENT]:M.EVENT_ACTION,[M.TOPIC.RECORD]:M.RECORD_ACTION,[M.TOPIC.RPC]:M.RPC_ACTION,[M.TOPIC.PRESENCE]:M.PRESENCE_ACTION,[M.TOPIC.LOCK]:M.LOCK_ACTION,[M.TOPIC.STATE_REGISTRY]:M.STATE_ACTION,[M.TOPIC.CLUSTER]:M.CLUSTER_ACTION,[M.TOPIC.MONITORING]:M.MONITORING_ACTION}});var F=y(X=>{"use strict";u();var Sa=X&&X.__createBinding||(Object.create?function(i,t,e,r){r===void 0&&(r=e),Object.defineProperty(i,r,{enumerable:!0,get:function(){return t[e]}})}:function(i,t,e,r){r===void 0&&(r=e),i[r]=t[e]}),no=X&&X.__exportStar||function(i,t){for(var e in i)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&Sa(t,i,e)},Te,We,mi,gi;Object.defineProperty(X,"__esModule",{value:!0});X.CONNECTION_STATE=X.EVENT=X.RESPONSE_TO_REQUEST=void 0;var Y=Ne();no(Ne(),X);no(gr(),X);X.RESPONSE_TO_REQUEST=(Te={},Te[Y.TOPIC.RECORD]=(We={},We[Y.RECORD_ACTION.HEAD_RESPONSE]=Y.RECORD_ACTION.HEAD,We[Y.RECORD_ACTION.READ_RESPONSE]=Y.RECORD_ACTION.READ,We[Y.RECORD_ACTION.DELETE_SUCCESS]=Y.RECORD_ACTION.DELETE,We),Te[Y.TOPIC.PRESENCE]=(mi={},mi[Y.PRESENCE_ACTION.QUERY_RESPONSE]=Y.PRESENCE_ACTION.QUERY,mi[Y.PRESENCE_ACTION.QUERY_ALL_RESPONSE]=Y.PRESENCE_ACTION.QUERY_ALL,mi),Te[Y.TOPIC.RPC]=(gi={},gi[Y.RPC_ACTION.ACCEPT]=Y.RPC_ACTION.REQUEST,gi[Y.RPC_ACTION.ERROR]=Y.RPC_ACTION.REQUEST,gi),Te[Y.TOPIC.EVENT]={},Te);var _a;(function(i){i.RECORD_READ_ONLY_MODE="RECORD_READ_ONLY_MODE",i.UNSOLICITED_MESSAGE="UNSOLICITED_MESSAGE",i.IS_CLOSED="IS_CLOSED",i.MAX_RECONNECTION_ATTEMPTS_REACHED="MAX_RECONNECTION_ATTEMPTS_REACHED",i.CONNECTION_ERROR="CONNECTION_ERROR",i.ACK_TIMEOUT="ACK_TIMEOUT",i.UNKNOWN_CORRELATION_ID="UNKNOWN_CORRELATION_ID",i.HEARTBEAT_TIMEOUT="HEARTBEAT_TIMEOUT",i.LISTENER_EXISTS="LISTENER_EXISTS",i.NOT_LISTENING="NOT_LISTENING",i.RECORD_ALREADY_DESTROYED="RECORD_ALREADY_DESTROYED",i.RECORD_DELETE_TIMEOUT="RECORD_DELETE_TIMEOUT",i.CLIENT_OFFLINE="client offline",i.INVALID_AUTHENTICATION_DETAILS="INVALID_AUTHENTICATION_DETAILS",i.CONNECTION_LOST="connectionLost",i.CONNECTION_REESTABLISHED="connectionReestablished",i.EXIT_LIMBO="exitLimbo",i.CONNECTION_STATE_CHANGED="connectionStateChanged",i.CLIENT_DATA_CHANGED="clientDataChanged",i.REAUTHENTICATION_FAILURE="reauthenticationFailure",i.AUTHENTICATION_TIMEOUT="AUTHENTICATION_TIMEOUT",i.RECORD_ERROR="error",i.RECORD_READY="ready",i.RECORD_DELETED="delete",i.RECORD_DISCARDED="discard",i.RECORD_VERSION_EXISTS="versionExists",i.RECORD_HAS_PROVIDER_CHANGED="hasProviderChanged",i.RECORD_STATE_CHANGED="onRecordStateChanged",i.ENTRY_ADDED_EVENT="entry-added",i.ENTRY_REMOVED_EVENT="entry-removed",i.ENTRY_MOVED_EVENT="entry-moved"})(_a=X.EVENT||(X.EVENT={}));var Oa;(function(i){i.CLOSING="CLOSING",i.CLOSED="CLOSED",i.INITIALISING="INITIALISING",i.AWAITING_CONNECTION="AWAITING_CONNECTION",i.CHALLENGING="CHALLENGING",i.AWAITING_AUTHENTICATION="AWAITING_AUTHENTICATION",i.AUTHENTICATING="AUTHENTICATING",i.OPEN="OPEN",i.ERROR="ERROR",i.RECONNECTING="RECONNECTING",i.REDIRECTING="REDIRECTING",i.CHALLENGE_DENIED="CHALLENGE_DENIED",i.TOO_MANY_AUTH_ATTEMPTS="TOO_MANY_AUTH_ATTEMPTS",i.AUTHENTICATION_TIMEOUT="AUTHENTICATION_TIMEOUT",i.PAUSING="PAUSING",i.OFFLINE="OFFLINE"})(Oa=X.CONNECTION_STATE||(X.CONNECTION_STATE={}))});var so=y(Di=>{"use strict";u();Object.defineProperty(Di,"__esModule",{value:!0});Di.Logger=void 0;var Ye=F(),oo=gr(),Ai=Ne();function Na(i){return Ye.EVENT[i]!==void 0}var Ta=function(){function i(t){this.emitter=t}return i.prototype.warn=function(t,e,r){var n="Warning: "+Ai.TOPIC[t.topic],o=t.action;o&&(n+=" ("+oo.ACTIONS[t.topic][o]+")"),e&&(n+=": "+Ye.EVENT[e]),r&&(n+=" \u2013 "+(typeof r=="string"?r:JSON.stringify(r))),console.warn(n)},i.prototype.error=function(t,e,r){if(Na(e))(e===Ye.EVENT.IS_CLOSED||e===Ye.EVENT.CONNECTION_ERROR)&&this.emitter.emit("error",r,Ye.EVENT[e],Ai.TOPIC[Ai.TOPIC.CONNECTION]);else{var n=e||t.action;this.emitter.emit("error",r||t,oo.ACTIONS[t.topic][n],Ai.TOPIC[t.topic])}},i}();Di.Logger=Ta});var mt=y(bt=>{"use strict";u();var Ia=bt&&bt.__values||function(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],r=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},co=bt&&bt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o},Ca=bt&&bt.__spread||function(){for(var i=[],t=0;t<arguments.length;t++)i=i.concat(co(arguments[t]));return i};Object.defineProperty(bt,"__esModule",{value:!0});bt.Emitter=void 0;var va=function(){function i(){this.callbacks=null}return i.prototype.on=function(t,e,r){r===void 0&&(r=this),this.callbacks=this.callbacks||new Map;var n=this.callbacks.get(t);return n?n.push({fn:e,scope:r}):(n=[{fn:e,scope:r}],this.callbacks.set(t,n)),this},i.prototype.once=function(t,e,r){var n=this;r===void 0&&(r=this);var o=function(){for(var s=[],c=0;c<arguments.length;c++)s[c]=arguments[c];n.off(t,o,n),e.apply(n,s)};return o.fn=e,this.on(t,o,r),this},i.prototype.off=function(t,e,r){if(t===void 0&&e===void 0&&r===void 0&&(this.callbacks=null),this.callbacks===null)return this;var n=this.callbacks.get(t);return n?e===void 0&&r===void 0?(this.callbacks.delete(t),this):(n=n.filter(function(o){var s=o.fn,c=o.scope;return!(t!==""&&e===void 0&&r===c||(s===e||s.fn===e)&&(r===void 0||r===c))}),n.length===0?this.callbacks.delete(t):this.callbacks.set(t,n),this):this},i.prototype.removeContext=function(t){var e,r;if(this.callbacks!==null)try{for(var n=Ia(this.callbacks),o=n.next();!o.done;o=n.next()){var s=co(o.value,2),c=s[0],a=s[1];this.callbacks.set(c,a.filter(function(l){var f=l.scope;return f===t}))}}catch(l){e={error:l}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},i.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(this.callbacks===null)return this;var n=this.callbacks.get(t);return!n||n.length===0?this:(n=n.slice(0),n.forEach(function(o){var s=o.fn,c=o.scope;return s.apply(c,e)}),this)},i.prototype.hasListeners=function(t){return this.callbacks===null?!1:this.callbacks.has(t)},i.prototype.eventNames=function(){return this.callbacks===null?[]:Ca(this.callbacks.keys())},i}();bt.Emitter=va});var uo=y(lt=>{"use strict";u();var ba=lt&&lt.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),wi=lt&&lt.__assign||function(){return wi=Object.assign||function(i){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},wi.apply(this,arguments)},ma=lt&&lt.__values||function(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],r=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ga=lt&&lt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o};Object.defineProperty(lt,"__esModule",{value:!0});lt.TimeoutRegistry=void 0;var ao=F(),Aa=mt(),Da=function(i){ba(t,i);function t(e,r){var n=i.call(this)||this;return n.services=e,n.options=r,n.register=new Map,n}return t.prototype.add=function(e){if(e.duration===void 0&&(e.duration=this.options.subscriptionTimeout),e.event===void 0&&(e.event=ao.EVENT.ACK_TIMEOUT),!this.services.connection.isConnected)return null;this.remove(e.message);var r={timerId:-1,uniqueName:this.getUniqueName(e.message),timeout:e};return r.timerId=this.services.timerRegistry.add({context:this,callback:this.onTimeout,duration:e.duration,data:r}),this.register.set(r.uniqueName,r),r.uniqueName},t.prototype.remove=function(e){var r,n=ao.RESPONSE_TO_REQUEST[e.topic][e.action];n?r=wi(wi({},e),{action:n}):r=e;var o=this.getUniqueName(r);this.clear(o)},t.prototype.clear=function(e){var r=this.register.get(e);r&&(this.register.delete(e),this.services.timerRegistry.remove(r.timerId))},t.prototype.onTimeout=function(e){this.register.delete(e.uniqueName);var r=e.timeout;r.callback?r.callback(r.event,r.message):this.services.logger.warn(r.message,r.event)},t.prototype.getUniqueName=function(e){var r=e.originalAction||e.action,n=""+e.topic+r+"_";return e.correlationId?n+=e.correlationId:e.name&&(n+=e.name),n},t.prototype.onConnectionLost=function(){var e,r;try{for(var n=ma(this.register),o=n.next();!o.done;o=n.next()){var s=ga(o.value,2),c=s[0],a=s[1];this.services.timerRegistry.remove(a.timerId),this.register.delete(c)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t}(Aa.Emitter);lt.TimeoutRegistry=Da});var lo=y(jt=>{"use strict";u();var wa=jt&&jt.__values||function(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],r=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Pa=jt&&jt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o};Object.defineProperty(jt,"__esModule",{value:!0});jt.IntervalTimerRegistry=void 0;var Ua=function(){function i(t){this.timerResolution=t,this.registry=new Map,this.timerIdCounter=0,this.timerId=setTimeout(this.triggerTimeouts.bind(this),this.timerResolution)}return i.prototype.close=function(){clearInterval(this.timerId)},i.prototype.triggerTimeouts=function(){var t,e,r=Date.now();try{for(var n=wa(this.registry),o=n.next();!o.done;o=n.next()){var s=Pa(o.value,2),c=s[0],a=s[1];r-a.created>a.duration&&(a.callback.call(a.context,a.data),this.registry.delete(c))}}catch(l){t={error:l}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.timerId=setTimeout(this.triggerTimeouts.bind(this),this.timerResolution)},i.prototype.has=function(t){return this.registry.has(t)},i.prototype.add=function(t){return this.timerIdCounter++,t.created=Date.now(),this.registry.set(this.timerIdCounter,t),this.timerIdCounter},i.prototype.remove=function(t){return this.registry.delete(t)},i.prototype.requestIdleCallback=function(t){setTimeout(t,0)},i}();jt.IntervalTimerRegistry=Ua});var ho=y(Pi=>{"use strict";u();Object.defineProperty(Pi,"__esModule",{value:!0});Pi.NativeTimerRegistry=void 0;var La=function(){function i(){this.registry=new Set}return i.prototype.close=function(){this.registry.forEach(clearTimeout),this.registry.clear()},i.prototype.has=function(t){return this.registry.has(t)},i.prototype.add=function(t){var e=this,r=setTimeout(function(){e.remove(r),t.callback.call(t.context,t.data)},t.duration);return this.registry.add(r),r},i.prototype.remove=function(t){return clearTimeout(t),this.registry.delete(t)},i.prototype.requestIdleCallback=function(t){setTimeout(t,0)},i}();Pi.NativeTimerRegistry=La});var Eo=y((Oh,fo)=>{"use strict";u();fo.exports=Ma;function Ma(i,t){for(var e=new Array(arguments.length-1),r=0,n=2,o=!0;n<arguments.length;)e[r++]=arguments[n++];return new Promise(function(c,a){e[r]=function(f){if(o)if(o=!1,f)a(f);else{for(var p=new Array(arguments.length-1),T=0;T<p.length;)p[T++]=arguments[T];c.apply(null,p)}};try{i.apply(t||null,e)}catch(l){o&&(o=!1,a(l))}})}});var So=y(yo=>{"use strict";u();var Ui=yo;Ui.length=function(t){var e=t.length;if(!e)return 0;for(var r=0;--e%4>1&&t.charAt(e)==="=";)++r;return Math.ceil(t.length*3)/4-r};var Ie=new Array(64),Ro=new Array(123);for(pt=0;pt<64;)Ro[Ie[pt]=pt<26?pt+65:pt<52?pt+71:pt<62?pt-4:pt-59|43]=pt++;var pt;Ui.encode=function(t,e,r){for(var n=null,o=[],s=0,c=0,a;e<r;){var l=t[e++];switch(c){case 0:o[s++]=Ie[l>>2],a=(l&3)<<4,c=1;break;case 1:o[s++]=Ie[a|l>>4],a=(l&15)<<2,c=2;break;case 2:o[s++]=Ie[a|l>>6],o[s++]=Ie[l&63],c=0;break}s>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),s=0)}return c&&(o[s++]=Ie[a],o[s++]=61,c===1&&(o[s++]=61)),n?(s&&n.push(String.fromCharCode.apply(String,o.slice(0,s))),n.join("")):String.fromCharCode.apply(String,o.slice(0,s))};var po="invalid encoding";Ui.decode=function(t,e,r){for(var n=r,o=0,s,c=0;c<t.length;){var a=t.charCodeAt(c++);if(a===61&&o>1)break;if((a=Ro[a])===void 0)throw Error(po);switch(o){case 0:s=a,o=1;break;case 1:e[r++]=s<<2|(a&48)>>4,s=a,o=2;break;case 2:e[r++]=(s&15)<<4|(a&60)>>2,s=a,o=3;break;case 3:e[r++]=(s&3)<<6|a,o=0;break}}if(o===1)throw Error(po);return r-n};Ui.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}});var Oo=y((Th,_o)=>{"use strict";u();_o.exports=Li;function Li(){this._listeners={}}Li.prototype.on=function(t,e,r){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:r||this}),this};Li.prototype.off=function(t,e){if(t===void 0)this._listeners={};else if(e===void 0)this._listeners[t]=[];else for(var r=this._listeners[t],n=0;n<r.length;)r[n].fn===e?r.splice(n,1):++n;return this};Li.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<e.length;)e[n].fn.apply(e[n++].ctx,r)}return this}});var mo=y((Ih,bo)=>{"use strict";u();bo.exports=No(No);function No(i){return typeof Float32Array!="undefined"?function(){var t=new Float32Array([-0]),e=new Uint8Array(t.buffer),r=e[3]===128;function n(a,l,f){t[0]=a,l[f]=e[0],l[f+1]=e[1],l[f+2]=e[2],l[f+3]=e[3]}function o(a,l,f){t[0]=a,l[f]=e[3],l[f+1]=e[2],l[f+2]=e[1],l[f+3]=e[0]}i.writeFloatLE=r?n:o,i.writeFloatBE=r?o:n;function s(a,l){return e[0]=a[l],e[1]=a[l+1],e[2]=a[l+2],e[3]=a[l+3],t[0]}function c(a,l){return e[3]=a[l],e[2]=a[l+1],e[1]=a[l+2],e[0]=a[l+3],t[0]}i.readFloatLE=r?s:c,i.readFloatBE=r?c:s}():function(){function t(r,n,o,s){var c=n<0?1:0;if(c&&(n=-n),n===0)r(1/n>0?0:2147483648,o,s);else if(isNaN(n))r(2143289344,o,s);else if(n>34028234663852886e22)r((c<<31|2139095040)>>>0,o,s);else if(n<11754943508222875e-54)r((c<<31|Math.round(n/1401298464324817e-60))>>>0,o,s);else{var a=Math.floor(Math.log(n)/Math.LN2),l=Math.round(n*Math.pow(2,-a)*8388608)&8388607;r((c<<31|a+127<<23|l)>>>0,o,s)}}i.writeFloatLE=t.bind(null,To),i.writeFloatBE=t.bind(null,Io);function e(r,n,o){var s=r(n,o),c=(s>>31)*2+1,a=s>>>23&255,l=s&8388607;return a===255?l?NaN:c*(1/0):a===0?c*1401298464324817e-60*l:c*Math.pow(2,a-150)*(l+8388608)}i.readFloatLE=e.bind(null,Co),i.readFloatBE=e.bind(null,vo)}(),typeof Float64Array!="undefined"?function(){var t=new Float64Array([-0]),e=new Uint8Array(t.buffer),r=e[7]===128;function n(a,l,f){t[0]=a,l[f]=e[0],l[f+1]=e[1],l[f+2]=e[2],l[f+3]=e[3],l[f+4]=e[4],l[f+5]=e[5],l[f+6]=e[6],l[f+7]=e[7]}function o(a,l,f){t[0]=a,l[f]=e[7],l[f+1]=e[6],l[f+2]=e[5],l[f+3]=e[4],l[f+4]=e[3],l[f+5]=e[2],l[f+6]=e[1],l[f+7]=e[0]}i.writeDoubleLE=r?n:o,i.writeDoubleBE=r?o:n;function s(a,l){return e[0]=a[l],e[1]=a[l+1],e[2]=a[l+2],e[3]=a[l+3],e[4]=a[l+4],e[5]=a[l+5],e[6]=a[l+6],e[7]=a[l+7],t[0]}function c(a,l){return e[7]=a[l],e[6]=a[l+1],e[5]=a[l+2],e[4]=a[l+3],e[3]=a[l+4],e[2]=a[l+5],e[1]=a[l+6],e[0]=a[l+7],t[0]}i.readDoubleLE=r?s:c,i.readDoubleBE=r?c:s}():function(){function t(r,n,o,s,c,a){var l=s<0?1:0;if(l&&(s=-s),s===0)r(0,c,a+n),r(1/s>0?0:2147483648,c,a+o);else if(isNaN(s))r(0,c,a+n),r(2146959360,c,a+o);else if(s>17976931348623157e292)r(0,c,a+n),r((l<<31|2146435072)>>>0,c,a+o);else{var f;if(s<22250738585072014e-324)f=s/5e-324,r(f>>>0,c,a+n),r((l<<31|f/4294967296)>>>0,c,a+o);else{var p=Math.floor(Math.log(s)/Math.LN2);p===1024&&(p=1023),f=s*Math.pow(2,-p),r(f*4503599627370496>>>0,c,a+n),r((l<<31|p+1023<<20|f*1048576&1048575)>>>0,c,a+o)}}}i.writeDoubleLE=t.bind(null,To,0,4),i.writeDoubleBE=t.bind(null,Io,4,0);function e(r,n,o,s,c){var a=r(s,c+n),l=r(s,c+o),f=(l>>31)*2+1,p=l>>>20&2047,T=4294967296*(l&1048575)+a;return p===2047?T?NaN:f*(1/0):p===0?f*5e-324*T:f*Math.pow(2,p-1075)*(T+4503599627370496)}i.readDoubleLE=e.bind(null,Co,0,4),i.readDoubleBE=e.bind(null,vo,4,0)}(),i}function To(i,t,e){t[e]=i&255,t[e+1]=i>>>8&255,t[e+2]=i>>>16&255,t[e+3]=i>>>24}function Io(i,t,e){t[e]=i>>>24,t[e+1]=i>>>16&255,t[e+2]=i>>>8&255,t[e+3]=i&255}function Co(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16|i[t+3]<<24)>>>0}function vo(i,t){return(i[t]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3])>>>0}});var go=y((exports,module)=>{"use strict";u();module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(i){}return null}});var Do=y(Ao=>{"use strict";u();var Ar=Ao;Ar.length=function(t){for(var e=0,r=0,n=0;n<t.length;++n)r=t.charCodeAt(n),r<128?e+=1:r<2048?e+=2:(r&64512)===55296&&(t.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e};Ar.read=function(t,e,r){var n=r-e;if(n<1)return"";for(var o=null,s=[],c=0,a;e<r;)a=t[e++],a<128?s[c++]=a:a>191&&a<224?s[c++]=(a&31)<<6|t[e++]&63:a>239&&a<365?(a=((a&7)<<18|(t[e++]&63)<<12|(t[e++]&63)<<6|t[e++]&63)-65536,s[c++]=55296+(a>>10),s[c++]=56320+(a&1023)):s[c++]=(a&15)<<12|(t[e++]&63)<<6|t[e++]&63,c>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),c=0);return o?(c&&o.push(String.fromCharCode.apply(String,s.slice(0,c))),o.join("")):String.fromCharCode.apply(String,s.slice(0,c))};Ar.write=function(t,e,r){for(var n=r,o,s,c=0;c<t.length;++c)o=t.charCodeAt(c),o<128?e[r++]=o:o<2048?(e[r++]=o>>6|192,e[r++]=o&63|128):(o&64512)===55296&&((s=t.charCodeAt(c+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++c,e[r++]=o>>18|240,e[r++]=o>>12&63|128,e[r++]=o>>6&63|128,e[r++]=o&63|128):(e[r++]=o>>12|224,e[r++]=o>>6&63|128,e[r++]=o&63|128);return r-n}});var Po=y((vh,wo)=>{"use strict";u();wo.exports=Ba;function Ba(i,t,e){var r=e||8192,n=r>>>1,o=null,s=r;return function(a){if(a<1||a>n)return i(a);s+a>r&&(o=i(r),s=0);var l=t.call(o,s,s+=a);return s&7&&(s=(s|7)+1),l}}});var Lo=y((bh,Uo)=>{"use strict";u();Uo.exports=J;var Je=Ft();function J(i,t){this.lo=i>>>0,this.hi=t>>>0}var ce=J.zero=new J(0,0);ce.toNumber=function(){return 0};ce.zzEncode=ce.zzDecode=function(){return this};ce.length=function(){return 1};var ka=J.zeroHash="\0\0\0\0\0\0\0\0";J.fromNumber=function(t){if(t===0)return ce;var e=t<0;e&&(t=-t);var r=t>>>0,n=(t-r)/4294967296>>>0;return e&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new J(r,n)};J.from=function(t){if(typeof t=="number")return J.fromNumber(t);if(Je.isString(t))if(Je.Long)t=Je.Long.fromString(t);else return J.fromNumber(parseInt(t,10));return t.low||t.high?new J(t.low>>>0,t.high>>>0):ce};J.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=~this.lo+1>>>0,r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+r*4294967296)}return this.lo+this.hi*4294967296};J.prototype.toLong=function(t){return Je.Long?new Je.Long(this.lo|0,this.hi|0,Boolean(t)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(t)}};var Vt=String.prototype.charCodeAt;J.fromHash=function(t){return t===ka?ce:new J((Vt.call(t,0)|Vt.call(t,1)<<8|Vt.call(t,2)<<16|Vt.call(t,3)<<24)>>>0,(Vt.call(t,4)|Vt.call(t,5)<<8|Vt.call(t,6)<<16|Vt.call(t,7)<<24)>>>0)};J.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};J.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this};J.prototype.zzDecode=function(){var t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this};J.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:r<128?9:10}});var Ft=y(Dr=>{"use strict";u();var S=Dr;S.asPromise=Eo();S.base64=So();S.EventEmitter=Oo();S.float=mo();S.inquire=go();S.utf8=Do();S.pool=Po();S.LongBits=Lo();S.isNode=Boolean(typeof window!="undefined"&&window&&window.process&&window.process.versions&&window.process.versions.node);S.global=S.isNode&&window||typeof window!="undefined"&&window||typeof self!="undefined"&&self||Dr;S.emptyArray=Object.freeze?Object.freeze([]):[];S.emptyObject=Object.freeze?Object.freeze({}):{};S.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};S.isString=function(t){return typeof t=="string"||t instanceof String};S.isObject=function(t){return t&&typeof t=="object"};S.isset=S.isSet=function(t,e){var r=t[e];return r!=null&&t.hasOwnProperty(e)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};S.Buffer=function(){try{var i=S.inquire("buffer").Buffer;return i.prototype.utf8Write?i:null}catch(t){return null}}();S._Buffer_from=null;S._Buffer_allocUnsafe=null;S.newBuffer=function(t){return typeof t=="number"?S.Buffer?S._Buffer_allocUnsafe(t):new S.Array(t):S.Buffer?S._Buffer_from(t):typeof Uint8Array=="undefined"?t:new Uint8Array(t)};S.Array=typeof Uint8Array!="undefined"?Uint8Array:Array;S.Long=S.global.dcodeIO&&S.global.dcodeIO.Long||S.global.Long||S.inquire("long");S.key2Re=/^true|false|0|1$/;S.key32Re=/^-?(?:0|[1-9][0-9]*)$/;S.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;S.longToHash=function(t){return t?S.LongBits.from(t).toHash():S.LongBits.zeroHash};S.longFromHash=function(t,e){var r=S.LongBits.fromHash(t);return S.Long?S.Long.fromBits(r.lo,r.hi,e):r.toNumber(Boolean(e))};function Mo(i,t,e){for(var r=Object.keys(t),n=0;n<r.length;++n)(i[r[n]]===void 0||!e)&&(i[r[n]]=t[r[n]]);return i}S.merge=Mo;S.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)};function Bo(i){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&Mo(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return i}}),t.prototype.toString=function(){return this.name+": "+this.message},t}S.newError=Bo;S.ProtocolError=Bo("ProtocolError");S.oneOfGetter=function(t){for(var e={},r=0;r<t.length;++r)e[t[r]]=1;return function(){for(var n=Object.keys(this),o=n.length-1;o>-1;--o)if(e[n[o]]===1&&this[n[o]]!==void 0&&this[n[o]]!==null)return n[o]}};S.oneOfSetter=function(t){return function(e){for(var r=0;r<t.length;++r)t[r]!==e&&delete this[t[r]]}};S.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};S._configure=function(){var i=S.Buffer;if(!i){S._Buffer_from=S._Buffer_allocUnsafe=null;return}S._Buffer_from=i.from!==Uint8Array.from&&i.from||function(e,r){return new i(e,r)},S._Buffer_allocUnsafe=i.allocUnsafe||function(e){return new i(e)}}});var kr=y((gh,Vo)=>{"use strict";u();Vo.exports=g;var ht=Ft(),wr,Mi=ht.LongBits,ko=ht.base64,xo=ht.utf8;function Ke(i,t,e){this.fn=i,this.len=t,this.next=void 0,this.val=e}function Ur(){}function xa(i){this.head=i.head,this.tail=i.tail,this.len=i.len,this.next=i.states}function g(){this.len=0,this.head=new Ke(Ur,0,0),this.tail=this.head,this.states=null}var jo=function(){return ht.Buffer?function(){return(g.create=function(){return new wr})()}:function(){return new g}};g.create=jo();g.alloc=function(t){return new ht.Array(t)};ht.Array!==Array&&(g.alloc=ht.pool(g.alloc,ht.Array.prototype.subarray));g.prototype._push=function(t,e,r){return this.tail=this.tail.next=new Ke(t,e,r),this.len+=e,this};function Lr(i,t,e){t[e]=i&255}function ja(i,t,e){for(;i>127;)t[e++]=i&127|128,i>>>=7;t[e]=i}function Mr(i,t){this.len=i,this.next=void 0,this.val=t}Mr.prototype=Object.create(Ke.prototype);Mr.prototype.fn=ja;g.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new Mr((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};g.prototype.int32=function(t){return t<0?this._push(Br,10,Mi.fromNumber(t)):this.uint32(t)};g.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)};function Br(i,t,e){for(;i.hi;)t[e++]=i.lo&127|128,i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;i.lo>127;)t[e++]=i.lo&127|128,i.lo=i.lo>>>7;t[e++]=i.lo}g.prototype.uint64=function(t){var e=Mi.from(t);return this._push(Br,e.length(),e)};g.prototype.int64=g.prototype.uint64;g.prototype.sint64=function(t){var e=Mi.from(t).zzEncode();return this._push(Br,e.length(),e)};g.prototype.bool=function(t){return this._push(Lr,1,t?1:0)};function Pr(i,t,e){t[e]=i&255,t[e+1]=i>>>8&255,t[e+2]=i>>>16&255,t[e+3]=i>>>24}g.prototype.fixed32=function(t){return this._push(Pr,4,t>>>0)};g.prototype.sfixed32=g.prototype.fixed32;g.prototype.fixed64=function(t){var e=Mi.from(t);return this._push(Pr,4,e.lo)._push(Pr,4,e.hi)};g.prototype.sfixed64=g.prototype.fixed64;g.prototype.float=function(t){return this._push(ht.float.writeFloatLE,4,t)};g.prototype.double=function(t){return this._push(ht.float.writeDoubleLE,8,t)};var Va=ht.Array.prototype.set?function(t,e,r){e.set(t,r)}:function(t,e,r){for(var n=0;n<t.length;++n)e[r+n]=t[n]};g.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(Lr,1,0);if(ht.isString(t)){var r=g.alloc(e=ko.length(t));ko.decode(t,r,0),t=r}return this.uint32(e)._push(Va,e,t)};g.prototype.string=function(t){var e=xo.length(t);return e?this.uint32(e)._push(xo.write,e,t):this._push(Lr,1,0)};g.prototype.fork=function(){return this.states=new xa(this),this.head=this.tail=new Ke(Ur,0,0),this.len=0,this};g.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ke(Ur,0,0),this.len=0),this};g.prototype.ldelim=function(){var t=this.head,e=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=t.next,this.tail=e,this.len+=r),this};g.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),r=0;t;)t.fn(t.val,e,r),r+=t.len,t=t.next;return e};g._configure=function(i){wr=i,g.create=jo(),wr._configure()}});var Go=y((Ah,Ho)=>{"use strict";u();Ho.exports=gt;var Fo=kr();(gt.prototype=Object.create(Fo.prototype)).constructor=gt;var Ht=Ft();function gt(){Fo.call(this)}gt._configure=function(){gt.alloc=Ht._Buffer_allocUnsafe,gt.writeBytesBuffer=Ht.Buffer&&Ht.Buffer.prototype instanceof Uint8Array&&Ht.Buffer.prototype.set.name==="set"?function(t,e,r){e.set(t,r)}:function(t,e,r){if(t.copy)t.copy(e,r,0,t.length);else for(var n=0;n<t.length;)e[r++]=t[n++]}};gt.prototype.bytes=function(t){Ht.isString(t)&&(t=Ht._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(gt.writeBytesBuffer,e,t),this};function Fa(i,t,e){i.length<40?Ht.utf8.write(i,t,e):t.utf8Write?t.utf8Write(i,e):t.write(i,e)}gt.prototype.string=function(t){var e=Ht.Buffer.byteLength(t);return this.uint32(e),e&&this._push(Fa,e,t),this};gt._configure()});var Vr=y((Dh,Ko)=>{"use strict";u();Ko.exports=x;var At=Ft(),jr,Yo=At.LongBits,Ha=At.utf8;function Rt(i,t){return RangeError("index out of range: "+i.pos+" + "+(t||1)+" > "+i.len)}function x(i){this.buf=i,this.pos=0,this.len=i.length}var qo=typeof Uint8Array!="undefined"?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new x(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new x(t);throw Error("illegal buffer")},Jo=function(){return At.Buffer?function(e){return(x.create=function(n){return At.Buffer.isBuffer(n)?new jr(n):qo(n)})(e)}:qo};x.create=Jo();x.prototype._slice=At.Array.prototype.subarray||At.Array.prototype.slice;x.prototype.uint32=function(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Rt(this,10);return t}}();x.prototype.int32=function(){return this.uint32()|0};x.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(t&1)|0};function xr(){var i=new Yo(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(i.lo=(i.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return i;if(i.lo=(i.lo|(this.buf[this.pos]&127)<<28)>>>0,i.hi=(i.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return i;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Rt(this);if(i.lo=(i.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return i}return i.lo=(i.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,i}if(this.len-this.pos>4){for(;t<5;++t)if(i.hi=(i.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return i}else for(;t<5;++t){if(this.pos>=this.len)throw Rt(this);if(i.hi=(i.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return i}throw Error("invalid varint encoding")}x.prototype.bool=function(){return this.uint32()!==0};function Bi(i,t){return(i[t-4]|i[t-3]<<8|i[t-2]<<16|i[t-1]<<24)>>>0}x.prototype.fixed32=function(){if(this.pos+4>this.len)throw Rt(this,4);return Bi(this.buf,this.pos+=4)};x.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Rt(this,4);return Bi(this.buf,this.pos+=4)|0};function Wo(){if(this.pos+8>this.len)throw Rt(this,8);return new Yo(Bi(this.buf,this.pos+=4),Bi(this.buf,this.pos+=4))}x.prototype.float=function(){if(this.pos+4>this.len)throw Rt(this,4);var t=At.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};x.prototype.double=function(){if(this.pos+8>this.len)throw Rt(this,4);var t=At.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};x.prototype.bytes=function(){var t=this.uint32(),e=this.pos,r=this.pos+t;if(r>this.len)throw Rt(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,r):e===r?new this.buf.constructor(0):this._slice.call(this.buf,e,r)};x.prototype.string=function(){var t=this.bytes();return Ha.read(t,0,t.length)};x.prototype.skip=function(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Rt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Rt(this);while(this.buf[this.pos++]&128);return this};x.prototype.skipType=function(i){switch(i){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(i=this.uint32()&7)!==4;)this.skipType(i);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+i+" at offset "+this.pos)}return this};x._configure=function(i){jr=i,x.create=Jo(),jr._configure();var t=At.Long?"toLong":"toNumber";At.merge(x.prototype,{int64:function(){return xr.call(this)[t](!1)},uint64:function(){return xr.call(this)[t](!0)},sint64:function(){return xr.call(this).zzDecode()[t](!1)},fixed64:function(){return Wo.call(this)[t](!0)},sfixed64:function(){return Wo.call(this)[t](!1)}})}});var Xo=y((wh,zo)=>{"use strict";u();zo.exports=ae;var Qo=Vr();(ae.prototype=Object.create(Qo.prototype)).constructor=ae;var $o=Ft();function ae(i){Qo.call(this,i)}ae._configure=function(){$o.Buffer&&(ae.prototype._slice=$o.Buffer.prototype.slice)};ae.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};ae._configure()});var ts=y((Ph,Zo)=>{"use strict";u();Zo.exports=$e;var Fr=Ft();($e.prototype=Object.create(Fr.EventEmitter.prototype)).constructor=$e;function $e(i,t,e){if(typeof i!="function")throw TypeError("rpcImpl must be a function");Fr.EventEmitter.call(this),this.rpcImpl=i,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(e)}$e.prototype.rpcCall=function i(t,e,r,n,o){if(!n)throw TypeError("request must be specified");var s=this;if(!o)return Fr.asPromise(i,s,t,e,r,n);if(!s.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return s.rpcImpl(t,e[s.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(a,l){if(a)return s.emit("error",a,t),o(a);if(l===null){s.end(!0);return}if(!(l instanceof r))try{l=r[s.responseDelimited?"decodeDelimited":"decode"](l)}catch(f){return s.emit("error",f,t),o(f)}return s.emit("data",l,t),o(null,l)})}catch(c){s.emit("error",c,t),setTimeout(function(){o(c)},0);return}};$e.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var is=y(es=>{"use strict";u();var Ga=es;Ga.Service=ts()});var ns=y((Lh,rs)=>{"use strict";u();rs.exports={}});var cs=y(ss=>{"use strict";u();var nt=ss;nt.build="minimal";nt.Writer=kr();nt.BufferWriter=Go();nt.Reader=Vr();nt.BufferReader=Xo();nt.util=Ft();nt.rpc=is();nt.roots=ns();nt.configure=os;function os(){nt.util._configure(),nt.Writer._configure(nt.BufferWriter),nt.Reader._configure(nt.BufferReader)}os()});var us=y((Bh,as)=>{"use strict";u();as.exports=cs()});var ki=y((kh,ls)=>{"use strict";u();var Qe=us(),N=Qe.Reader,ft=Qe.Writer,Gt=Qe.util,b=Qe.roots.default||(Qe.roots.default={});b.AUTH_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="AUTH_UNKNOWN"]=0,t[i[1]="AUTH_ERROR"]=1,t[i[2]="AUTH_REQUEST"]=2,t[i[3]="AUTH_AUTH_SUCCESSFUL"]=3,t[i[4]="AUTH_AUTH_UNSUCCESSFUL"]=4,t[i[100]="AUTH_TOO_MANY_AUTH_ATTEMPTS"]=100,t[i[101]="AUTH_INVALID_MESSAGE"]=101,t[i[102]="AUTH_INVALID_MESSAGE_DATA"]=102,t}();b.AuthMessage=function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.data="",i.prototype.isError=!1,i.prototype.isAck=!1,i.encode=function(e,r){return r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).string(e.data),e.isError!=null&&Object.hasOwnProperty.call(e,"isError")&&r.uint32(24).bool(e.isError),e.isAck!=null&&Object.hasOwnProperty.call(e,"isAck")&&r.uint32(32).bool(e.isAck),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.AuthMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 2:o.data=e.string();break;case 3:o.isError=e.bool();break;case 4:o.isAck=e.bool();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.CLUSTER_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="CLUSTER_UNKNOWN"]=0,t[i[1]="CLUSTER_REMOVE"]=1,t[i[2]="CLUSTER_STATUS"]=2,t}();b.ClusterMessage=function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.data="",i.prototype.isError=!1,i.prototype.isAck=!1,i.prototype.leaderScore=0,i.prototype.role="",i.encode=function(e,r){return r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).string(e.data),e.isError!=null&&Object.hasOwnProperty.call(e,"isError")&&r.uint32(24).bool(e.isError),e.isAck!=null&&Object.hasOwnProperty.call(e,"isAck")&&r.uint32(32).bool(e.isAck),e.leaderScore!=null&&Object.hasOwnProperty.call(e,"leaderScore")&&r.uint32(40).int32(e.leaderScore),e.role!=null&&Object.hasOwnProperty.call(e,"role")&&r.uint32(58).string(e.role),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.ClusterMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 2:o.data=e.string();break;case 3:o.isError=e.bool();break;case 4:o.isAck=e.bool();break;case 5:o.leaderScore=e.int32();break;case 7:o.role=e.string();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.CONNECTION_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="CONNECTION_UNKNOWN"]=0,t[i[1]="CONNECTION_ERROR"]=1,t[i[2]="CONNECTION_PING"]=2,t[i[3]="CONNECTION_PONG"]=3,t[i[4]="CONNECTION_ACCEPT"]=4,t[i[5]="CONNECTION_CHALLENGE"]=5,t[i[6]="CONNECTION_REJECT"]=6,t[i[7]="CONNECTION_REDIRECT"]=7,t[i[8]="CONNECTION_CLOSING"]=8,t[i[9]="CONNECTION_CLOSED"]=9,t[i[100]="CONNECTION_AUTHENTICATION_TIMEOUT"]=100,t[i[101]="CONNECTION_INVALID_MESSAGE"]=101,t}();b.ConnectionMessage=function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.data="",i.prototype.isError=!1,i.prototype.isAck=!1,i.prototype.url="",i.prototype.protocolVersion="",i.prototype.sdkType="",i.prototype.sdkVersion="",i.encode=function(e,r){return r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).string(e.data),e.isError!=null&&Object.hasOwnProperty.call(e,"isError")&&r.uint32(24).bool(e.isError),e.isAck!=null&&Object.hasOwnProperty.call(e,"isAck")&&r.uint32(32).bool(e.isAck),e.url!=null&&Object.hasOwnProperty.call(e,"url")&&r.uint32(42).string(e.url),e.protocolVersion!=null&&Object.hasOwnProperty.call(e,"protocolVersion")&&r.uint32(50).string(e.protocolVersion),e.sdkVersion!=null&&Object.hasOwnProperty.call(e,"sdkVersion")&&r.uint32(58).string(e.sdkVersion),e.sdkType!=null&&Object.hasOwnProperty.call(e,"sdkType")&&r.uint32(66).string(e.sdkType),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.ConnectionMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 2:o.data=e.string();break;case 3:o.isError=e.bool();break;case 4:o.isAck=e.bool();break;case 5:o.url=e.string();break;case 6:o.protocolVersion=e.string();break;case 8:o.sdkType=e.string();break;case 7:o.sdkVersion=e.string();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.EVENT_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="EVENT_UNKNOWN"]=0,t[i[1]="EVENT_ERROR"]=1,t[i[2]="EVENT_EMIT"]=2,t[i[3]="EVENT_SUBSCRIBE"]=3,t[i[4]="EVENT_UNSUBSCRIBE"]=4,t[i[5]="EVENT_LISTEN"]=5,t[i[6]="EVENT_UNLISTEN"]=6,t[i[7]="EVENT_LISTEN_ACCEPT"]=7,t[i[8]="EVENT_LISTEN_REJECT"]=8,t[i[9]="EVENT_SUBSCRIPTION_HAS_PROVIDER"]=9,t[i[10]="EVENT_SUBSCRIPTION_HAS_NO_PROVIDER"]=10,t[i[11]="EVENT_SUBSCRIPTION_FOR_PATTERN_FOUND"]=11,t[i[12]="EVENT_SUBSCRIPTION_FOR_PATTERN_REMOVED"]=12,t[i[100]="EVENT_INVALID_LISTEN_REGEX"]=100,t[i[101]="EVENT_LISTEN_RESPONSE_TIMEOUT"]=101,t[i[102]="EVENT_LISTEN_UNSUCCESSFUL"]=102,t[i[103]="EVENT_MESSAGE_PERMISSION_ERROR"]=103,t[i[104]="EVENT_MESSAGE_DENIED"]=104,t[i[105]="EVENT_INVALID_MESSAGE_DATA"]=105,t[i[106]="EVENT_MULTIPLE_SUBSCRIPTIONS"]=106,t[i[107]="EVENT_NOT_SUBSCRIBED"]=107,t}();b.EventMessage=function(){function i(t){if(this.names=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.data="",i.prototype.correlationId="",i.prototype.isError=!1,i.prototype.isAck=!1,i.prototype.name="",i.prototype.names=Gt.emptyArray,i.prototype.subscription="",i.prototype.originalTOPIC=0,i.prototype.originalAction=0,i.encode=function(e,r){if(r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).string(e.data),e.correlationId!=null&&Object.hasOwnProperty.call(e,"correlationId")&&r.uint32(26).string(e.correlationId),e.isError!=null&&Object.hasOwnProperty.call(e,"isError")&&r.uint32(32).bool(e.isError),e.isAck!=null&&Object.hasOwnProperty.call(e,"isAck")&&r.uint32(40).bool(e.isAck),e.name!=null&&Object.hasOwnProperty.call(e,"name")&&r.uint32(50).string(e.name),e.names!=null&&e.names.length)for(var n=0;n<e.names.length;++n)r.uint32(58).string(e.names[n]);return e.subscription!=null&&Object.hasOwnProperty.call(e,"subscription")&&r.uint32(66).string(e.subscription),e.originalTOPIC!=null&&Object.hasOwnProperty.call(e,"originalTOPIC")&&r.uint32(80).int32(e.originalTOPIC),e.originalAction!=null&&Object.hasOwnProperty.call(e,"originalAction")&&r.uint32(88).int32(e.originalAction),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.EventMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 2:o.data=e.string();break;case 3:o.correlationId=e.string();break;case 4:o.isError=e.bool();break;case 5:o.isAck=e.bool();break;case 6:o.name=e.string();break;case 7:o.names&&o.names.length||(o.names=[]),o.names.push(e.string());break;case 8:o.subscription=e.string();break;case 10:o.originalTOPIC=e.int32();break;case 11:o.originalAction=e.int32();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.TOPIC=function(){var i={},t=Object.create(i);return t[i[0]="UNKNOWN"]=0,t[i[1]="PARSER"]=1,t[i[2]="CONNECTION"]=2,t[i[3]="AUTH"]=3,t[i[4]="EVENT"]=4,t[i[5]="RECORD"]=5,t[i[6]="RPC"]=6,t[i[7]="PRESENCE"]=7,t[i[8]="MONITORING"]=8,t[i[9]="CLUSTER"]=9,t[i[10]="LOCK"]=10,t[i[11]="STATE_REGISTRY"]=11,t[i[100]="ERROR"]=100,t}();b.Message=function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.topic=0,i.prototype.message=Gt.newBuffer([]),i.encode=function(e,r){return r||(r=ft.create()),e.topic!=null&&Object.hasOwnProperty.call(e,"topic")&&r.uint32(16).int32(e.topic),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&r.uint32(26).bytes(e.message),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.Message;e.pos<n;){var s=e.uint32();switch(s>>>3){case 2:o.topic=e.int32();break;case 3:o.message=e.bytes();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.LOCK_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="LOCK_UNKNOWN"]=0,t[i[1]="LOCK_ERROR"]=1,t[i[2]="LOCK_REQUEST"]=2,t[i[3]="LOCK_RESPONSE"]=3,t[i[4]="LOCK_RELEASE"]=4,t}();b.LockMessage=function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.locked=!1,i.encode=function(e,r){return r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.locked!=null&&Object.hasOwnProperty.call(e,"locked")&&r.uint32(24).bool(e.locked),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.LockMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 3:o.locked=e.bool();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.MONITORING_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="MONITORING_UNKNOWN"]=0,t}();b.MonitoringMessage=function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.data="",i.prototype.correlationId="",i.prototype.isError=!1,i.prototype.isAck=!1,i.encode=function(e,r){return r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).string(e.data),e.correlationId!=null&&Object.hasOwnProperty.call(e,"correlationId")&&r.uint32(26).string(e.correlationId),e.isError!=null&&Object.hasOwnProperty.call(e,"isError")&&r.uint32(32).bool(e.isError),e.isAck!=null&&Object.hasOwnProperty.call(e,"isAck")&&r.uint32(40).bool(e.isAck),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.MonitoringMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 2:o.data=e.string();break;case 3:o.correlationId=e.string();break;case 4:o.isError=e.bool();break;case 5:o.isAck=e.bool();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.PARSER_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="PARSER_UNKNOWN"]=0,t[i[1]="PARSER_UNKNOWN_TOPIC"]=1,t[i[2]="PARSER_UNKNOWN_ACTION"]=2,t[i[3]="PARSER_INVALID_MESSAGE"]=3,t[i[4]="PARSER_MESSAGE_PARSE_ERROR"]=4,t[i[5]="PARSER_MAXIMUM_MESSAGE_SIZE_EXCEEDED"]=5,t[i[6]="PARSER_ERROR"]=6,t[i[7]="PARSER_INVALID_META_PARAMS"]=7,t}();b.ParserMessage=function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.data="",i.prototype.originalTOPIC=0,i.prototype.originalAction=0,i.encode=function(e,r){return r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).string(e.data),e.originalTOPIC!=null&&Object.hasOwnProperty.call(e,"originalTOPIC")&&r.uint32(64).int32(e.originalTOPIC),e.originalAction!=null&&Object.hasOwnProperty.call(e,"originalAction")&&r.uint32(72).int32(e.originalAction),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.ParserMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 2:o.data=e.string();break;case 8:o.originalTOPIC=e.int32();break;case 9:o.originalAction=e.int32();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.PRESENCE_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="PRESENCE_UNKNOWN"]=0,t[i[1]="PRESENCE_ERROR"]=1,t[i[2]="PRESENCE_QUERY_ALL"]=2,t[i[3]="PRESENCE_QUERY_ALL_RESPONSE"]=3,t[i[4]="PRESENCE_QUERY"]=4,t[i[5]="PRESENCE_QUERY_RESPONSE"]=5,t[i[6]="PRESENCE_PRESENCE_JOIN"]=6,t[i[7]="PRESENCE_PRESENCE_JOIN_ALL"]=7,t[i[8]="PRESENCE_PRESENCE_LEAVE"]=8,t[i[9]="PRESENCE_PRESENCE_LEAVE_ALL"]=9,t[i[10]="PRESENCE_SUBSCRIBE"]=10,t[i[11]="PRESENCE_UNSUBSCRIBE"]=11,t[i[12]="PRESENCE_SUBSCRIBE_ALL"]=12,t[i[13]="PRESENCE_UNSUBSCRIBE_ALL"]=13,t[i[100]="PRESENCE_INVALID_PRESENCE_USERS"]=100,t[i[101]="PRESENCE_MESSAGE_PERMISSION_ERROR"]=101,t[i[102]="PRESENCE_MESSAGE_DENIED"]=102,t[i[103]="PRESENCE_MULTIPLE_SUBSCRIPTIONS"]=103,t[i[104]="PRESENCE_NOT_SUBSCRIBED"]=104,t}();b.PresenceMessage=function(){function i(t){if(this.names=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.originalTOPIC=0,i.prototype.originalAction=0,i.prototype.data="",i.prototype.correlationId="",i.prototype.isError=!1,i.prototype.isAck=!1,i.prototype.name="",i.prototype.names=Gt.emptyArray,i.encode=function(e,r){if(r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.originalTOPIC!=null&&Object.hasOwnProperty.call(e,"originalTOPIC")&&r.uint32(16).int32(e.originalTOPIC),e.originalAction!=null&&Object.hasOwnProperty.call(e,"originalAction")&&r.uint32(24).int32(e.originalAction),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(34).string(e.data),e.correlationId!=null&&Object.hasOwnProperty.call(e,"correlationId")&&r.uint32(42).string(e.correlationId),e.isError!=null&&Object.hasOwnProperty.call(e,"isError")&&r.uint32(48).bool(e.isError),e.isAck!=null&&Object.hasOwnProperty.call(e,"isAck")&&r.uint32(56).bool(e.isAck),e.name!=null&&Object.hasOwnProperty.call(e,"name")&&r.uint32(66).string(e.name),e.names!=null&&e.names.length)for(var n=0;n<e.names.length;++n)r.uint32(74).string(e.names[n]);return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.PresenceMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 2:o.originalTOPIC=e.int32();break;case 3:o.originalAction=e.int32();break;case 4:o.data=e.string();break;case 5:o.correlationId=e.string();break;case 6:o.isError=e.bool();break;case 7:o.isAck=e.bool();break;case 8:o.name=e.string();break;case 9:o.names&&o.names.length||(o.names=[]),o.names.push(e.string());break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.RECORD_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="RECORD_UNKNOWN"]=0,t[i[1]="RECORD_ERROR"]=1,t[i[2]="RECORD_NOTIFY"]=2,t[i[3]="RECORD_READ"]=3,t[i[4]="RECORD_READ_RESPONSE"]=4,t[i[5]="RECORD_HEAD"]=5,t[i[6]="RECORD_HEAD_RESPONSE"]=6,t[i[7]="RECORD_HEAD_BULK"]=7,t[i[8]="RECORD_HEAD_RESPONSE_BULK"]=8,t[i[9]="RECORD_DELETE"]=9,t[i[10]="RECORD_DELETE_SUCCESS"]=10,t[i[11]="RECORD_DELETE_BULK"]=11,t[i[12]="RECORD_DELETE_BULK_SUCCESS"]=12,t[i[13]="RECORD_DELETED"]=13,t[i[14]="RECORD_WRITE_ACKNOWLEDGEMENT"]=14,t[i[15]="RECORD_CREATE"]=15,t[i[16]="RECORD_CREATEANDUPDATE"]=16,t[i[17]="RECORD_CREATEANDPATCH"]=17,t[i[18]="RECORD_UPDATE"]=18,t[i[19]="RECORD_PATCH"]=19,t[i[20]="RECORD_ERASE"]=20,t[i[21]="RECORD_SUBSCRIBEANDHEAD"]=21,t[i[22]="RECORD_SUBSCRIBEANDREAD"]=22,t[i[23]="RECORD_SUBSCRIBECREATEANDREAD"]=23,t[i[24]="RECORD_SUBSCRIBECREATEANDUPDATE"]=24,t[i[25]="RECORD_SUBSCRIBE"]=25,t[i[26]="RECORD_UNSUBSCRIBE"]=26,t[i[27]="RECORD_LISTEN"]=27,t[i[28]="RECORD_UNLISTEN"]=28,t[i[29]="RECORD_LISTEN_ACCEPT"]=29,t[i[30]="RECORD_LISTEN_REJECT"]=30,t[i[31]="RECORD_SUBSCRIPTION_HAS_PROVIDER"]=31,t[i[32]="RECORD_SUBSCRIPTION_HAS_NO_PROVIDER"]=32,t[i[33]="RECORD_SUBSCRIPTION_FOR_PATTERN_FOUND"]=33,t[i[34]="RECORD_SUBSCRIPTION_FOR_PATTERN_REMOVED"]=34,t[i[100]="RECORD_CACHE_RETRIEVAL_TIMEOUT"]=100,t[i[101]="RECORD_STORAGE_RETRIEVAL_TIMEOUT"]=101,t[i[102]="RECORD_VERSION_EXISTS"]=102,t[i[103]="RECORD_RECORD_LOAD_ERROR"]=103,t[i[104]="RECORD_RECORD_CREATE_ERROR"]=104,t[i[105]="RECORD_RECORD_UPDATE_ERROR"]=105,t[i[106]="RECORD_RECORD_DELETE_ERROR"]=106,t[i[107]="RECORD_RECORD_NOT_FOUND"]=107,t[i[108]="RECORD_INVALID_VERSION"]=108,t[i[109]="RECORD_INVALID_PATCH_ON_HOTPATH"]=109,t[i[110]="RECORD_INVALID_LISTEN_REGEX"]=110,t[i[111]="RECORD_LISTEN_RESPONSE_TIMEOUT"]=111,t[i[112]="RECORD_LISTEN_UNSUCCESSFUL"]=112,t[i[113]="RECORD_RECORD_NOTIFY_ERROR"]=113,t[i[114]="RECORD_MESSAGE_PERMISSION_ERROR"]=114,t[i[115]="RECORD_MESSAGE_DENIED"]=115,t[i[116]="RECORD_INVALID_MESSAGE_DATA"]=116,t[i[117]="RECORD_MULTIPLE_SUBSCRIPTIONS"]=117,t[i[118]="RECORD_NOT_SUBSCRIBED"]=118,t}();b.RecordMessage=function(){function i(t){if(this.names=[],this.versions={},t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.data="",i.prototype.correlationId="",i.prototype.isError=!1,i.prototype.isAck=!1,i.prototype.name="",i.prototype.names=Gt.emptyArray,i.prototype.pattern="",i.prototype.subscription="",i.prototype.originalAction=0,i.prototype.isWriteAck=!1,i.prototype.path="",i.prototype.version=0,i.prototype.versions=Gt.emptyObject,i.encode=function(e,r){if(r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).string(e.data),e.correlationId!=null&&Object.hasOwnProperty.call(e,"correlationId")&&r.uint32(26).string(e.correlationId),e.isError!=null&&Object.hasOwnProperty.call(e,"isError")&&r.uint32(32).bool(e.isError),e.isAck!=null&&Object.hasOwnProperty.call(e,"isAck")&&r.uint32(40).bool(e.isAck),e.name!=null&&Object.hasOwnProperty.call(e,"name")&&r.uint32(50).string(e.name),e.names!=null&&e.names.length)for(var n=0;n<e.names.length;++n)r.uint32(58).string(e.names[n]);if(e.pattern!=null&&Object.hasOwnProperty.call(e,"pattern")&&r.uint32(66).string(e.pattern),e.subscription!=null&&Object.hasOwnProperty.call(e,"subscription")&&r.uint32(74).string(e.subscription),e.originalAction!=null&&Object.hasOwnProperty.call(e,"originalAction")&&r.uint32(80).int32(e.originalAction),e.isWriteAck!=null&&Object.hasOwnProperty.call(e,"isWriteAck")&&r.uint32(88).bool(e.isWriteAck),e.path!=null&&Object.hasOwnProperty.call(e,"path")&&r.uint32(98).string(e.path),e.version!=null&&Object.hasOwnProperty.call(e,"version")&&r.uint32(104).int32(e.version),e.versions!=null&&Object.hasOwnProperty.call(e,"versions"))for(var o=Object.keys(e.versions),n=0;n<o.length;++n)r.uint32(114).fork().uint32(10).string(o[n]).uint32(16).int32(e.versions[o[n]]).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.RecordMessage,s,c;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:o.action=e.int32();break;case 2:o.data=e.string();break;case 3:o.correlationId=e.string();break;case 4:o.isError=e.bool();break;case 5:o.isAck=e.bool();break;case 6:o.name=e.string();break;case 7:o.names&&o.names.length||(o.names=[]),o.names.push(e.string());break;case 8:o.pattern=e.string();break;case 9:o.subscription=e.string();break;case 10:o.originalAction=e.int32();break;case 11:o.isWriteAck=e.bool();break;case 12:o.path=e.string();break;case 13:o.version=e.int32();break;case 14:o.versions===Gt.emptyObject&&(o.versions={});var l=e.uint32()+e.pos;for(s="",c=0;e.pos<l;){var f=e.uint32();switch(f>>>3){case 1:s=e.string();break;case 2:c=e.int32();break;default:e.skipType(f&7);break}}o.versions[s]=c;break;default:e.skipType(a&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.RPC_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="RPC_UNKNOWN"]=0,t[i[1]="RPC_ERROR"]=1,t[i[2]="RPC_REQUEST"]=2,t[i[4]="RPC_ACCEPT"]=4,t[i[5]="RPC_RESPONSE"]=5,t[i[6]="RPC_REJECT"]=6,t[i[7]="RPC_REQUEST_ERROR"]=7,t[i[8]="RPC_PROVIDE"]=8,t[i[9]="RPC_UNPROVIDE"]=9,t[i[100]="RPC_NO_RPC_PROVIDER"]=100,t[i[101]="RPC_ACCEPT_TIMEOUT"]=101,t[i[102]="RPC_MULTIPLE_ACCEPT"]=102,t[i[103]="RPC_INVALID_RPC_CORRELATION_ID"]=103,t[i[104]="RPC_RESPONSE_TIMEOUT"]=104,t[i[105]="RPC_MULTIPLE_RESPONSE"]=105,t[i[106]="RPC_MESSAGE_PERMISSION_ERROR"]=106,t[i[107]="RPC_MESSAGE_DENIED"]=107,t[i[108]="RPC_INVALID_MESSAGE_DATA"]=108,t[i[109]="RPC_MULTIPLE_PROVIDERS"]=109,t[i[110]="RPC_NOT_PROVIDED"]=110,t}();b.RpcMessage=function(){function i(t){if(this.names=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.data="",i.prototype.correlationId="",i.prototype.isError=!1,i.prototype.isAck=!1,i.prototype.names=Gt.emptyArray,i.prototype.name="",i.prototype.originalAction=0,i.prototype.requestorName="",i.prototype.requestorData="",i.encode=function(e,r){if(r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).string(e.data),e.correlationId!=null&&Object.hasOwnProperty.call(e,"correlationId")&&r.uint32(26).string(e.correlationId),e.isError!=null&&Object.hasOwnProperty.call(e,"isError")&&r.uint32(32).bool(e.isError),e.isAck!=null&&Object.hasOwnProperty.call(e,"isAck")&&r.uint32(40).bool(e.isAck),e.names!=null&&e.names.length)for(var n=0;n<e.names.length;++n)r.uint32(50).string(e.names[n]);return e.name!=null&&Object.hasOwnProperty.call(e,"name")&&r.uint32(58).string(e.name),e.originalAction!=null&&Object.hasOwnProperty.call(e,"originalAction")&&r.uint32(72).int32(e.originalAction),e.requestorName!=null&&Object.hasOwnProperty.call(e,"requestorName")&&r.uint32(82).string(e.requestorName),e.requestorData!=null&&Object.hasOwnProperty.call(e,"requestorData")&&r.uint32(90).string(e.requestorData),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.RpcMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 2:o.data=e.string();break;case 3:o.correlationId=e.string();break;case 4:o.isError=e.bool();break;case 5:o.isAck=e.bool();break;case 6:o.names&&o.names.length||(o.names=[]),o.names.push(e.string());break;case 7:o.name=e.string();break;case 9:o.originalAction=e.int32();break;case 10:o.requestorName=e.string();break;case 11:o.requestorData=e.string();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();b.STATE_REGISTRY_TOPIC=function(){var i={},t=Object.create(i);return t[i[0]="STATE_REGISTRY_UNKNOWN"]=0,t[i[11]="STATE_REGISTRY_EVENT_SUBSCRIPTIONS"]=11,t[i[12]="STATE_REGISTRY_RECORD_SUBSCRIPTIONS"]=12,t[i[9]="STATE_REGISTRY_SUBSCRIPTIONS"]=9,t[i[10]="STATE_REGISTRY_ONLINE_USERS"]=10,t[i[24]="STATE_REGISTRY_MONITORING_SUBSCRIPTIONS"]=24,t[i[13]="STATE_REGISTRY_RPC_SUBSCRIPTIONS"]=13,t[i[14]="STATE_REGISTRY_PRESENCE_SUBSCRIPTIONS"]=14,t[i[15]="STATE_REGISTRY_RECORD_LISTEN_PATTERNS"]=15,t[i[16]="STATE_REGISTRY_EVENT_LISTEN_PATTERNS"]=16,t[i[17]="STATE_REGISTRY_RECORD_PUBLISHED_SUBSCRIPTIONS"]=17,t[i[18]="STATE_REGISTRY_EVENT_PUBLISHED_SUBSCRIPTIONS"]=18,t[i[19]="STATE_REGISTRY_RECORD_LISTENING"]=19,t[i[20]="STATE_REGISTRY_EVENT_LISTENING"]=20,t[i[21]="STATE_REGISTRY_STATE_REGISTRY"]=21,t}();b.STATE_ACTION=function(){var i={},t=Object.create(i);return t[i[0]="STATE_UNKNOWN"]=0,t[i[1]="STATE_ERROR"]=1,t[i[2]="STATE_ADD"]=2,t[i[3]="STATE_REMOVE"]=3,t[i[4]="STATE_REQUEST_FULL_STATE"]=4,t[i[5]="STATE_FULL_STATE"]=5,t[i[6]="STATE_CHECKSUM"]=6,t}();b.StateMessage=function(){function i(t){if(this.fullState=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.action=0,i.prototype.data="",i.prototype.isError=!1,i.prototype.checksum=0,i.prototype.fullState=Gt.emptyArray,i.prototype.serverName="",i.prototype.registryTOPIC=0,i.encode=function(e,r){if(r||(r=ft.create()),e.action!=null&&Object.hasOwnProperty.call(e,"action")&&r.uint32(8).int32(e.action),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).string(e.data),e.isError!=null&&Object.hasOwnProperty.call(e,"isError")&&r.uint32(24).bool(e.isError),e.checksum!=null&&Object.hasOwnProperty.call(e,"checksum")&&r.uint32(152).int32(e.checksum),e.fullState!=null&&e.fullState.length)for(var n=0;n<e.fullState.length;++n)r.uint32(162).string(e.fullState[n]);return e.serverName!=null&&Object.hasOwnProperty.call(e,"serverName")&&r.uint32(170).string(e.serverName),e.registryTOPIC!=null&&Object.hasOwnProperty.call(e,"registryTOPIC")&&r.uint32(176).int32(e.registryTOPIC),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof N||(e=N.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new b.StateMessage;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:o.action=e.int32();break;case 2:o.data=e.string();break;case 3:o.isError=e.bool();break;case 19:o.checksum=e.int32();break;case 20:o.fullState&&o.fullState.length||(o.fullState=[]),o.fullState.push(e.string());break;case 21:o.serverName=e.string();break;case 22:o.registryTOPIC=e.int32();break;default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof N||(e=new N(e)),this.decode(e,e.uint32())},i}();ls.exports=b});var Gr=y(Hr=>{"use strict";u();Object.defineProperty(Hr,"__esModule",{value:!0});var H=ki();Hr.TopicMessage={[H.TOPIC.RECORD]:H.RecordMessage,[H.TOPIC.CLUSTER]:H.ClusterMessage,[H.TOPIC.CONNECTION]:H.ConnectionMessage,[H.TOPIC.AUTH]:H.AuthMessage,[H.TOPIC.EVENT]:H.EventMessage,[H.TOPIC.LOCK]:H.LockMessage,[H.TOPIC.MONITORING]:H.MonitoringMessage,[H.TOPIC.PARSER]:H.ParserMessage,[H.TOPIC.PRESENCE]:H.PresenceMessage,[H.TOPIC.RPC]:H.RpcMessage}});var qr=y(xi=>{"use strict";u();Object.defineProperty(xi,"__esModule",{value:!0});var qa=Gr(),Wa=ki(),hs=Ne();function Ya(i){try{let t=Wa.Message.decodeDelimited(i),e=qa.TopicMessage[t.topic].decode(t.message,t.message.length);return[Object.assign({topic:t.topic},e)]}catch(t){return[{topic:hs.TOPIC.PARSER,action:hs.PARSER_ACTION.ERROR}]}}xi.parse=Ya;function Ja(i){return i.requestorData&&(i.requestorData=JSON.parse(i.requestorData)),i.parsedData!==void 0||i.data===void 0?!0:(i.parsedData=JSON.parse(i.data),i.parsedData===void 0?new Error(`unable to parse data ${i.data}`):!0)}xi.parseData=Ja});var Wr=y(ji=>{"use strict";u();Object.defineProperty(ji,"__esModule",{value:!0});ji.StateMachine=void 0;var Ka=function(){function i(t,e){this.stateMachine=e,this.inEndState=!1,this.transitions=e.transitions,this.state=e.init,this.context=e.context,this.history=[{oldState:"-",newState:this.state,transitionName:"-"}]}return i.prototype.transition=function(t){for(var e,r=0;r<this.transitions.length;r++)if(e=this.transitions[r],t===e.name&&(this.state===e.from||e.from===void 0)){this.history.push({oldState:this.state,transitionName:t,newState:e.to});var n=this.state;this.state=e.to,this.stateMachine.onStateChanged&&this.stateMachine.onStateChanged.call(this.context,this.state,n),e.handler&&e.handler.call(this.context);return}var o=JSON.stringify({transition:t,fromState:this.state}),s=this.history.reverse().reduce(function(c,a){return c+=`
	From `+a.oldState+" to "+a.newState+" via "+a.transitionName},"");console.trace(`Invalid state transition.
Details: `+o+` 
History: `+s)},i}();ji.StateMachine=Ka});var Bt=y(K=>{"use strict";u();Object.defineProperty(K,"__esModule",{value:!0});K.PromiseDelay=K.normalizeArguments=K.normalizeSetArguments=K.getUid=K.parseUrl=K.shallowCopy=K.deepCopy=K.deepEquals=void 0;var $a=function(i,t){return i===t?!0:typeof i!="object"||typeof t!="object"?!1:JSON.stringify(i)===JSON.stringify(t)};K.deepEquals=$a;var Qa=function(i){return typeof i=="object"?JSON.parse(JSON.stringify(i)):i};K.deepCopy=Qa;var za=function(i){if(Array.isArray(i))return i.slice(0);if(typeof i=="object"){for(var t=Object.create(null),e=Object.keys(i),r=0;r<e.length;r++)t[e[r]]=i[e[r]];return t}return i};K.shallowCopy=za;var Xa=/^wss:|^ws:|^\/\//,Za=/^http:|^https:/,tu=function(i,t){var e=i;if(Za.test(e))throw new Error("Only ws and wss are supported");Xa.test(e)?e.indexOf("//")===0&&(e="ws:"+e):e="ws://"+e;var r=e.split("//")[0],n=e.split("//")[1];if(!n)throw new Error("Invalid URL: ws://");var o=null;return n.indexOf("/")>-1?(o=n.split("/"),n=o.shift()||"",o="/"+o.join("")):n.indexOf("?")>-1&&(o=n.split("?"),n=o.shift()||"",o=t+"?"+o.join("")),(!o||o==="/")&&(o=t),r+"//"+n+o};K.parseUrl=tu;var eu=function(){var i=new Date().getTime().toString(36),t=(Math.random()*1e16).toString(36).replace(".","");return i+"-"+t};K.getUid=eu;var iu=function(i,t){t===void 0&&(t=0);var e,r=function(c){return c!==void 0&&typeof c=="object"},n=function(c){return typeof c!="function"},o=function(c){return c!==void 0&&typeof c=="string"},s=function(c){return typeof c=="function"};if(i.length===t+1&&(e={path:void 0,data:r(i[t])?i[t]:void 0,callback:void 0}),i.length===t+2&&(e={path:void 0,data:void 0,callback:void 0},!s(i[t])&&n(i[t])&&(e.path=o(i[t])?i[t]:void 0),o(i[t])?e.data=n(i[t+1])?i[t+1]:void 0:e.data=r(i[t])?i[t]:void 0,o(i[t])||(e.callback=s(i[t+1])?i[t+1]:!1)),i.length===t+3&&(e={path:o(i[t])?i[t]:void 0,data:n(i[t+1])?i[t+1]:void 0,callback:s(i[t+2])?i[t+2]:void 0}),e){if(e.path!==void 0&&e.path.length===0||e.path===void 0&&!e.data)throw Error("Invalid set path argument");if(e.data===void 0&&e.path===void 0)throw Error("Invalid set data argument");if(e.callback!==void 0&&e.callback===!1||e.callback===void 0&&i.length===t+3)throw Error("Invalid set callback argument");return e}throw Error("Invalid set arguments")};K.normalizeSetArguments=iu;var ru=function(i){if(i.length===1&&typeof i[0]=="object")return i[0];for(var t=Object.create(null),e=0;e<i.length;e++)typeof i[e]=="string"?t.path=i[e]:typeof i[e]=="function"?t.callback=i[e]:typeof i[e]=="boolean"&&(t.triggerNow=i[e]);return t};K.normalizeArguments=ru;var nu=function(i){return new Promise(function(t){return setTimeout(t,i)})};K.PromiseDelay=nu});var fs=y((Hh,ou)=>{ou.exports={name:"@deepstream/client",version:"5.2.7",description:"the javascript client for deepstream.io",keywords:["deepstream","javascript","realtime","client"],mocha:{recursive:!0,reporter:"dot",require:"ts-node/register/transpile-only",exit:!0},main:"dist/src/deepstream.js",types:"dist/src/deepstream-client.d.ts",directories:{test:"src/test"},scripts:{tsc:"rm -rf dist && tsc",build:"npm run tsc && npm run build:dev && npm run build:prod","build:dev":"webpack --config webpack.dev.js","build:prod":"webpack --config webpack.prod.js",rebuild:"rimraf dist && webpack",clean:"rimraf dist",lint:"tslint src/*.ts src/**/*.ts -t verbose","lint:fix":"npm run lint -- --fix",test:"mocha src/**/*.spec.ts","test:coverage":"nyc npm test","bundle:analyse":"webpack --config webpack.prod.js --profile --json > ./dist/stats.json && webpack-bundle-analyzer ./dist/stats.json",postinstall:"node scripts/postinstall.js"},repository:{type:"git",url:"https://github.com/deepstreamIO/deepstream.io-client-js.git"},dependencies:{"@deepstream/protobuf":"^1.0.4",protobufjs:"^6.10.2",ws:"^7.4.0"},browser:{net:!1,ws:!1},devDependencies:{"@istanbuljs/nyc-config-typescript":"^1.0.1","@types/chai":"^4.2.14","@types/mocha":"^8.0.4","@types/node":"^14.14.9","@types/sinon":"^9.0.9","@types/ws":"^7.4.0",chai:"^4.2.0",coveralls:"^3.1.0",husky:"^4.3.0",mocha:"^8.2.1","mocha-lcov-reporter":"^1.3.0",nyc:"^15.1.0",rimraf:"^3.0.2",sinon:"^9.2.1","terser-webpack-plugin":"^4.2.3","ts-essentials":"^7.0.1","ts-loader":"^8.0.11","ts-node":"^9.1.1",tslint:"^6.1.3",typescript:"^4.1.2","uglifyjs-webpack-plugin":"^2.2.0",webpack:"^4.44.2","webpack-bundle-analyzer":"^3.9.0","webpack-cli":"^3.3.12"},author:"deepstreamHub GmbH",license:"MIT",bugs:{url:"https://github.com/deepstreamIO/deepstream.io-client-js/issues"},homepage:"http://deepstream.io",eslintConfig:{extends:"deepstream"},husky:{hooks:{"pre-commit":"npm t && npm run lint && npm run build","pre-publish":"npm t && npm run build"}},nyc:{extends:"@istanbuljs/nyc-config-typescript",include:["src/**/*.ts"],exclude:["src/**/*.spec.ts"],extension:[".ts"],require:["ts-node/register"],reporter:["lcov"]}}});var Es=y(Vi=>{"use strict";u();Object.defineProperty(Vi,"__esModule",{value:!0});Vi.Connection=void 0;var d=F(),su=qr(),cu=Wr(),ds=Bt(),au=mt(),uu=fs(),lu=function(){function i(t,e,r,n){var o=this;this.services=t,this.options=e,this.reconnectTimeout=null,this.authParams=null,this.handlers=new Map,this.authCallback=null,this.resumeCallback=null,this.emitter=n,this.internalEmitter=new au.Emitter,this.isInLimbo=!0,this.clientData=null,this.heartbeatIntervalTimeout=null,this.endpoint=null,this.reconnectionAttempt=0,this.limboTimeout=null;var s=!1,c=!0;this.stateMachine=new cu.StateMachine(this.services.logger,{init:d.CONNECTION_STATE.CLOSED,onStateChanged:function(a,l){a!==l&&(n.emit(d.EVENT.CONNECTION_STATE_CHANGED,a),a===d.CONNECTION_STATE.RECONNECTING?(o.isInLimbo=!0,s=!0,l!==d.CONNECTION_STATE.CLOSED&&(o.internalEmitter.emit(d.EVENT.CONNECTION_LOST),o.limboTimeout=o.services.timerRegistry.add({duration:o.options.offlineBufferTimeout,context:o,callback:function(){o.isInLimbo=!1,o.internalEmitter.emit(d.EVENT.EXIT_LIMBO)}}))):a===d.CONNECTION_STATE.OPEN&&(s||c)&&(c=!1,o.isInLimbo=!1,o.internalEmitter.emit(d.EVENT.CONNECTION_REESTABLISHED),o.services.timerRegistry.remove(o.limboTimeout)))},transitions:[{name:"initialised",from:d.CONNECTION_STATE.CLOSED,to:d.CONNECTION_STATE.INITIALISING},{name:"connected",from:d.CONNECTION_STATE.INITIALISING,to:d.CONNECTION_STATE.AWAITING_CONNECTION},{name:"connected",from:d.CONNECTION_STATE.REDIRECTING,to:d.CONNECTION_STATE.AWAITING_CONNECTION},{name:"connected",from:d.CONNECTION_STATE.RECONNECTING,to:d.CONNECTION_STATE.AWAITING_CONNECTION},{name:"challenge",from:d.CONNECTION_STATE.AWAITING_CONNECTION,to:d.CONNECTION_STATE.CHALLENGING},{name:"redirected",from:d.CONNECTION_STATE.CHALLENGING,to:d.CONNECTION_STATE.REDIRECTING},{name:"challenge-denied",from:d.CONNECTION_STATE.CHALLENGING,to:d.CONNECTION_STATE.CHALLENGE_DENIED},{name:"accepted",from:d.CONNECTION_STATE.CHALLENGING,to:d.CONNECTION_STATE.AWAITING_AUTHENTICATION,handler:this.onAwaitingAuthentication.bind(this)},{name:"authentication-timeout",from:d.CONNECTION_STATE.AWAITING_CONNECTION,to:d.CONNECTION_STATE.AUTHENTICATION_TIMEOUT},{name:"authentication-timeout",from:d.CONNECTION_STATE.AWAITING_AUTHENTICATION,to:d.CONNECTION_STATE.AUTHENTICATION_TIMEOUT},{name:"authenticate",from:d.CONNECTION_STATE.AWAITING_AUTHENTICATION,to:d.CONNECTION_STATE.AUTHENTICATING},{name:"unsuccesful-login",from:d.CONNECTION_STATE.AUTHENTICATING,to:d.CONNECTION_STATE.AWAITING_AUTHENTICATION},{name:"succesful-login",from:d.CONNECTION_STATE.AUTHENTICATING,to:d.CONNECTION_STATE.OPEN},{name:"too-many-auth-attempts",from:d.CONNECTION_STATE.AUTHENTICATING,to:d.CONNECTION_STATE.TOO_MANY_AUTH_ATTEMPTS},{name:"too-many-auth-attempts",from:d.CONNECTION_STATE.AWAITING_AUTHENTICATION,to:d.CONNECTION_STATE.TOO_MANY_AUTH_ATTEMPTS},{name:"authentication-timeout",from:d.CONNECTION_STATE.AWAITING_AUTHENTICATION,to:d.CONNECTION_STATE.AUTHENTICATION_TIMEOUT},{name:"reconnect",from:d.CONNECTION_STATE.RECONNECTING,to:d.CONNECTION_STATE.RECONNECTING},{name:"closed",from:d.CONNECTION_STATE.CLOSING,to:d.CONNECTION_STATE.CLOSED},{name:"offline",from:d.CONNECTION_STATE.PAUSING,to:d.CONNECTION_STATE.OFFLINE},{name:"error",to:d.CONNECTION_STATE.RECONNECTING},{name:"connection-lost",to:d.CONNECTION_STATE.RECONNECTING},{name:"resume",to:d.CONNECTION_STATE.RECONNECTING},{name:"pause",to:d.CONNECTION_STATE.PAUSING},{name:"close",to:d.CONNECTION_STATE.CLOSING}]}),this.stateMachine.transition("initialised"),this.originalUrl=ds.parseUrl(r,this.options.path),this.url=this.originalUrl,e.lazyConnect||this.createEndpoint()}return Object.defineProperty(i.prototype,"isConnected",{get:function(){return this.stateMachine.state===d.CONNECTION_STATE.OPEN},enumerable:!1,configurable:!0}),i.prototype.onLost=function(t){this.internalEmitter.on(d.EVENT.CONNECTION_LOST,t)},i.prototype.removeOnLost=function(t){this.internalEmitter.off(d.EVENT.CONNECTION_LOST,t)},i.prototype.onReestablished=function(t){this.internalEmitter.on(d.EVENT.CONNECTION_REESTABLISHED,t)},i.prototype.removeOnReestablished=function(t){this.internalEmitter.off(d.EVENT.CONNECTION_REESTABLISHED,t)},i.prototype.onExitLimbo=function(t){this.internalEmitter.on(d.EVENT.EXIT_LIMBO,t)},i.prototype.registerHandler=function(t,e){this.handlers.set(t,e)},i.prototype.sendMessage=function(t){if(!this.isOpen()){this.services.logger.error(t,d.EVENT.IS_CLOSED);return}this.endpoint&&this.endpoint.sendParsedMessage(t)},i.prototype.authenticate=function(t,e){if(t&&typeof t!="object"&&typeof t!="function")throw new Error("invalid argument authParamsOrCallback");if(e&&typeof e!="function")throw new Error("invalid argument callback");if(this.stateMachine.state===d.CONNECTION_STATE.CHALLENGE_DENIED||this.stateMachine.state===d.CONNECTION_STATE.TOO_MANY_AUTH_ATTEMPTS||this.stateMachine.state===d.CONNECTION_STATE.AUTHENTICATION_TIMEOUT){this.services.logger.error({topic:d.TOPIC.CONNECTION},d.EVENT.IS_CLOSED);return}t&&(this.authParams=typeof t=="object"?t:{}),t&&typeof t=="function"?this.authCallback=t:e?this.authCallback=e:this.authCallback=function(){},this.stateMachine.state===d.CONNECTION_STATE.AWAITING_AUTHENTICATION&&this.authParams&&this.sendAuthParams(),this.endpoint||this.createEndpoint()},i.prototype.getConnectionState=function(){return this.stateMachine.state},i.prototype.isOpen=function(){var t=this.getConnectionState();return t!==d.CONNECTION_STATE.CLOSED&&t!==d.CONNECTION_STATE.ERROR&&t!==d.CONNECTION_STATE.CLOSING},i.prototype.close=function(){this.services.timerRegistry.remove(this.heartbeatIntervalTimeout),this.sendMessage({topic:d.TOPIC.CONNECTION,action:d.CONNECTION_ACTION.CLOSING}),this.stateMachine.transition("close")},i.prototype.pause=function(){this.stateMachine.transition("pause"),this.services.timerRegistry.remove(this.heartbeatIntervalTimeout),this.endpoint&&this.endpoint.close()},i.prototype.resume=function(t){this.stateMachine.transition("resume"),this.resumeCallback=t,this.tryReconnect()},i.prototype.createEndpoint=function(){this.endpoint=this.services.socketFactory(this.url,this.options.socketOptions,this.options.heartbeatInterval),this.endpoint.onopened=this.onOpen.bind(this),this.endpoint.onerror=this.onError.bind(this),this.endpoint.onclosed=this.onClose.bind(this),this.endpoint.onparsedmessages=this.onMessages.bind(this)},i.prototype.onOpen=function(){this.clearReconnect(),this.checkHeartBeat(),this.stateMachine.transition("connected"),this.sendMessage({topic:d.TOPIC.CONNECTION,action:d.CONNECTION_ACTION.CHALLENGE,url:this.originalUrl,protocolVersion:"0.1a",sdkVersion:uu.version,sdkType:"javascript"}),this.stateMachine.transition("challenge")},i.prototype.onError=function(t){var e=this;setTimeout(function(){var r;t.code==="ECONNRESET"||t.code==="ECONNREFUSED"?r="Can't connect! Deepstream server unreachable on "+e.originalUrl:r=t,e.services.logger.error({topic:d.TOPIC.CONNECTION},d.EVENT.CONNECTION_ERROR,r)},1),this.services.timerRegistry.remove(this.heartbeatIntervalTimeout),this.stateMachine.transition("error"),this.tryReconnect()},i.prototype.onClose=function(){if(this.services.timerRegistry.remove(this.heartbeatIntervalTimeout),this.stateMachine.state===d.CONNECTION_STATE.REDIRECTING){this.createEndpoint();return}if(!(this.stateMachine.state===d.CONNECTION_STATE.CHALLENGE_DENIED||this.stateMachine.state===d.CONNECTION_STATE.TOO_MANY_AUTH_ATTEMPTS||this.stateMachine.state===d.CONNECTION_STATE.AUTHENTICATION_TIMEOUT)){if(this.stateMachine.state===d.CONNECTION_STATE.CLOSING){this.stateMachine.transition("closed");return}if(this.stateMachine.state===d.CONNECTION_STATE.PAUSING){this.stateMachine.transition("offline");return}this.stateMachine.transition("connection-lost"),this.tryReconnect()}},i.prototype.onMessages=function(t){var e=this;t.forEach(function(r){if(r.parseError){e.services.logger.error({topic:d.TOPIC.PARSER},r.action,r.raw&&r.raw.toString());return}var n=r,o=su.parseData(n);if(o!==!0&&e.services.logger.error({topic:d.TOPIC.PARSER},d.PARSER_ACTION.INVALID_MESSAGE,o),n!==null){if(n.topic===d.TOPIC.CONNECTION){e.handleConnectionResponse(n);return}if(n.topic===d.TOPIC.AUTH){e.handleAuthResponse(n);return}var s=e.handlers.get(n.topic);!s||s(n)}})},i.prototype.sendAuthParams=function(){this.stateMachine.transition("authenticate"),this.sendMessage({topic:d.TOPIC.AUTH,action:d.AUTH_ACTION.REQUEST,parsedData:this.authParams})},i.prototype.checkHeartBeat=function(){var t=this.options.heartbeatInterval*2;if(!!this.endpoint){if(this.endpoint.getTimeSinceLastMessage()>t){this.services.timerRegistry.remove(this.heartbeatIntervalTimeout),this.services.logger.error({topic:d.TOPIC.CONNECTION},d.EVENT.HEARTBEAT_TIMEOUT),this.endpoint.close();return}this.heartbeatIntervalTimeout=this.services.timerRegistry.add({duration:this.options.heartbeatInterval,callback:this.checkHeartBeat,context:this})}},i.prototype.tryReconnect=function(){if(this.reconnectTimeout===null){if(this.reconnectionAttempt<this.options.maxReconnectAttempts){this.stateMachine.transition("reconnect"),this.reconnectTimeout=this.services.timerRegistry.add({callback:this.tryOpen,context:this,duration:Math.min(this.options.maxReconnectInterval,this.options.reconnectIntervalIncrement*this.reconnectionAttempt)}),this.reconnectionAttempt++;return}this.emitter.emit(d.EVENT[d.EVENT.MAX_RECONNECTION_ATTEMPTS_REACHED],this.reconnectionAttempt),this.clearReconnect(),this.close()}},i.prototype.tryOpen=function(){this.stateMachine.state!==d.CONNECTION_STATE.REDIRECTING&&(this.url=this.originalUrl),this.createEndpoint(),this.reconnectTimeout=null},i.prototype.clearReconnect=function(){this.services.timerRegistry.remove(this.reconnectTimeout),this.reconnectTimeout=null,this.reconnectionAttempt=0},i.prototype.handleConnectionResponse=function(t){if(t.action===d.CONNECTION_ACTION.ACCEPT){this.stateMachine.transition("accepted");return}if(t.action===d.CONNECTION_ACTION.REJECT){this.stateMachine.transition("challenge-denied"),this.endpoint&&this.endpoint.close();return}if(t.action===d.CONNECTION_ACTION.REDIRECT){this.url=t.url,this.stateMachine.transition("redirected"),this.endpoint&&this.endpoint.close();return}t.action===d.CONNECTION_ACTION.AUTHENTICATION_TIMEOUT&&(this.stateMachine.transition("authentication-timeout"),this.services.logger.error(t))},i.prototype.handleAuthResponse=function(t){if(t.action===d.AUTH_ACTION.TOO_MANY_AUTH_ATTEMPTS){this.stateMachine.transition("too-many-auth-attempts"),this.services.logger.error(t);return}if(t.action===d.AUTH_ACTION.AUTH_UNSUCCESSFUL){this.stateMachine.transition("unsuccesful-login"),this.onAuthUnSuccessful();return}if(t.action===d.AUTH_ACTION.AUTH_SUCCESSFUL){this.stateMachine.transition("succesful-login"),this.onAuthSuccessful(t.parsedData);return}},i.prototype.onAwaitingAuthentication=function(){this.authParams&&this.sendAuthParams()},i.prototype.onAuthSuccessful=function(t){this.updateClientData(t),this.resumeCallback&&(this.resumeCallback(),this.resumeCallback=null),this.authCallback!==null&&(this.authCallback(!0,this.clientData),this.authCallback=null)},i.prototype.onAuthUnSuccessful=function(){var t={reason:d.EVENT[d.EVENT.INVALID_AUTHENTICATION_DETAILS]};if(this.resumeCallback&&(this.resumeCallback(t),this.resumeCallback=null),this.authCallback===null){this.emitter.emit(d.EVENT.REAUTHENTICATION_FAILURE,t);return}this.authCallback(!1,t),this.authCallback=null},i.prototype.updateClientData=function(t){var e=t||null;this.clientData===null&&(e===null||Object.keys(e).length===0)||ds.deepEquals(this.clientData,t)||(this.emitter.emit(d.EVENT.CLIENT_DATA_CHANGED,Object.assign({},e)),this.clientData=e)},i}();Vi.Connection=lu});var ps=y(Yr=>{"use strict";u();Object.defineProperty(Yr,"__esModule",{value:!0});var hu=Gr(),fu=ki();function du(i,t){t&&!i.isAck&&(i=Object.assign(Object.assign({},i),{isAck:!0})),i.data===void 0&&i.parsedData!==void 0&&(i.data=JSON.stringify(i.parsedData)),i.requestorData&&(i.requestorData=JSON.stringify(i.requestorData));let e=hu.TopicMessage[i.topic].encode(i).finish();return fu.Message.encodeDelimited({topic:i.topic,message:e}).finish()}Yr.getMessage=du});var Rs=y(()=>{u()});var ys=y(ve=>{"use strict";u();var Hi=ve&&ve.__assign||function(){return Hi=Object.assign||function(i){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Hi.apply(this,arguments)};Object.defineProperty(ve,"__esModule",{value:!0});ve.socketFactory=void 0;var Eu=qr(),pu=ps(),Ce=F(),Fi=window.WebSocket||window.MozWebSocket,Ru=function(i,t,e){t===void 0&&(t={jsonTransportMode:!1});var r=Fi?new Fi(i,[],t):new(Rs())(i,t);Fi&&t.jsonTransportMode!==!0&&(r.binaryType="arraybuffer");var n=t.jsonTransportMode!==!0?pu.getMessage:function(a,l){return JSON.stringify(Hi(Hi({},a),{isAck:l}))},o=n({topic:Ce.TOPIC.CONNECTION,action:Ce.CONNECTION_ACTION.PING},!1),s=null,c=-1;return r.onparsedmessage=function(){},r.onmessage=function(a){c=Date.now();var l;t.jsonTransportMode!==!0?l=Eu.parse(Fi?new Buffer(new Uint8Array(a.data)):a.data):l=[JSON.parse(a.data)],r.onparsedmessages(l)},r.getTimeSinceLastMessage=function(){return c<0?0:Date.now()-c},r.sendParsedMessage=function(a){if(a.topic===Ce.TOPIC.CONNECTION&&a.action===Ce.CONNECTION_ACTION.CLOSING){r.onparsedmessages([{topic:Ce.TOPIC.CONNECTION,action:Ce.CONNECTION_ACTION.CLOSED}]),r.close();return}a.parsedData&&(a.data=JSON.stringify(a.parsedData)),a.data===void 0&&delete a.data,r.send(n(a,!1))},r.onclosed=null,r.onclose=function(){clearInterval(s),r.onclosed()},r.onopened=null,r.onopen=function(){s=setInterval(function(){try{r.send(o)}catch(a){clearTimeout(s)}},e),r.onopened()},r};ve.socketFactory=Ru});var Jr=y(Gi=>{"use strict";u();Object.defineProperty(Gi,"__esModule",{value:!0});Gi.Listener=void 0;var ue=F(),yu=function(){function i(t,e){this.topic=t,this.services=e,this.listeners=new Map,this.stopCallbacks=new Map,t===ue.TOPIC.RECORD?this.actions=ue.RECORD_ACTION:t===ue.TOPIC.EVENT&&(this.actions=ue.EVENT_ACTION),this.services.connection.onLost(this.onConnectionLost.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this))}return i.prototype.listen=function(t,e){if(typeof t!="string"||t.length===0)throw new Error("invalid argument pattern");if(typeof e!="function")throw new Error("invalid argument callback");if(this.listeners.has(t)){this.services.logger.warn({topic:this.topic,action:this.actions.LISTEN,name:t},ue.EVENT.LISTENER_EXISTS);return}this.listeners.set(t,e),this.sendListen(t)},i.prototype.unlisten=function(t){if(typeof t!="string"||t.length===0)throw new Error("invalid argument pattern");if(!this.listeners.has(t)){this.services.logger.warn({topic:this.topic,action:this.actions.UNLISTEN,name:t},ue.EVENT.NOT_LISTENING);return}this.listeners.delete(t),this.sendUnlisten(t)},i.prototype.accept=function(t,e){this.services.connection.sendMessage({topic:this.topic,action:this.actions.LISTEN_ACCEPT,name:t,subscription:e})},i.prototype.reject=function(t,e){this.services.connection.sendMessage({topic:this.topic,action:this.actions.LISTEN_REJECT,name:t,subscription:e})},i.prototype.stop=function(t,e){this.stopCallbacks.set(t,e)},i.prototype.handle=function(t){if(t.isAck){this.services.timeoutRegistry.remove(t);return}if(t.action===this.actions.SUBSCRIPTION_FOR_PATTERN_FOUND){var e=this.listeners.get(t.name);e&&e(t.subscription,{accept:this.accept.bind(this,t.name,t.subscription),reject:this.reject.bind(this,t.name,t.subscription),onStop:this.stop.bind(this,t.subscription)});return}if(t.action===this.actions.SUBSCRIPTION_FOR_PATTERN_REMOVED){var r=this.stopCallbacks.get(t.subscription);r&&(r(t.subscription),this.stopCallbacks.delete(t.subscription));return}this.services.logger.error(t,ue.EVENT.UNSOLICITED_MESSAGE)},i.prototype.onConnectionLost=function(){this.stopCallbacks.forEach(function(t,e){t(e)}),this.stopCallbacks.clear()},i.prototype.onConnectionReestablished=function(){var t=this;this.listeners.forEach(function(e,r){t.sendListen(r)})},i.prototype.sendListen=function(t){var e={topic:this.topic,action:this.actions.LISTEN,name:t};this.services.timeoutRegistry.add({message:e}),this.services.connection.sendMessage(e)},i.prototype.sendUnlisten=function(t){var e={topic:this.topic,action:this.actions.UNLISTEN,name:t};this.services.timeoutRegistry.add({message:e}),this.services.connection.sendMessage(e)},i}();Gi.Listener=yu});var ze=y(qt=>{"use strict";u();var Su=qt&&qt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o},Ss=qt&&qt.__spread||function(){for(var i=[],t=0;t<arguments.length;t++)i=i.concat(Su(arguments[t]));return i};Object.defineProperty(qt,"__esModule",{value:!0});qt.BulkSubscriptionService=void 0;var _u=function(){function i(t,e,r,n,o,s){s===void 0&&(s=function(){}),this.services=t,this.subscriptionInterval=e,this.topic=r,this.subscribeBulkAction=n,this.unsubscribeBulkAction=o,this.onSubscriptionSent=s,this.subscribeNames=new Set,this.unsubscribeNames=new Set,this.timerRef=-1,this.correlationId=0,this.services.connection.onLost(this.onLost.bind(this))}return i.prototype.subscribe=function(t){if(this.subscriptionInterval>0){this.unsubscribeNames.has(t)?this.unsubscribeNames.delete(t):(this.subscribeNames.add(t),this.registerFlush());return}var e={topic:this.topic,action:this.subscribeBulkAction,names:[t],correlationId:(this.correlationId++).toString()};this.services.connection.sendMessage(e),this.onSubscriptionSent(e)},i.prototype.subscribeList=function(t){t.forEach(this.subscribe.bind(this))},i.prototype.unsubscribe=function(t){if(this.subscriptionInterval>0){this.subscribeNames.has(t)?this.subscribeNames.delete(t):(this.unsubscribeNames.add(t),this.registerFlush());return}var e={topic:this.topic,action:this.unsubscribeBulkAction,names:[t],correlationId:(this.correlationId++).toString()};this.services.connection.sendMessage(e),this.onSubscriptionSent(e)},i.prototype.unsubscribeList=function(t){t.forEach(this.unsubscribe.bind(this))},i.prototype.registerFlush=function(){this.services.timerRegistry.has(this.timerRef)||(this.timerRef=this.services.timerRegistry.add({callback:this.sendMessages,context:this,duration:this.subscriptionInterval}))},i.prototype.sendMessages=function(){if(!this.services.connection.isConnected){this.onLost();return}if(this.subscribeNames.size>0){var t={topic:this.topic,action:this.subscribeBulkAction,names:Ss(this.subscribeNames),correlationId:(this.correlationId++).toString()};this.services.connection.sendMessage(t),this.onSubscriptionSent(t),this.subscribeNames.clear()}if(this.unsubscribeNames.size>0){var t={topic:this.topic,action:this.unsubscribeBulkAction,names:Ss(this.unsubscribeNames),correlationId:(this.correlationId++).toString()};this.services.connection.sendMessage(t),this.onSubscriptionSent(t),this.unsubscribeNames.clear()}},i.prototype.onLost=function(){this.correlationId=0,this.services.timerRegistry.remove(this.timerRef),this.subscribeNames.clear(),this.unsubscribeNames.clear()},i}();qt.BulkSubscriptionService=_u});var _s=y(be=>{"use strict";u();var qi=be&&be.__assign||function(){return qi=Object.assign||function(i){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},qi.apply(this,arguments)};Object.defineProperty(be,"__esModule",{value:!0});be.EventHandler=void 0;var j=F(),Ou=Jr(),Nu=mt(),Tu=ze(),Iu=function(){function i(t,e,r){this.services=t,this.emitter=new Nu.Emitter,this.limboQueue=[],this.bulkSubscription=new Tu.BulkSubscriptionService(this.services,e.subscriptionInterval,j.TOPIC.EVENT,j.EVENT_ACTION.SUBSCRIBE,j.EVENT_ACTION.UNSUBSCRIBE,this.onBulkSubscriptionSent.bind(this)),this.listeners=r||new Ou.Listener(j.TOPIC.EVENT,t),this.services.connection.registerHandler(j.TOPIC.EVENT,this.handle.bind(this)),this.services.connection.onExitLimbo(this.onExitLimbo.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this))}return i.prototype.eventNames=function(){return this.emitter.eventNames()},i.prototype.subscribe=function(t,e){if(typeof t!="string"||t.length===0)throw new Error("invalid argument name");if(typeof e!="function")throw new Error("invalid argument callback");this.emitter.hasListeners(t)||this.services.connection.isConnected&&this.bulkSubscription.subscribe(t),this.emitter.on(t,e)},i.prototype.unsubscribe=function(t,e){if(!t||typeof t!="string"||t.length===0)throw new Error("invalid argument name");if(e!==void 0&&typeof e!="function")throw new Error("invalid argument callback");if(!this.emitter.hasListeners(t)){this.services.logger.warn({topic:j.TOPIC.EVENT,action:j.EVENT_ACTION.NOT_SUBSCRIBED,name:t});return}this.emitter.off(t,e),this.emitter.hasListeners(t)||this.bulkSubscription.unsubscribe(t)},i.prototype.emit=function(t,e){if(typeof t!="string"||t.length===0)throw new Error("invalid argument name");var r={topic:j.TOPIC.EVENT,action:j.EVENT_ACTION.EMIT,name:t,parsedData:e};this.services.connection.isConnected?this.services.connection.sendMessage(r):this.services.connection.isInLimbo&&this.limboQueue.push(r),this.emitter.emit(t,e)},i.prototype.listen=function(t,e){this.listeners.listen(t,e)},i.prototype.unlisten=function(t){this.listeners.unlisten(t)},i.prototype.handle=function(t){if(t.isAck){this.services.timeoutRegistry.remove(t);return}if(t.action===j.EVENT_ACTION.EMIT){t.parsedData!==void 0?this.emitter.emit(t.name,t.parsedData):this.emitter.emit(t.name,void 0);return}if(t.action===j.EVENT_ACTION.MESSAGE_DENIED){this.services.logger.error({topic:j.TOPIC.EVENT},j.EVENT_ACTION.MESSAGE_DENIED),this.services.timeoutRegistry.remove(t),t.originalAction===j.EVENT_ACTION.SUBSCRIBE&&this.emitter.off(t.name);return}if(t.action===j.EVENT_ACTION.MULTIPLE_SUBSCRIPTIONS||t.action===j.EVENT_ACTION.NOT_SUBSCRIBED){this.services.timeoutRegistry.remove(qi(qi({},t),{action:j.EVENT_ACTION.SUBSCRIBE})),this.services.logger.warn(t);return}if(t.action===j.EVENT_ACTION.SUBSCRIPTION_FOR_PATTERN_FOUND||t.action===j.EVENT_ACTION.SUBSCRIPTION_FOR_PATTERN_REMOVED){this.listeners.handle(t);return}if(t.action===j.EVENT_ACTION.INVALID_LISTEN_REGEX){this.services.logger.error(t);return}this.services.logger.error(t,j.EVENT.UNSOLICITED_MESSAGE)},i.prototype.onConnectionReestablished=function(){this.bulkSubscription.subscribeList(this.emitter.eventNames());for(var t=0;t<this.limboQueue.length;t++)this.services.connection.sendMessage(this.limboQueue[t]);this.limboQueue=[]},i.prototype.onExitLimbo=function(){this.limboQueue=[]},i.prototype.onBulkSubscriptionSent=function(t){this.services.timeoutRegistry.add({message:t})},i}();be.EventHandler=Iu});var Ns=y(Wi=>{"use strict";u();Object.defineProperty(Wi,"__esModule",{value:!0});Wi.RPC=void 0;var Os=F(),Cu=function(){function i(t,e,r,n,o,s){this.response=n,this.services=s;var c={topic:Os.TOPIC.RPC,action:Os.RPC_ACTION.REQUEST,correlationId:e,name:t,parsedData:r};this.services.connection.sendMessage(c)}return i.prototype.accept=function(){},i.prototype.respond=function(t){this.response(null,t)},i.prototype.error=function(t){this.response(t)},i}();Wi.RPC=Cu});var Ts=y(Yi=>{"use strict";u();Object.defineProperty(Yi,"__esModule",{value:!0});Yi.RPCResponse=void 0;var Wt=F(),vu=function(){function i(t,e,r){this.name=t.name,this.correlationId=t.correlationId,this.services=r,this.isAccepted=!1,this.isComplete=!1,this.autoAccept=!0,this.services.timerRegistry.requestIdleCallback(this.performAutoAck.bind(this))}return i.prototype.accept=function(){this.isAccepted===!1&&(this.services.connection.sendMessage({topic:Wt.TOPIC.RPC,action:Wt.RPC_ACTION.ACCEPT,name:this.name,correlationId:this.correlationId}),this.isAccepted=!0)},i.prototype.reject=function(){if(this.isComplete===!0)throw new Error("Rpc "+this.name+" already completed");this.autoAccept=!1,this.isComplete=!0,this.isAccepted=!0,this.services.connection.sendMessage({topic:Wt.TOPIC.RPC,action:Wt.RPC_ACTION.REJECT,name:this.name,correlationId:this.correlationId})},i.prototype.error=function(t){if(this.isComplete===!0)throw new Error("Rpc "+this.name+" already completed");this.autoAccept=!1,this.isComplete=!0,this.isAccepted=!0,this.services.connection.sendMessage({topic:Wt.TOPIC.RPC,action:Wt.RPC_ACTION.REQUEST_ERROR,name:this.name,correlationId:this.correlationId,parsedData:t})},i.prototype.send=function(t){if(this.isComplete===!0)throw new Error("Rpc "+this.name+" already completed");this.accept(),this.services.connection.sendMessage({topic:Wt.TOPIC.RPC,action:Wt.RPC_ACTION.RESPONSE,name:this.name,correlationId:this.correlationId,parsedData:t}),this.isComplete=!0},i.prototype.performAutoAck=function(){this.autoAccept===!0&&this.accept()},i}();Yi.RPCResponse=vu});var Cs=y(Yt=>{"use strict";u();var bu=Yt&&Yt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o},Is=Yt&&Yt.__spread||function(){for(var i=[],t=0;t<arguments.length;t++)i=i.concat(bu(arguments[t]));return i};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.RPCHandler=void 0;var A=F(),Kr=Ns(),mu=Ts(),gu=Bt(),Au=ze(),Du=function(){function i(t,e){this.services=t,this.options=e,this.rpcs=new Map,this.providers=new Map,this.limboQueue=[],this.bulkSubscription=new Au.BulkSubscriptionService(this.services,e.subscriptionInterval,A.TOPIC.RPC,A.RPC_ACTION.PROVIDE,A.RPC_ACTION.UNPROVIDE,this.onBulkSubscriptionSent.bind(this)),this.services.connection.registerHandler(A.TOPIC.RPC,this.handle.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this)),this.services.connection.onExitLimbo(this.onExitLimbo.bind(this)),this.services.connection.onLost(this.onConnectionLost.bind(this))}return i.prototype.providerNames=function(){return Is(this.providers.keys())},i.prototype.provide=function(t,e){if(typeof t!="string"||t.length===0)throw new Error("invalid argument name");if(this.providers.has(t))throw new Error("RPC "+t+" already registered");if(typeof e!="function")throw new Error("invalid argument callback");this.providers.set(t,e),this.services.connection.isConnected&&this.bulkSubscription.subscribe(t)},i.prototype.unprovide=function(t){if(typeof t!="string"||t.length===0)throw new Error("invalid argument name");if(!this.providers.has(t)){this.services.logger.warn({topic:A.TOPIC.RPC,action:A.RPC_ACTION.NOT_PROVIDED,name:t});return}this.providers.delete(t),this.services.connection.isConnected&&this.bulkSubscription.unsubscribe(t)},i.prototype.make=function(t,e,r){var n=this;if(typeof t!="string"||t.length===0)throw new Error("invalid argument name");if(r&&typeof r!="function")throw new Error("invalid argument callback");var o=gu.getUid();if(this.services.connection.isConnected){if(r){this.rpcs.set(o,new Kr.RPC(t,o,e,r,this.options,this.services));return}return new Promise(function(s,c){n.rpcs.set(o,new Kr.RPC(t,o,e,function(a,l){return a?c(a):s(l)},n.options,n.services))})}else if(this.services.connection.isInLimbo)if(r)this.limboQueue.push({correlationId:o,name:t,data:e,callback:r});else return new Promise(function(s,c){n.limboQueue.push({correlationId:o,name:t,data:e,callback:function(a,l){return a?c(a):s(l)}})});else if(r)r(A.EVENT.CLIENT_OFFLINE);else return Promise.reject(A.EVENT.CLIENT_OFFLINE)},i.prototype.respondToRpc=function(t){var e=this.providers.get(t.name);e?e(t.parsedData,new mu.RPCResponse(t,this.options,this.services)):this.services.connection.sendMessage({topic:A.TOPIC.RPC,action:A.RPC_ACTION.REJECT,name:t.name,correlationId:t.correlationId})},i.prototype.handle=function(t){if(t.action===A.RPC_ACTION.REQUEST){this.respondToRpc(t);return}if(t.isAck){this.services.timeoutRegistry.remove(t);return}if(t.action===A.RPC_ACTION.MESSAGE_PERMISSION_ERROR||t.action===A.RPC_ACTION.MESSAGE_DENIED){if(t.originalAction===A.RPC_ACTION.PROVIDE||t.originalAction===A.RPC_ACTION.UNPROVIDE){this.services.timeoutRegistry.remove(t),this.providers.delete(t.name),this.services.logger.error(t);return}if(t.originalAction===A.RPC_ACTION.REQUEST){var e=this.getRPC(t);if(e){e.error(A.RPC_ACTION[t.action]),this.rpcs.delete(t.correlationId);return}}}var r=this.getRPC(t);if(r){if(t.action===A.RPC_ACTION.ACCEPT){r.accept();return}t.action===A.RPC_ACTION.RESPONSE?r.respond(t.parsedData):t.action===A.RPC_ACTION.REQUEST_ERROR?r.error(t.parsedData):(t.action===A.RPC_ACTION.RESPONSE_TIMEOUT||t.action===A.RPC_ACTION.ACCEPT_TIMEOUT||t.action===A.RPC_ACTION.NO_RPC_PROVIDER)&&r.error(A.RPC_ACTION[t.action]),this.rpcs.delete(t.correlationId)}},i.prototype.getRPC=function(t){var e=this.rpcs.get(t.correlationId);return e===void 0&&this.services.logger.error(t,A.EVENT.UNKNOWN_CORRELATION_ID),e},i.prototype.onConnectionReestablished=function(){this.bulkSubscription.subscribeList(Is(this.providers.keys()));for(var t=0;t<this.limboQueue.length;t++){var e=this.limboQueue[t],r=e.correlationId,n=e.name,o=e.data,s=e.callback;this.rpcs.set(r,new Kr.RPC(n,r,o,s,this.options,this.services))}this.limboQueue=[]},i.prototype.onExitLimbo=function(){for(var t=0;t<this.limboQueue.length;t++)this.limboQueue[t].callback(A.EVENT.CLIENT_OFFLINE);this.limboQueue=[]},i.prototype.onConnectionLost=function(){this.rpcs.forEach(function(t){t.error(A.EVENT.CLIENT_OFFLINE)}),this.rpcs.clear()},i.prototype.onBulkSubscriptionSent=function(t){this.services.timeoutRegistry.add({message:t})},i}();Yt.RPCHandler=Du});var bs=y(me=>{"use strict";u();Object.defineProperty(me,"__esModule",{value:!0});me.setValue=me.get=void 0;var $r=Bt(),wu=/[[\]]/g;function Pu(i,t,e){e===void 0&&(e=!1);for(var r=vs(t),n=i,o=0;o<r.length;o++){if(n===void 0)return;if(typeof n!="object")throw new Error("invalid data or path");n=n[r[o]]}return e!==!1?$r.deepCopy(n):n}me.get=Pu;function Uu(i,t,e){if(t===null)return e;var r=vs(t),n=$r.deepCopy(i),o=$r.deepCopy(e),s=n,c;for(c=0;c<r.length-1;c++){var a=r[c];if(s[a]!==void 0&&s[a]!==null&&typeof s[a]=="object")s=s[a];else if(typeof r[c+1]=="number"){var l=new Array(r[c+1]);l.fill(null),s=s[a]=l}else s=s[a]={}}return e===void 0?delete s[r[c]]:s[r[c]]=o,n}me.setValue=Uu;function vs(i){if(i===null)return[];for(var t=[],e=i.split("."),r=0;r<e.length;r++){var n=e[r].trim();if(n.length!==0){var o=n.split(wu);if(o.length!==0){t.push(o[0]);for(var s=1;s<o.length;s++)o[s].length!==0&&t.push(Number(o[s]))}}}return t}});var gs=y(Kt=>{"use strict";u();var Lu=Kt&&Kt.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Jt=Kt&&Kt.__assign||function(){return Jt=Object.assign||function(i){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Jt.apply(this,arguments)};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.RecordCore=void 0;var R=F(),le=bs(),ms=mt(),ge=Bt(),Mu=Wr(),Q=function(i){Lu(t,i);function t(e,r,n,o,s){var c=i.call(this)||this;if(c.name=e,c.services=r,c.options=n,c.recordServices=o,c.whenComplete=s,c.isReady=!1,c.hasProvider=!1,c.version=null,c.references=new Set,c.emitter=new ms.Emitter,c.data=Object.create(null),c.responseTimeout=null,c.discardTimeout=null,c.deletedTimeout=null,c.deleteResponse=null,c.pendingWrites=[],c.readyTimer=-1,c.recordReadOnlyMode=c.options.recordReadOnlyMode&&c.options.recordPrefixWriteWhitelist.every(function(a){return!c.name.startsWith(a)}),c.readyCallbacks=[],typeof e!="string"||e.length===0)throw new Error("invalid argument name");return c.onConnectionLost=c.onConnectionLost.bind(c),c.onConnectionReestablished=c.onConnectionReestablished.bind(c),c.stateMachine=new Mu.StateMachine(c.services.logger,{init:"LOADING_OFFLINE",context:c,onStateChanged:c.onStateChanged,transitions:Bu}),c.recordServices.dirtyService.whenLoaded(c,c.onDirtyServiceLoaded),c}return Object.defineProperty(t.prototype,"recordState",{get:function(){return this.stateMachine.state},enumerable:!1,configurable:!0}),t.prototype.addReference=function(e){this.references.size===0&&this.isReady&&(this.services.timeoutRegistry.clear(this.discardTimeout),this.services.timerRegistry.remove(this.readyTimer),this.readyTimer=-1,this.stateMachine.transition(R.RECORD_ACTION.SUBSCRIBE)),this.references.add(e)},t.prototype.removeReference=function(e){var r=this;this.checkDestroyed("discard")||this.whenReadyInternal(e,function(){r.references.delete(e),r.references.size===0&&r.readyTimer===-1&&(r.readyTimer=r.services.timerRegistry.add({duration:r.options.recordDiscardTimeout,callback:r.stateMachine.transition,context:r.stateMachine,data:"UNSUBSCRIBE_FOR_REAL"}),r.stateMachine.transition(R.RECORD_ACTION.UNSUBSCRIBE))})},t.prototype.onDirtyServiceLoaded=function(){var e=this;this.services.storage.get(this.name,function(r,n,o){if(e.services.connection.onReestablished(e.onConnectionReestablished),e.services.connection.onLost(e.onConnectionLost),!e.services.connection.isConnected){if(n===-1){if(e.recordReadOnlyMode)return;e.version=e.options.initialRecordVersion,e.data=Object.create(null),e.recordServices.dirtyService.setDirty(e.name,!0),e.services.storage.set(e.name,e.version,e.data,function(s){})}else e.version=n,e.data=o;e.stateMachine.transition("LOADED");return}n===-1&&!e.recordServices.dirtyService.isDirty(e.name)?e.stateMachine.transition(R.RECORD_ACTION.SUBSCRIBECREATEANDREAD):(e.version=n,e.data=o,e.stateMachine.transition("RESUBSCRIBE"))})},t.prototype.onStateChanged=function(e,r){this.emitter.emit(R.EVENT.RECORD_STATE_CHANGED,e)},t.prototype.whenReady=function(e,r){var n=this;if(r){this.whenReadyInternal(e,function(o){r(o)});return}return new Promise(function(o){return n.whenReadyInternal(e,function(){return o(e)})})},t.prototype.whenReadyInternal=function(e,r){if(this.isReady===!0){r(e);return}this.readyCallbacks.push({callback:r,context:e})},t.prototype.set=function(e){var r=this,n=e.path,o=e.data,s=e.callback;if(!n&&(o===null||typeof o!="object"))throw new Error("invalid arguments, scalar values cannot be set without path");if(!this.checkDestroyed("set")){if(this.recordReadOnlyMode){this.services.logger.error({topic:R.TOPIC.RECORD},R.EVENT.RECORD_READ_ONLY_MODE,"Attempting to set data when in readonly mode, ignoring");return}if(this.isReady===!1){this.pendingWrites.push({path:n,data:o,callback:s});return}var c=this.data,a=le.setValue(c,n||null,o);if(ge.deepEquals(c,a)){s&&this.services.timerRegistry.requestIdleCallback(function(){return s(null,r.name)});return}this.applyChange(a),this.services.connection.isConnected?this.sendUpdate(n,o,s):(s&&s(R.EVENT.CLIENT_OFFLINE,this.name),this.saveUpdate())}},t.prototype.setWithAck=function(e){var r=this;if(e.callback){this.set(e);return}return new Promise(function(n,o){e.callback=function(s){return s===null?n():o(s)},r.set(e)})},t.prototype.get=function(e){return le.get(this.data,e||null,this.options.recordDeepCopy)},t.prototype.subscribe=function(e,r){var n=this;if(e.path!==void 0&&(typeof e.path!="string"||e.path.length===0))throw new Error("invalid argument path");if(typeof e.callback!="function")throw new Error("invalid argument callback");this.checkDestroyed("subscribe")||(e.triggerNow?this.whenReadyInternal(null,function(){n.emitter.on(e.path||"",e.callback,r),e.callback(n.get(e.path))}):this.emitter.on(e.path||"",e.callback,r))},t.prototype.unsubscribe=function(e,r){if(e.path!==void 0&&(typeof e.path!="string"||e.path.length===0))throw new Error("invalid argument path");if(e.callback!==void 0&&typeof e.callback!="function")throw new Error("invalid argument callback");this.checkDestroyed("unsubscribe")||this.emitter.off(e.path||"",e.callback,r)},t.prototype.delete=function(e){var r=this;if(!this.services.connection.isConnected){if(e){this.services.timerRegistry.requestIdleCallback(function(){e("Deleting while offline is not supported")});return}return Promise.reject("Deleting while offline is not supported")}if(!this.checkDestroyed("delete"))if(this.stateMachine.transition(R.RECORD_ACTION.DELETE),e&&typeof e=="function")this.deleteResponse={callback:e},this.sendDelete();else return new Promise(function(n,o){r.deleteResponse={resolve:n,reject:o},r.sendDelete()})},t.prototype.setMergeStrategy=function(e){this.recordServices.mergeStrategy.setMergeStrategyByName(this.name,e)},t.prototype.saveRecordToOffline=function(e){e===void 0&&(e=function(){}),this.services.storage.set(this.name,this.version,this.data,e)},t.prototype.onSubscribing=function(){this.recordServices.readRegistry.register(this.name,this,this.handleReadResponse),this.responseTimeout=this.services.timeoutRegistry.add({message:{topic:R.TOPIC.RECORD,action:R.RECORD_ACTION.READ_RESPONSE,name:this.name}}),this.recordReadOnlyMode?this.recordServices.bulkSubscriptionService[R.RECORD_ACTION.SUBSCRIBEANDREAD].subscribe(this.name):this.recordServices.bulkSubscriptionService[R.RECORD_ACTION.SUBSCRIBECREATEANDREAD].subscribe(this.name)},t.prototype.onResubscribing=function(){this.services.timerRegistry.remove(this.readyTimer),this.recordServices.headRegistry.register(this.name,this,this.handleHeadResponse),this.responseTimeout=this.services.timeoutRegistry.add({message:{topic:R.TOPIC.RECORD,action:R.RECORD_ACTION.HEAD,name:this.name}}),this.recordServices.bulkSubscriptionService[R.RECORD_ACTION.SUBSCRIBEANDHEAD].subscribe(this.name)},t.prototype.onReady=function(){this.services.timeoutRegistry.clear(this.responseTimeout),this.applyPendingWrites(),this.isReady=!0,this.applyChange(this.data,!0,!1),this.readyCallbacks.forEach(function(e){var r=e.context,n=e.callback;n.call(r,r)}),this.readyCallbacks=[]},t.prototype.applyPendingWrites=function(){for(var e=this,r=[],n=this.data,o=n,s=0;s<this.pendingWrites.length;s++){var c=this.pendingWrites[s],a=c.callback,l=c.path,f=c.data;a&&r.push(a),o=le.setValue(o,l||null,f)}this.pendingWrites=[],this.applyChange(o);var p;if(r.length!==0&&(p=function(T){for(var I=0;I<r.length;I++)r[I](T,e.name)}),ge.deepEquals(n,o)){p&&p(null);return}this.services.connection.isConnected?this.sendUpdate(null,o,p):(p&&p(R.EVENT.CLIENT_OFFLINE),this.saveUpdate())},t.prototype.onUnsubscribed=function(){var e=this;if(this.services.connection.isConnected){var r={topic:R.TOPIC.RECORD,action:R.RECORD_ACTION.UNSUBSCRIBE,names:[this.name],correlationId:this.name};this.discardTimeout=this.services.timeoutRegistry.add({message:r}),this.services.connection.sendMessage(r)}this.emit(R.EVENT.RECORD_DISCARDED),this.saveRecordToOffline(function(){return e.destroy()})},t.prototype.onDeleted=function(){this.services.storage.delete(this.name,function(){}),this.emit(R.EVENT.RECORD_DELETED),this.destroy()},t.prototype.handle=function(e){if(e.action===R.RECORD_ACTION.PATCH||e.action===R.RECORD_ACTION.UPDATE||e.action===R.RECORD_ACTION.ERASE){if(this.stateMachine.state==="MERGING")return;this.applyUpdate(e);return}if(e.action===R.RECORD_ACTION.DELETE_SUCCESS){this.services.timeoutRegistry.clear(this.deletedTimeout),this.stateMachine.transition(R.RECORD_ACTION.DELETE_SUCCESS),this.deleteResponse.callback?this.deleteResponse.callback(null):this.deleteResponse.resolve&&this.deleteResponse.resolve();return}if(e.action===R.RECORD_ACTION.DELETED){this.stateMachine.transition(R.RECORD_ACTION.DELETED);return}if(e.action===R.RECORD_ACTION.VERSION_EXISTS){this.recoverRecordFromMessage(e);return}if(e.action===R.RECORD_ACTION.MESSAGE_DENIED||e.action===R.RECORD_ACTION.MESSAGE_PERMISSION_ERROR){if(e.originalAction===R.RECORD_ACTION.SUBSCRIBECREATEANDREAD||e.originalAction===R.RECORD_ACTION.SUBSCRIBEANDHEAD||e.originalAction===R.RECORD_ACTION.SUBSCRIBEANDREAD){var r=Jt(Jt({},e),{originalAction:R.RECORD_ACTION.SUBSCRIBE}),n=Jt(Jt({},e),{originalAction:e.originalAction===R.RECORD_ACTION.SUBSCRIBECREATEANDREAD?R.RECORD_ACTION.READ_RESPONSE:R.RECORD_ACTION.HEAD_RESPONSE});this.services.timeoutRegistry.remove(r),this.services.timeoutRegistry.remove(n)}if(e.originalAction===R.RECORD_ACTION.PATCH&&e.correlationId){this.recordServices.writeAckService.recieve(e);return}this.emit(R.EVENT.RECORD_ERROR,R.RECORD_ACTION[R.RECORD_ACTION.MESSAGE_DENIED],R.RECORD_ACTION[e.originalAction]),e.originalAction===R.RECORD_ACTION.DELETE&&(this.deleteResponse.callback?this.deleteResponse.callback(R.RECORD_ACTION[R.RECORD_ACTION.MESSAGE_DENIED]):this.deleteResponse.reject&&this.deleteResponse.reject(R.RECORD_ACTION[R.RECORD_ACTION.MESSAGE_DENIED]));return}if(e.action===R.RECORD_ACTION.SUBSCRIPTION_HAS_PROVIDER||e.action===R.RECORD_ACTION.SUBSCRIPTION_HAS_NO_PROVIDER){this.hasProvider=e.action===R.RECORD_ACTION.SUBSCRIPTION_HAS_PROVIDER,this.emit(R.EVENT.RECORD_HAS_PROVIDER_CHANGED,this.hasProvider);return}},t.prototype.handleReadResponse=function(e){if(this.stateMachine.state==="MERGING"){this.recoverRecordFromMessage(e),this.recordServices.dirtyService.setDirty(this.name,!1);return}this.version=e.version,this.data=e.parsedData,this.stateMachine.transition(R.RECORD_ACTION.READ_RESPONSE)},t.prototype.handleHeadResponse=function(e){var r=e.version;this.recordServices.dirtyService.isDirty(this.name)?r===-1&&this.version===this.options.initialRecordVersion?(this.stateMachine.transition("SUBSCRIBED"),this.sendCreateUpdate(this.data)):this.version===r+1?(this.stateMachine.transition("RESUBSCRIBED"),this.sendUpdate(null,this.data)):(this.stateMachine.transition("INVALID_VERSION"),r!==-1?(this.sendRead(),this.recordServices.readRegistry.register(this.name,this,this.handleReadResponse)):this.recoverRecordDeletedRemotely()):this.version===r?this.stateMachine.transition("RESUBSCRIBED"):(this.stateMachine.transition("INVALID_VERSION"),r<this.version?this.recoverRecordDeletedRemotely():(this.sendRead(),this.recordServices.readRegistry.register(this.name,this,this.handleReadResponse)))},t.prototype.sendRead=function(){this.services.connection.sendMessage({topic:R.TOPIC.RECORD,action:R.RECORD_ACTION.READ,name:this.name})},t.prototype.saveUpdate=function(){this.recordServices.dirtyService.isDirty(this.name)||(this.version++,this.recordServices.dirtyService.setDirty(this.name,!0)),this.saveRecordToOffline()},t.prototype.sendUpdate=function(e,r,n){if(e===void 0&&(e=null),this.recordReadOnlyMode){this.services.logger.error({topic:R.TOPIC.RECORD},R.EVENT.RECORD_READ_ONLY_MODE,"Attempting to send updated data, ignoring");return}this.recordServices.dirtyService.isDirty(this.name)?this.recordServices.dirtyService.setDirty(this.name,!1):this.version++;var o={topic:R.TOPIC.RECORD,version:this.version,name:this.name};e?r===void 0?Object.assign(o,{action:R.RECORD_ACTION.ERASE,path:e}):Object.assign(o,{action:R.RECORD_ACTION.PATCH,path:e,parsedData:r}):Object.assign(o,{action:R.RECORD_ACTION.UPDATE,parsedData:r}),n?this.recordServices.writeAckService.send(o,n):this.services.connection.sendMessage(o)},t.prototype.sendCreateUpdate=function(e){this.services.connection.sendMessage({name:this.name,topic:R.TOPIC.RECORD,action:R.RECORD_ACTION.CREATEANDUPDATE,version:this.options.initialRecordVersion,parsedData:e}),this.recordServices.dirtyService.setDirty(this.name,!1)},t.prototype.applyUpdate=function(e){var r=e.version,n=e.parsedData;if(this.version===null)this.version=r;else if(this.version+1!==r){this.stateMachine.transition("INVALID_VERSION"),e.action===R.RECORD_ACTION.PATCH?(this.sendRead(),this.recordServices.readRegistry.register(this.name,this,this.handleReadResponse)):this.recoverRecordFromMessage(e);return}this.version=r;var o;e.action===R.RECORD_ACTION.PATCH?o=le.setValue(this.data,e.path,n):e.action===R.RECORD_ACTION.ERASE?o=le.setValue(this.data,e.path,void 0):o=n,this.applyChange(o)},t.prototype.applyChange=function(e,r,n){if(r===void 0&&(r=!1),n===void 0&&(n=!0),!this.stateMachine.inEndState){var o=this.data;this.data=e,this.options.saveUpdatesOffline&&n&&this.saveRecordToOffline();for(var s=this.emitter.eventNames(),c=0;c<s.length;c++){var a=le.get(e,s[c],!1),l=le.get(o,s[c],!1);(!ge.deepEquals(a,l)||r&&a)&&this.emitter.emit(s[c],this.get(s[c]))}}},t.prototype.sendDelete=function(){var e=this;this.whenReadyInternal(null,function(){e.services.storage.delete(e.name,function(){if(e.services.connection.isConnected){var r={topic:R.TOPIC.RECORD,action:R.RECORD_ACTION.DELETE,name:e.name};e.deletedTimeout=e.services.timeoutRegistry.add({message:r,event:R.EVENT.RECORD_DELETE_TIMEOUT,duration:e.options.recordDeleteTimeout}),e.services.connection.sendMessage(r)}else e.stateMachine.transition(R.RECORD_ACTION.DELETE_SUCCESS)})})},t.prototype.recoverRecordFromMessage=function(e){this.recordServices.mergeStrategy.merge(e,this.version,this.get(),this.onRecordRecovered,this)},t.prototype.recoverRecordDeletedRemotely=function(){this.recordServices.mergeStrategy.merge({name:this.name,version:-1,parsedData:null},this.version,this.get(),this.onRecordRecovered,this)},t.prototype.onRecordRecovered=function(e,r,n){var o=this,s=r.version,c=r.parsedData;if(e){this.services.logger.error({topic:R.TOPIC.RECORD},R.EVENT.RECORD_VERSION_EXISTS),r.correlationId&&this.recordServices.writeAckService.recieve(Jt(Jt({},r),{reason:e}));return}if(n===null){s===-1?(this.services.storage.delete(this.name,function(){}),this.stateMachine.transition(R.RECORD_ACTION.DELETED)):this.stateMachine.transition(R.RECORD_ACTION.DELETE);return}this.version=s;var a=this.data;if(ge.deepEquals(a,c)){this.stateMachine.state==="MERGING"&&this.stateMachine.transition("MERGED");return}if(this.stateMachine.state!=="MERGING"){this.services.logger.warn({topic:R.TOPIC.RECORD,action:R.RECORD_ACTION.VERSION_EXISTS});return}var l=n;this.stateMachine.transition("MERGED");var f,p=this.pendingWrites.map(function(T){var I=T.callback;return I}).filter(function(T){return T!==void 0});if(p.length!==0&&(f=function(T){p.forEach(function(I){return I(T,o.name)})}),this.pendingWrites=[],ge.deepEquals(n,c)){this.applyChange(n),f&&f(null);return}if(this.recordReadOnlyMode){this.services.logger.error({topic:R.TOPIC.RECORD},R.EVENT.RECORD_READ_ONLY_MODE,"Attempting to set data after merge when in readonly mode, ignoring");return}this.applyChange(l),this.sendUpdate(null,this.data,f)},t.prototype.checkDestroyed=function(e){return this.stateMachine.inEndState?(this.services.logger.error({topic:R.TOPIC.RECORD},R.EVENT.RECORD_ALREADY_DESTROYED,{methodName:e}),!0):!1},t.prototype.destroy=function(){this.services.timerRegistry.remove(this.readyTimer),this.services.timeoutRegistry.clear(this.responseTimeout),this.services.timeoutRegistry.clear(this.deletedTimeout),this.services.timeoutRegistry.clear(this.discardTimeout),this.services.connection.removeOnReestablished(this.onConnectionReestablished),this.services.connection.removeOnLost(this.onConnectionLost),this.emitter.off(),this.isReady=!1,this.whenComplete(this.name)},t.prototype.onConnectionReestablished=function(){this.stateMachine.transition("RESUBSCRIBE")},t.prototype.onConnectionLost=function(){this.saveRecordToOffline()},t.prototype.getDebugId=function(){return this.options.debug?ge.getUid():null},t}(ms.Emitter);Kt.RecordCore=Q;var Bu=[{name:R.RECORD_ACTION.SUBSCRIBECREATEANDREAD,from:"LOADING_OFFLINE",to:"SUBSCRIBING",handler:Q.prototype.onSubscribing},{name:"LOADED",from:"LOADING_OFFLINE",to:"READY",handler:Q.prototype.onReady},{name:R.RECORD_ACTION.READ_RESPONSE,from:"SUBSCRIBING",to:"READY",handler:Q.prototype.onReady},{name:"SUBSCRIBED",from:"RESUBSCRIBING",to:"READY",handler:Q.prototype.onReady},{name:"RESUBSCRIBE",from:"LOADING_OFFLINE",to:"RESUBSCRIBING",handler:Q.prototype.onResubscribing},{name:"RESUBSCRIBE",from:"READY",to:"RESUBSCRIBING",handler:Q.prototype.onResubscribing},{name:"RESUBSCRIBE",from:"RESUBSCRIBING",to:"RESUBSCRIBING",handler:Q.prototype.onResubscribing},{name:"RESUBSCRIBE",from:"SUBSCRIBING",to:"SUBSCRIBING",handler:Q.prototype.onSubscribing},{name:"RESUBSCRIBE",from:"UNSUBSCRIBING",to:"UNSUBSCRIBING"},{name:"RESUBSCRIBED",from:"RESUBSCRIBING",to:"READY",handler:Q.prototype.onReady},{name:"INVALID_VERSION",from:"RESUBSCRIBING",to:"MERGING"},{name:"MERGED",from:"MERGING",to:"READY",handler:Q.prototype.onReady},{name:R.RECORD_ACTION.DELETED,from:"MERGING",to:"DELETED",handler:Q.prototype.onDeleted},{name:R.RECORD_ACTION.DELETE,from:"MERGING",to:"DELETING"},{name:R.RECORD_ACTION.DELETE,from:"READY",to:"DELETING"},{name:R.RECORD_ACTION.DELETED,from:"READY",to:"DELETED",handler:Q.prototype.onDeleted},{name:R.RECORD_ACTION.DELETED,from:"UNSUBSCRIBE_FOR_REAL",to:"DELETED",handler:Q.prototype.onDeleted},{name:R.RECORD_ACTION.DELETED,from:"UNSUBSCRIBING",to:"DELETED",handler:Q.prototype.onDeleted},{name:R.RECORD_ACTION.DELETE_SUCCESS,from:"DELETING",to:"DELETED",handler:Q.prototype.onDeleted},{name:R.RECORD_ACTION.UNSUBSCRIBE,from:"READY",to:"UNSUBSCRIBING"},{name:R.RECORD_ACTION.SUBSCRIBE,from:"UNSUBSCRIBING",to:"READY"},{name:"UNSUBSCRIBE_FOR_REAL",from:"UNSUBSCRIBING",to:"UNSUBSCRIBED",handler:Q.prototype.onUnsubscribed},{name:"INVALID_VERSION",from:"READY",to:"MERGING"}]});var Qr=y(Ae=>{"use strict";u();var ku=Ae&&Ae.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(Ae,"__esModule",{value:!0});Ae.Record=void 0;var Ji=Bt(),$t=F(),xu=mt(),ju=function(i){ku(t,i);function t(e){var r=i.call(this)||this;return r.record=e,r.debugId=r.record.getDebugId(),r.subscriptions=[],r.record.on($t.EVENT.RECORD_READY,r.emit.bind(r,$t.EVENT.RECORD_READY,r),r),r.record.on($t.EVENT.RECORD_DISCARDED,r.emit.bind(r,$t.EVENT.RECORD_DISCARDED),r),r.record.on($t.EVENT.RECORD_DELETED,r.emit.bind(r,$t.EVENT.RECORD_DELETED),r),r.record.on($t.EVENT.RECORD_ERROR,r.emit.bind(r,$t.EVENT.RECORD_ERROR),r),r.record.addReference(r),r}return Object.defineProperty(t.prototype,"name",{get:function(){return this.record.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReady",{get:function(){return this.record.isReady},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this.record.version},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasProvider",{get:function(){return this.record.hasProvider},enumerable:!1,configurable:!0}),t.prototype.whenReady=function(e){if(e)this.record.whenReady(this,e);else return this.record.whenReady(this)},t.prototype.get=function(e){return this.record.get(e)},t.prototype.set=function(e,r,n){return this.record.set(Ji.normalizeSetArguments(arguments))},t.prototype.setWithAck=function(e,r,n){return this.record.setWithAck(Ji.normalizeSetArguments(arguments))},t.prototype.erase=function(e){if(!e)throw new Error("unable to erase record data without path, consider using `delete`");this.set(e,void 0)},t.prototype.eraseWithAck=function(e,r){if(!e)throw new Error("unable to erase record data without path, consider using `delete`");if(r)this.setWithAck(e,void 0,r);else return this.setWithAck(e,void 0)},t.prototype.subscribe=function(e,r,n){var o=Ji.normalizeArguments(arguments);this.subscriptions.push(o),this.record.subscribe(o,this)},t.prototype.unsubscribe=function(e,r){var n=Ji.normalizeArguments(arguments);this.subscriptions=this.subscriptions.filter(function(o){return!(!n.callback&&o.path===n.path||n.callback&&o.path===n.path&&o.callback===n.callback)}),this.record.unsubscribe(n,this)},t.prototype.discard=function(){for(var e=0;e<this.subscriptions.length;e++)this.record.unsubscribe(this.subscriptions[e],this);this.record.removeReference(this),this.record.removeContext(this)},t.prototype.delete=function(e){return this.record.delete(e)},t.prototype.setMergeStrategy=function(e){this.record.setMergeStrategy(e)},t}(xu.Emitter);Ae.Record=ju});var As=y(we=>{"use strict";u();var Vu=we&&we.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(we,"__esModule",{value:!0});we.AnonymousRecord=void 0;var De=Bt(),Fu=mt(),Hu=function(i){Vu(t,i);function t(e){var r=i.call(this)||this;return r.record=null,r.subscriptions=[],r.getRecordCore=e,r}return Object.defineProperty(t.prototype,"name",{get:function(){return this.record?this.record.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReady",{get:function(){return this.record?this.record.isReady:!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this.record?this.record.version:-1},enumerable:!1,configurable:!0}),t.prototype.whenReady=function(e){if(this.record)if(e)this.record.whenReady(this,e);else return this.record.whenReady(this)},t.prototype.setName=function(e,r){if(this.name!==e){this.discard(),this.record=this.getRecordCore(e),this.record.addReference(this);for(var n=0;n<this.subscriptions.length;n++)this.record.subscribe(this.subscriptions[n],this);if(this.emit("nameChanged",e),r)this.record.whenReady(this,r);else return this.record.whenReady(this)}},t.prototype.get=function(e){if(this.record)return this.record.get(e)},t.prototype.set=function(e,r,n){if(this.record)return this.record.set(De.normalizeSetArguments(arguments))},t.prototype.setWithAck=function(e,r,n){if(this.record)return this.record.setWithAck(De.normalizeSetArguments(arguments))},t.prototype.erase=function(e){if(this.record)return this.record.set(De.normalizeSetArguments(arguments))},t.prototype.eraseWithAck=function(e,r){if(this.record)return this.record.setWithAck(De.normalizeSetArguments(arguments))},t.prototype.subscribe=function(e,r,n){var o=De.normalizeArguments(arguments);this.subscriptions.push(o),this.record&&this.record.subscribe(o,this)},t.prototype.unsubscribe=function(e,r){var n=De.normalizeArguments(arguments);this.subscriptions=this.subscriptions.filter(function(o){return!(!n.callback&&o.path===n.path||n.callback&&o.path===n.path&&o.callback===n.callback)}),this.record&&this.record.unsubscribe(n,this)},t.prototype.discard=function(){if(this.record){for(var e=0;e<this.subscriptions.length;e++)this.record.unsubscribe(this.subscriptions[e],this);return this.record.removeReference(this)}},t.prototype.delete=function(e){if(this.record)return this.record.delete(e)},t.prototype.setMergeStrategy=function(e){this.record&&this.record.setMergeStrategy(e)},t}(Fu.Emitter);we.AnonymousRecord=Hu});var ws=y(Dt=>{"use strict";u();var Gu=Dt&&Dt.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),qu=Dt&&Dt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o},Wu=Dt&&Dt.__spread||function(){for(var i=[],t=0;t<arguments.length;t++)i=i.concat(qu(arguments[t]));return i};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.List=void 0;var Ds=Bt(),he=F(),Yu=mt(),Ju=function(i){Gu(t,i);function t(e){var r=i.call(this)||this;return r.record=e,r.debugId=r.record.getDebugId(),r.wrappedFunctions=new Map,r.hasAddListener=!1,r.hasRemoveListener=!1,r.hasMoveListener=!1,r.subscriptions=[],r.originalApplyUpdate=r.record.applyUpdate.bind(r.record),r.record.applyUpdate=r.applyUpdate.bind(r),r.record.addReference(r),r.record.on("discard",function(){return r.emit("discard",r)},r),r.record.on("delete",function(){return r.emit("delete",r)},r),r.record.on("error",function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return r.emit.apply(r,Wu(["error"],n))},r),r}return Object.defineProperty(t.prototype,"name",{get:function(){return this.record.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReady",{get:function(){return this.record.isReady},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this.record.version},enumerable:!1,configurable:!0}),t.prototype.whenReady=function(e){if(e)this.record.whenReady(this,e);else return this.record.whenReady(this)},t.prototype.discard=function(){this.destroy(),this.record.removeReference(this)},t.prototype.delete=function(e){return this.destroy(),this.record.delete(e)},t.prototype.getEntries=function(){var e=this.record.get();return e instanceof Array?e:[]},t.prototype.isEmpty=function(){return this.getEntries().length===0},t.prototype.setEntriesWithAck=function(e,r){var n=this;if(!r)return new Promise(function(o,s){n.setEntries(e,function(c){c?s(c):o()})});this.setEntries(e,r)},t.prototype.setEntries=function(e,r){var n="entries must be an array of record names",o;if(!(e instanceof Array))throw new Error(n);for(o=0;o<e.length;o++)if(typeof e[o]!="string")throw new Error(n);this.beforeChange(),this.record.set({data:e,callback:r}),this.afterChange()},t.prototype.removeEntry=function(e,r,n){var o=this.record.get(),s=this.hasIndex(r),c=[],a;for(a=0;a<o.length;a++)(o[a]!==e||s&&r!==a)&&c.push(o[a]);this.beforeChange(),this.record.set({data:c,callback:n}),this.afterChange()},t.prototype.addEntry=function(e,r,n){if(typeof e!="string")throw new Error("Entry must be a recordName");var o=this.hasIndex(r),s=this.getEntries();o?s.splice(r,0,e):s.push(e),this.beforeChange(),this.record.set({data:s,callback:n}),this.afterChange()},t.prototype.subscribe=function(e){var r=Ds.normalizeArguments(arguments);if(r.path)throw new Error("path is not supported for List.subscribe");var n=function(o,s){s(o.getEntries())}.bind(this,this,r.callback);this.wrappedFunctions.set(r.callback,n),r.callback=n,this.subscriptions.push(r),this.record.subscribe(r,this)},t.prototype.unsubscribe=function(e){var r=Ds.normalizeArguments(arguments);if(r.path)throw new Error("path is not supported for List.unsubscribe");var n=this.wrappedFunctions.get(r.callback);r.callback=n,this.wrappedFunctions.delete(r.callback),this.subscriptions=this.subscriptions.filter(function(o){return!!(r.callback&&r.callback!==o.callback)}),this.record.unsubscribe(r,this)},t.prototype.applyUpdate=function(e){e.parsedData instanceof Array||(e.parsedData=[]),this.beforeChange(),this.originalApplyUpdate(e),this.afterChange()},t.prototype.hasIndex=function(e){var r=!1,n=this.getEntries();if(e!==void 0){if(isNaN(e))throw new Error("Index must be a number");if(e!==n.length&&(e>=n.length||e<0))throw new Error("Index must be within current entries");r=!0}return r},t.prototype.beforeChange=function(){this.hasAddListener=this.hasListeners(he.EVENT.ENTRY_ADDED_EVENT),this.hasRemoveListener=this.hasListeners(he.EVENT.ENTRY_REMOVED_EVENT),this.hasMoveListener=this.hasListeners(he.EVENT.ENTRY_MOVED_EVENT),this.hasAddListener||this.hasRemoveListener||this.hasMoveListener?this.beforeStructure=this.getStructure():this.beforeStructure=null},t.prototype.afterChange=function(){if(this.beforeStructure!==null){var e=this.getStructure(),r=this.beforeStructure,n,o;if(this.hasRemoveListener)for(n in r)for(o=0;o<r[n].length;o++)(e[n]===void 0||e[n][o]===void 0)&&this.emit(he.EVENT.ENTRY_REMOVED_EVENT,n,r[n][o]);if(this.hasAddListener||this.hasMoveListener)for(n in e)if(r[n]===void 0)for(o=0;o<e[n].length;o++)this.emit(he.EVENT.ENTRY_ADDED_EVENT,n,e[n][o]);else for(o=0;o<e[n].length;o++)r[n][o]!==e[n][o]&&(r[n][o]===void 0?this.emit(he.EVENT.ENTRY_ADDED_EVENT,n,e[n][o]):this.emit(he.EVENT.ENTRY_MOVED_EVENT,n,e[n][o]))}},t.prototype.getStructure=function(){var e={},r,n=this.getEntries();for(r=0;r<n.length;r++)e[n[r]]===void 0?e[n[r]]=[r]:e[n[r]].push(r);return e},t.prototype.destroy=function(){for(var e=0;e<this.subscriptions.length;e++)this.record.unsubscribe(this.subscriptions[e],this);this.wrappedFunctions.clear(),this.record.removeContext(this)},t}(Yu.Emitter);Dt.List=Ju});var Ps=y($i=>{"use strict";u();Object.defineProperty($i,"__esModule",{value:!0});$i.SingleNotifier=void 0;var Ki=F(),Ku=function(){function i(t,e,r){this.services=t,this.action=e,this.requests=new Map,this.internalRequests=new Map,this.limboQueue=[],this.services.connection.onLost(this.onConnectionLost.bind(this)),this.services.connection.onExitLimbo(this.onExitLimbo.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this))}return i.prototype.request=function(t,e){var r=this.requests.get(t);if(r){r.push(e);return}this.requests.set(t,[e]);var n={topic:Ki.TOPIC.RECORD,action:this.action,name:t};this.services.connection.isConnected?(this.services.connection.sendMessage(n),this.services.timeoutRegistry.add({message:n})):this.services.connection.isInLimbo?this.limboQueue.push(n):(this.requests.delete(t),e(Ki.EVENT.CLIENT_OFFLINE))},i.prototype.register=function(t,e,r){var n=this.internalRequests.get(t);n?n.push({callback:r,context:e}):this.internalRequests.set(t,[{callback:r,context:e}])},i.prototype.recieve=function(t,e,r){this.services.timeoutRegistry.remove(t);var n=t.name,o=this.requests.get(n)||[],s=this.internalRequests.get(n)||[];if(!(!o&&!s)){for(var c=0;c<s.length;c++)s[c].callback.call(s[c].context,t);this.internalRequests.delete(n);for(var c=0;c<o.length;c++)o[c](e,r);this.requests.delete(n)}},i.prototype.onConnectionLost=function(){this.requests.forEach(function(t){t.forEach(function(e){return e(Ki.EVENT.CLIENT_OFFLINE)})}),this.requests.clear()},i.prototype.onExitLimbo=function(){for(var t=0;t<this.limboQueue.length;t++){var e=this.limboQueue[t],r=this.requests.get(e.name);r&&r.forEach(function(n){return n(Ki.EVENT.CLIENT_OFFLINE)})}this.requests.clear(),this.limboQueue=[]},i.prototype.onConnectionReestablished=function(){for(var t=0;t<this.limboQueue.length;t++){var e=this.limboQueue[t];this.services.connection.sendMessage(e),this.services.timeoutRegistry.add({message:e})}},i}();$i.SingleNotifier=Ku});var Us=y(Pe=>{"use strict";u();var Qi=Pe&&Pe.__assign||function(){return Qi=Object.assign||function(i){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Qi.apply(this,arguments)};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.WriteAcknowledgementService=void 0;var Xe=F(),$u=function(){function i(t){this.services=t,this.responses=new Map,this.count=1,this.services.connection.onLost(this.onConnectionLost.bind(this))}return i.prototype.send=function(t,e){if(this.services.connection.isConnected===!1){this.services.timerRegistry.requestIdleCallback(e.bind(this,Xe.EVENT.CLIENT_OFFLINE,t.name));return}var r=this.count.toString();this.responses.set(r,e),this.services.connection.sendMessage(Qi(Qi({},t),{correlationId:r,isWriteAck:!0})),this.count++},i.prototype.recieve=function(t){var e=t.correlationId,r=this.responses.get(e);!r||t.action!==Xe.RECORD_ACTION.WRITE_ACKNOWLEDGEMENT&&!t.isError&&!t.isWriteAck||(t.action===Xe.RECORD_ACTION.VERSION_EXISTS?r(t.reason||"Write failed due to conflict",t.name):t.isError?r(Xe.RECORD_ACTION[t.action],t.name):r(null,t.name),this.responses.delete(e))},i.prototype.onConnectionLost=function(){this.responses.forEach(function(t){return t(Xe.EVENT.CLIENT_OFFLINE)}),this.responses.clear()},i}();Pe.WriteAcknowledgementService=$u});var Ls=y(Qt=>{"use strict";u();var Qu=Qt&&Qt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o},zu=Qt&&Qt.__spread||function(){for(var i=[],t=0;t<arguments.length;t++)i=i.concat(Qu(arguments[t]));return i};Object.defineProperty(Qt,"__esModule",{value:!0});Qt.DirtyService=void 0;var Xu=function(){function i(t,e){this.storage=t,this.dirtyStorageName=e,this.dirtyRecords=new Map,this.loadedCallback=[],this.flushTimeout=null,this.loaded=!1,this.save=this.save.bind(this),this.load()}return i.prototype.isDirty=function(t){return this.dirtyRecords.has(t)},i.prototype.setDirty=function(t,e){var r=!0;e?this.dirtyRecords.set(t,!0):r=this.dirtyRecords.delete(t),!this.flushTimeout&&r&&(this.flushTimeout=setTimeout(this.save,1e3))},i.prototype.save=function(){this.storage.set(this.dirtyStorageName,1,zu(this.dirtyRecords),function(){}),this.flushTimeout&&clearTimeout(this.flushTimeout),this.flushTimeout=null},i.prototype.whenLoaded=function(t,e){if(this.loaded){e.call(t);return}this.loadedCallback.push({callback:e,context:t})},i.prototype.getAll=function(){return this.dirtyRecords},i.prototype.load=function(){var t=this;this.loaded||this.storage.get(this.dirtyStorageName,function(e,r,n){t.dirtyRecords=n?new Map(n):new Map,t.loaded=!0,t.loadedCallback.forEach(function(o){var s=o.callback,c=o.context;return s.call(c)})})},i}();Qt.DirtyService=Xu});var Bs=y(zt=>{"use strict";u();var Zu=zt&&zt.__values||function(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],r=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},tl=zt&&zt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o};Object.defineProperty(zt,"__esModule",{value:!0});zt.MergeStrategyService=void 0;var Ms=F(),el=function(){function i(t,e){this.services=t,this.defaultStrategy=e,this.strategiesByRecord=new Map,this.strategiesByPattern=new Map}return i.prototype.setMergeStrategyByName=function(t,e){this.strategiesByRecord.set(t,e)},i.prototype.setMergeStrategyByPattern=function(t,e){this.strategiesByPattern.set(t,e)},i.prototype.merge=function(t,e,r,n,o){var s,c,a=t.name,l=this.strategiesByRecord.get(a);if(l){l(r,e,t.parsedData,t.version,function(B,Et){n.call(o,B,t,Et,e,r)});return}try{for(var f=Zu(this.strategiesByPattern),p=f.next();!p.done;p=f.next()){var T=tl(p.value,2),I=T[0],q=T[1];if(I.test(a)){q(r,e,t.parsedData,t.version,function(B,Et){n.call(o,B,t,Et,e,r)});return}}}catch(B){s={error:B}}finally{try{p&&!p.done&&(c=f.return)&&c.call(f)}finally{if(s)throw s.error}}if(this.defaultStrategy){this.defaultStrategy(r,e,t.parsedData,t.version,function(B,Et){n.call(o,B,t,Et,e,r)});return}this.services.logger.error({topic:Ms.TOPIC.RECORD},Ms.EVENT.RECORD_VERSION_EXISTS,{remoteVersion:t.version,recordName:a})},i}();zt.MergeStrategyService=el});var js=y(wt=>{"use strict";u();var xs=wt&&wt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o},il=wt&&wt.__spread||function(){for(var i=[],t=0;t<arguments.length;t++)i=i.concat(xs(arguments[t]));return i},rl=wt&&wt.__values||function(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],r=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(wt,"__esModule",{value:!0});wt.RecordHandler=void 0;var zr=Bt(),C=F(),nl=gs(),ol=Qr(),sl=As(),cl=ws(),al=Jr(),ks=Ps(),ul=Us(),ll=Ls(),hl=Bs(),fl=ze(),dl=function(){function i(t,e,r,n){var o;n===void 0&&(n=new al.Listener(C.TOPIC.RECORD,t)),this.services=t,this.options=e,this.listener=n,this.recordCores=new Map,this.notifyCallbacks=new Map,this.recordServices=r||{bulkSubscriptionService:(o={},o[C.RECORD_ACTION.SUBSCRIBECREATEANDREAD]=this.getBulkSubscriptionService(C.RECORD_ACTION.SUBSCRIBECREATEANDREAD),o[C.RECORD_ACTION.SUBSCRIBEANDREAD]=this.getBulkSubscriptionService(C.RECORD_ACTION.SUBSCRIBEANDREAD),o[C.RECORD_ACTION.SUBSCRIBEANDHEAD]=this.getBulkSubscriptionService(C.RECORD_ACTION.SUBSCRIBEANDHEAD),o),writeAckService:new ul.WriteAcknowledgementService(t),readRegistry:new ks.SingleNotifier(t,C.RECORD_ACTION.READ,e.recordReadTimeout),headRegistry:new ks.SingleNotifier(t,C.RECORD_ACTION.HEAD,e.recordReadTimeout),dirtyService:new ll.DirtyService(t.storage,e.dirtyStorageName),mergeStrategy:new hl.MergeStrategyService(t,e.mergeStrategy)},this.dirtyService=this.recordServices.dirtyService,this.sendUpdatedData=this.sendUpdatedData.bind(this),this.onMergeCompleted=this.onMergeCompleted.bind(this),this.getRecordCore=this.getRecordCore.bind(this),this.removeRecord=this.removeRecord.bind(this),this.onBulkSubscriptionSent=this.onBulkSubscriptionSent.bind(this),this.services.connection.registerHandler(C.TOPIC.RECORD,this.handle.bind(this)),this.services.connection.onReestablished(this.syncDirtyRecords.bind(this)),this.services.connection.isConnected&&this.syncDirtyRecords()}return i.prototype.names=function(){return il(this.recordCores.keys())},i.prototype.setMergeStrategy=function(t,e){if(typeof e=="function")this.recordServices.mergeStrategy.setMergeStrategyByName(t,e);else throw new Error("Invalid merge strategy: Must be a Function")},i.prototype.setMergeStrategyRegExp=function(t,e){if(typeof e=="function")this.recordServices.mergeStrategy.setMergeStrategyByPattern(t,e);else throw new Error("Invalid merge strategy: Must be a Function")},i.prototype.getRecord=function(t){return new ol.Record(this.getRecordCore(t))},i.prototype.getList=function(t){return new cl.List(this.getRecordCore(t))},i.prototype.getAnonymousRecord=function(){return new sl.AnonymousRecord(this.getRecordCore)},i.prototype.listen=function(t,e){this.listener.listen(t,e)},i.prototype.unlisten=function(t){this.listener.unlisten(t)},i.prototype.snapshot=function(t,e){var r=this;if(typeof t!="string"||t.length===0)throw new Error("invalid argument: name");if(e!==void 0&&typeof e!="function")throw new Error("invalid argument: callback");var n=this.recordCores.get(t);if(n){if(e)n.whenReady(null,function(){e(null,n.get())});else return new Promise(function(o,s){n.whenReady(null,function(){o(n.get())})});return}if(e)this.recordServices.readRegistry.request(t,e);else return new Promise(function(o,s){r.recordServices.readRegistry.request(t,function(c,a){return c?s(c):o(a)})})},i.prototype.has=function(t,e){var r=this;if(typeof t!="string"||t.length===0)throw new Error("invalid argument: name");if(e!==void 0&&typeof e!="function")throw new Error("invalid argument: callback");var n;if(!e)return new Promise(function(o,s){n=function(c,a){return c?s(c):o(a!==-1)},r.head(t,n)});n=function(o,s){return o?e(o,null):e(null,s!==-1)},this.head(t,n)},i.prototype.head=function(t,e){var r=this;if(typeof t!="string"||t.length===0)throw new Error("invalid argument: name");if(e!==void 0&&typeof e!="function")throw new Error("invalid argument: callback");var n=this.recordCores.get(t);if(n){if(e)n.whenReady(null,function(){e(null,n.version)});else return new Promise(function(o,s){n.whenReady(null,function(){o(n.version)})});return}if(e)this.recordServices.headRegistry.request(t,e);else return new Promise(function(o,s){r.recordServices.headRegistry.request(t,function(c,a){return c?s(c):o(a)})})},i.prototype.setDataWithAck=function(t){for(var e=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=zr.normalizeSetArguments(arguments,1);if(!o.callback)return new Promise(function(s,c){o.callback=function(a){return a===null?s():c(a)},e.sendSetData(t,-1,o)});this.sendSetData(t,-1,o)},i.prototype.setData=function(t){var e=zr.normalizeSetArguments(arguments,1);this.sendSetData(t,-1,e)},i.prototype.delete=function(t,e){throw Error("Delete is not yet supported without use of a Record")},i.prototype.notify=function(t,e){var r=this;if(!this.services.connection.isConnected){if(e){e(C.EVENT.CLIENT_OFFLINE);return}return new Promise(function(o,s){return s(C.EVENT.CLIENT_OFFLINE)})}var n=zr.getUid();if(this.services.connection.sendMessage({topic:C.TOPIC.RECORD,action:C.RECORD_ACTION.NOTIFY,names:t,correlationId:n}),e)this.notifyCallbacks.set(n,e);else return new Promise(function(o,s){r.notifyCallbacks.set(n,function(c){return c?s(c):o()})})},i.prototype.sendSetData=function(t,e,r){var n=r.path,o=r.data,s=r.callback;if(!t||typeof t!="string"||t.length===0)throw new Error("invalid argument: recordName must be an non empty string");if(!n&&(o===null||typeof o!="object"))throw new Error("invalid argument: data must be an object when no path is provided");var c=this.recordCores.get(t);if(c){c.set({path:n,data:o,callback:s});return}var a;n?o===void 0?a=C.RECORD_ACTION.ERASE:a=C.RECORD_ACTION.CREATEANDPATCH:a=C.RECORD_ACTION.CREATEANDUPDATE;var l={topic:C.TOPIC.RECORD,action:a,name:t,path:n,version:e,parsedData:o};s?this.recordServices.writeAckService.send(l,s):this.services.connection.sendMessage(l)},i.prototype.saveToOfflineStorage=function(){this.recordCores.forEach(function(t){return t.saveRecordToOffline()})},i.prototype.clearOfflineStorage=function(t){var e=this;if(t)this.services.storage.reset(t);else return new Promise(function(r,n){e.services.storage.reset(function(o){return o?n(o):r()})})},i.prototype.handle=function(t){var e=this;if(t.action===C.RECORD_ACTION.NOTIFY&&t.isAck||t.isError&&t.action===C.RECORD_ACTION.RECORD_NOTIFY_ERROR){var r=this.notifyCallbacks.get(t.correlationId);r?(r(t.data||null),this.notifyCallbacks.delete(t.correlationId)):this.services.logger.error(t,C.RECORD_ACTION.NOTIFY);return}if(t.isAck){this.services.timeoutRegistry.remove(t);return}if(t.action===C.RECORD_ACTION.SUBSCRIPTION_FOR_PATTERN_FOUND||t.action===C.RECORD_ACTION.SUBSCRIPTION_FOR_PATTERN_REMOVED||t.action===C.RECORD_ACTION.LISTEN||t.action===C.RECORD_ACTION.UNLISTEN){this.listener.handle(t);return}if(t.isWriteAck&&t.action!==C.RECORD_ACTION.VERSION_EXISTS){this.recordServices.writeAckService.recieve(t);return}if(t.action===C.RECORD_ACTION.READ_RESPONSE||t.originalAction===C.RECORD_ACTION.READ){t.isError?this.recordServices.readRegistry.recieve(t,C.RECORD_ACTION[t.action]):this.recordServices.readRegistry.recieve(t,null,t.parsedData);return}t.action===C.RECORD_ACTION.HEAD_RESPONSE_BULK&&Object.keys(t.versions).forEach(function(o){e.recordServices.headRegistry.recieve({topic:C.TOPIC.RECORD,action:C.RECORD_ACTION.HEAD_RESPONSE,originalAction:C.RECORD_ACTION.HEAD,name:o,version:t.versions[o]},null,t.versions[o])}),(t.action===C.RECORD_ACTION.HEAD_RESPONSE||t.originalAction===C.RECORD_ACTION.HEAD)&&(t.isError?this.recordServices.headRegistry.recieve(t,C.RECORD_ACTION[t.action]):this.recordServices.headRegistry.recieve(t,null,t.version));var n=this.recordCores.get(t.name);if(n){n.handle(t);return}if(t.action!==C.RECORD_ACTION.VERSION_EXISTS&&!(t.action===C.RECORD_ACTION.SUBSCRIPTION_HAS_PROVIDER||t.action===C.RECORD_ACTION.SUBSCRIPTION_HAS_NO_PROVIDER)){if(t.isError){this.services.logger.error(t);return}this.services.logger.error(t,C.EVENT.UNSOLICITED_MESSAGE)}},i.prototype.removeRecord=function(t){this.recordCores.delete(t)},i.prototype.getRecordCore=function(t){var e=this.recordCores.get(t);return e||(e=new nl.RecordCore(t,this.services,this.options,this.recordServices,this.removeRecord),this.recordCores.set(t,e)),e},i.prototype.syncDirtyRecords=function(){this.dirtyService.whenLoaded(this,this._syncDirtyRecords)},i.prototype._syncDirtyRecords=function(){var t,e,r=this.dirtyService.getAll();try{for(var n=rl(r),o=n.next();!o.done;o=n.next()){var s=xs(o.value,1),c=s[0],a=this.recordCores.get(c);a&&a.references.size>0||this.services.storage.get(c,this.sendUpdatedData)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},i.prototype.sendUpdatedData=function(t,e,r){var n=this;if(e===-1){this.services.logger.warn({topic:C.TOPIC.RECORD},C.RECORD_ACTION.DELETE,"Deleted record while offline, can't resolve");return}var o=function(s,c){s?n.recordServices.readRegistry.register(c,n,function(a){n.recordServices.mergeStrategy.merge(a,e,r,n.onMergeCompleted,n)}):n.dirtyService.setDirty(c,!1)};this.sendSetData(t,e,{data:r,callback:o})},i.prototype.onMergeCompleted=function(t,e,r){var n=e.name,o=e.version;this.sendSetData(n,o+1,{data:r})},i.prototype.getBulkSubscriptionService=function(t){return new fl.BulkSubscriptionService(this.services,this.options.subscriptionInterval,C.TOPIC.RECORD,t,C.RECORD_ACTION.UNSUBSCRIBE,this.onBulkSubscriptionSent)},i.prototype.onBulkSubscriptionSent=function(t){t.names||this.services.timeoutRegistry.add({message:t})},i}();wt.RecordHandler=dl});var Vs=y(Xi=>{"use strict";u();Object.defineProperty(Xi,"__esModule",{value:!0});Xi.PresenceHandler=void 0;var w=F(),zi=mt(),El=ze(),yt="OE";function pl(i){var t=null,e=null;if(i.length===1)if(Array.isArray(i[0]))t=i[0];else{if(typeof i[0]!="function")throw new Error('invalid argument: "callback"');e=i[0]}else if(i.length===2&&(t=i[0],e=i[1],!Array.isArray(t)||typeof e!="function"))throw new Error('invalid argument: "users" or "callback"');return{users:t,callback:e}}var Rl=function(){function i(t,e){this.services=t,this.globalSubscriptionEmitter=new zi.Emitter,this.subscriptionEmitter=new zi.Emitter,this.queryEmitter=new zi.Emitter,this.queryAllEmitter=new zi.Emitter,this.counter=0,this.limboQueue=[],this.bulkSubscription=new El.BulkSubscriptionService(this.services,e.subscriptionInterval,w.TOPIC.PRESENCE,w.PRESENCE_ACTION.SUBSCRIBE,w.PRESENCE_ACTION.UNSUBSCRIBE,this.onBulkSubscriptionSent.bind(this)),this.services.connection.registerHandler(w.TOPIC.PRESENCE,this.handle.bind(this)),this.services.connection.onExitLimbo(this.onExitLimbo.bind(this)),this.services.connection.onLost(this.onExitLimbo.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this))}return i.prototype.subscribe=function(t,e){if(typeof t=="string"&&t.length>0&&typeof e=="function"){var r=t;this.subscriptionEmitter.hasListeners(r)||this.bulkSubscription.subscribe(r),this.subscriptionEmitter.on(r,e);return}if(typeof t=="function"&&typeof e=="undefined"){this.globalSubscriptionEmitter.hasListeners(yt)||this.subscribeToAllChanges(),this.globalSubscriptionEmitter.on(yt,t);return}throw new Error('invalid arguments: "user" or "callback"')},i.prototype.unsubscribe=function(t,e){if(t&&typeof t=="string"&&t.length>0){var r=t;if(e){if(typeof e!="function")throw new Error('invalid argument: "callback"');this.subscriptionEmitter.off(r,e)}else this.subscriptionEmitter.off(r);if(!this.subscriptionEmitter.hasListeners(r)){this.bulkSubscription.unsubscribe(r);return}}if(t&&typeof t=="function"){e=t,this.globalSubscriptionEmitter.off(yt,e),this.globalSubscriptionEmitter.hasListeners(yt)||this.unsubscribeToAllChanges();return}if(typeof t=="undefined"&&typeof e=="undefined"){this.subscriptionEmitter.off(),this.globalSubscriptionEmitter.off(),this.bulkSubscription.unsubscribeList(this.subscriptionEmitter.eventNames()),this.unsubscribeToAllChanges();return}throw new Error('invalid argument: "user" or "callback"')},i.prototype.getAll=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=pl(t),n=r.callback,o=r.users,s,c,a;if(o){var l=(this.counter++).toString();s={topic:w.TOPIC.PRESENCE,action:w.PRESENCE_ACTION.QUERY,correlationId:l,names:o},c=this.queryEmitter,a=l}else s={topic:w.TOPIC.PRESENCE,action:w.PRESENCE_ACTION.QUERY_ALL},c=this.queryAllEmitter,a=yt;if(this.services.connection.isConnected?this.sendQuery(s):this.services.connection.isInLimbo?this.limboQueue.push(s):this.services.timerRegistry.requestIdleCallback(function(){c.emit(a,w.EVENT.CLIENT_OFFLINE)}),n){c.once(a,n);return}return new Promise(function(f,p){c.once(a,function(T,I){return T?p(T):f(I)})})},i.prototype.handle=function(t){if(t.isAck){this.services.timeoutRegistry.remove(t);return}if(t.action===w.PRESENCE_ACTION.QUERY_ALL_RESPONSE){this.queryAllEmitter.emit(yt,null,t.names),this.services.timeoutRegistry.remove(t);return}if(t.action===w.PRESENCE_ACTION.QUERY_RESPONSE){this.queryEmitter.emit(t.correlationId,null,t.parsedData),this.services.timeoutRegistry.remove(t);return}if(t.action===w.PRESENCE_ACTION.PRESENCE_JOIN){this.subscriptionEmitter.emit(t.name,t.name,!0);return}if(t.action===w.PRESENCE_ACTION.PRESENCE_JOIN_ALL){this.globalSubscriptionEmitter.emit(yt,t.name,!0);return}if(t.action===w.PRESENCE_ACTION.PRESENCE_LEAVE){this.subscriptionEmitter.emit(t.name,t.name,!1);return}if(t.action===w.PRESENCE_ACTION.PRESENCE_LEAVE_ALL){this.globalSubscriptionEmitter.emit(yt,t.name,!1);return}if(t.isError){this.services.timeoutRegistry.remove(t),t.originalAction===w.PRESENCE_ACTION.QUERY?this.queryEmitter.emit(t.correlationId,w.PRESENCE_ACTION[t.action]):t.originalAction===w.PRESENCE_ACTION.QUERY_ALL?this.queryAllEmitter.emit(yt,w.PRESENCE_ACTION[t.action]):this.services.logger.error(t);return}this.services.logger.error(t,w.EVENT.UNSOLICITED_MESSAGE)},i.prototype.sendQuery=function(t){this.services.connection.sendMessage(t),this.services.timeoutRegistry.add({message:t})},i.prototype.subscribeToAllChanges=function(){if(!!this.services.connection.isConnected){var t={topic:w.TOPIC.PRESENCE,action:w.PRESENCE_ACTION.SUBSCRIBE_ALL};this.services.timeoutRegistry.add({message:t}),this.services.connection.sendMessage(t)}},i.prototype.unsubscribeToAllChanges=function(){if(!!this.services.connection.isConnected){var t={topic:w.TOPIC.PRESENCE,action:w.PRESENCE_ACTION.UNSUBSCRIBE_ALL};this.services.timeoutRegistry.add({message:t}),this.services.connection.sendMessage(t)}},i.prototype.onConnectionReestablished=function(){var t=this.subscriptionEmitter.eventNames();t.length>0&&this.bulkSubscription.subscribeList(t);var e=this.globalSubscriptionEmitter.hasListeners(yt);e&&this.subscribeToAllChanges();for(var r=0;r<this.limboQueue.length;r++)this.sendQuery(this.limboQueue[r]);this.limboQueue=[]},i.prototype.onExitLimbo=function(){var t=this;this.queryEmitter.eventNames().forEach(function(e){t.queryEmitter.emit(e,w.EVENT.CLIENT_OFFLINE)}),this.queryAllEmitter.emit(yt,w.EVENT.CLIENT_OFFLINE),this.limboQueue=[],this.queryAllEmitter.off(),this.queryEmitter.off()},i.prototype.onBulkSubscriptionSent=function(t){this.services.timeoutRegistry.add({message:t})},i}();Xi.PresenceHandler=Rl});var Fs=y(Zt=>{"use strict";u();var yl=Zt&&Zt.__values||function(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],r=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Sl=Zt&&Zt.__read||function(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var r=e.call(i),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(c){s={error:c}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return o};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.Storage=void 0;var Xt;(function(i){i[i.GET=0]="GET",i[i.SET=1]="SET",i[i.DELETE=2]="DELETE"})(Xt||(Xt={}));var _l=function(){function i(t){var e=this;if(this.options=t,this.isReady=!1,this.queuedRequests=new Map,this.flushTimeout=null,typeof indexedDB=="undefined"||indexedDB===null)throw new Error("IndexDB currently not supported when deepstream in node");this.flush=this.flush.bind(this);var r=t.indexdb,n=r.objectStoreNames,o=r.storageDatabaseName,s=r.defaultObjectStoreName,c=r.primaryKey;n.includes(s)||n.push(s);var a=t.indexdb.dbVersion;if(t.indexdb.autoVersion){var l=localStorage.getItem("deepstream-db/"+o);if(l){var f=JSON.parse(l),p=f.objectStoreNames.length!==n.length||f.objectStoreNames.some(function(I){return!n.includes(I)});p?a=f.dbVersion+1:a=f.dbVersion}else a=1}var T=indexedDB.open(o,a);T.onerror=function(I){console.error("Error opening index "+o,I)},T.onsuccess=function(I){e.db=I.target.result,e.onReady()},T.onupgradeneeded=function(){var I=T.result;n.forEach(function(B){I.objectStoreNames.contains(B)||I.createObjectStore(B,{keyPath:c})});for(var q=0;q<I.objectStoreNames.length;q++)n.includes(I.objectStoreNames[q])===!1&&I.deleteObjectStore(I.objectStoreNames[q]);t.indexdb.autoVersion&&localStorage.setItem("deepstream-db/"+o,JSON.stringify({dbVersion:a,objectStoreNames:n}))}}return i.prototype.get=function(t,e){var r=this.options.indexdb.ignorePrefixes.some(function(n){return t.startsWith(n)});if(r){e(t,-1,null);return}this.insertRequest({recordName:t,callback:e,operation:Xt.GET})},i.prototype.set=function(t,e,r,n){var o=this.options.indexdb.ignorePrefixes.some(function(s){return t.startsWith(s)});if(o){n(null,t);return}this.insertRequest({recordName:t,version:e,callback:n,data:r,operation:Xt.SET})},i.prototype.delete=function(t,e){var r=this.options.indexdb.ignorePrefixes.some(function(n){return t.startsWith(n)});if(r){e(null,t);return}this.insertRequest({recordName:t,callback:e,operation:Xt.DELETE})},i.prototype.reset=function(t){var e=this;this.db&&(this.db.close(),this.db=null);var r=indexedDB.deleteDatabase(this.options.indexdb.storageDatabaseName);r.onblocked=function(){return setTimeout(function(){return e.reset(t)},1e3)},r.onsuccess=function(){return t(null)},r.onerror=function(n){var o="Error deleting database "+e.options.indexdb.storageDatabaseName;console.error(o,n),t(o)}},i.prototype.registerFlush=function(){this.isReady&&!this.flushTimeout&&(this.flushTimeout=setTimeout(this.flush,this.options.indexdb.flushTimeout))},i.prototype.flush=function(){var t,e,r=this,n=this.db.transaction(this.queuedRequests.keys(),"readwrite"),o=function(p,T){var I=n.objectStore(p);T.forEach(function(q){var B,Et=q.operation,Nt=q.recordName,_=q.version,O=q.data,v=q.callback;switch(Et){case Xt.GET:{var m=I.get(Nt);m.onerror=function(Tt){throw new Error("Requesting record "+Nt+" failed")},m.onsuccess=function(){m.result?v(Nt,m.result.version,m.result.data):v(Nt,-1,null)};break}case Xt.DELETE:{var k=I.delete(Nt);k.onsuccess=function(){return v(null)},k.onerror=function(Tt){return v(Tt.errorCode)};break}case Xt.SET:{var k=I.put((B={},B[r.options.indexdb.primaryKey]=Nt,B.version=_,B.data=O,B));k.onsuccess=function(){return v(null)},k.onerror=function(at){return v(at.errorCode)};break}}})};try{for(var s=yl(this.queuedRequests),c=s.next();!c.done;c=s.next()){var a=Sl(c.value,2),l=a[0],f=a[1];o(l,f)}}catch(p){t={error:p}}finally{try{c&&!c.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}this.queuedRequests.clear(),this.flushTimeout=null},i.prototype.onReady=function(){this.isReady=!0,this.flush()},i.prototype.insertRequest=function(t){var e=t.recordName.indexOf("/"),r;e>-1?(r=t.recordName.substring(0,e),this.options.indexdb.objectStoreNames.indexOf(r)===-1?(console.error("Object store names need to be predefined, missing "+r+". Using default objectStore instead."),r=this.options.indexdb.defaultObjectStoreName):t.recordName=t.recordName.substring(e+1,t.recordName.length)):r=this.options.indexdb.defaultObjectStoreName;var n=this.queuedRequests.get(r);n===void 0?this.queuedRequests.set(r,[t]):n.push(t),this.registerFlush()},i}();Zt.Storage=_l});var Hs=y(Zi=>{"use strict";u();Object.defineProperty(Zi,"__esModule",{value:!0});Zi.NoopStorage=void 0;var Ol=function(){function i(){this.isReady=!0}return i.prototype.get=function(t,e){setTimeout(e.bind(this,t,-1,null),0)},i.prototype.set=function(t,e,r,n){setTimeout(n,0)},i.prototype.delete=function(t,e){setTimeout(e,0)},i.prototype.reset=function(t){t(null)},i}();Zi.NoopStorage=Ol});var qs=y(dt=>{"use strict";u();var Nl=dt&&dt.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},i(t,e)};return function(t,e){i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),tr=dt&&dt.__assign||function(){return tr=Object.assign||function(i){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},tr.apply(this,arguments)};Object.defineProperty(dt,"__esModule",{value:!0});dt.DefaultOptions=dt.C=dt.DeepstreamClient=void 0;var Gs=qn();Object.defineProperty(dt,"DefaultOptions",{enumerable:!0,get:function(){return Gs.DefaultOptions}});var Tl=F();dt.C=Tl;var Il=so(),Cl=uo(),vl=lo(),bl=ho(),ml=Es(),gl=ys(),Al=_s(),Dl=Cs(),wl=js(),Pl=Vs(),Ul=mt(),Ll=Fs(),Ml=Hs(),Bl=function(i){Nl(t,i);function t(e,r){r===void 0&&(r={});var n=i.call(this)||this;n.options=tr(tr({},Gs.DefaultOptions),r);var o={};return o.logger=new Il.Logger(n),r.nativeTimerRegistry?o.timerRegistry=new bl.NativeTimerRegistry:o.timerRegistry=new vl.IntervalTimerRegistry(n.options.intervalTimerResolution),o.timeoutRegistry=new Cl.TimeoutRegistry(o,n.options),o.socketFactory=n.options.socketFactory||gl.socketFactory,o.connection=new ml.Connection(o,n.options,e,n),n.options.offlineEnabled?o.storage=n.options.storage||new Ll.Storage(n.options):o.storage=new Ml.NoopStorage,n.services=o,n.services.connection.onLost(o.timeoutRegistry.onConnectionLost.bind(o.timeoutRegistry)),n.event=new Al.EventHandler(n.services,n.options),n.rpc=new Dl.RPCHandler(n.services,n.options),n.record=new wl.RecordHandler(n.services,n.options),n.presence=new Pl.PresenceHandler(n.services,n.options),n}return t.prototype.login=function(e,r){var n=this;if(e&&typeof e=="object")if(r)this.services.connection.authenticate(e,r);else return new Promise(function(o,s){n.services.connection.authenticate(e,function(c,a){c?o(a):s(a)})});else if(typeof e=="function")this.services.connection.authenticate({},e);else return new Promise(function(o,s){n.services.connection.authenticate({},function(c,a){c?o(a):s(a)})})},t.prototype.getConnectionState=function(){return this.services.connection.getConnectionState()},t.prototype.close=function(){var e=this;Object.keys(this.services).forEach(function(r){e.services[r].close&&e.services[r].close()})},t.prototype.pause=function(){this.services.connection.pause()},t.prototype.resume=function(e){var r=this;if(e){this.services.connection.resume(e);return}return new Promise(function(n,o){r.services.connection.resume(function(s){s?o(s):n()})})},t.prototype.getUid=function(){var e=new Date().getTime().toString(36),r=(Math.random()*1e16).toString(36).replace(".","");return e+"-"+r},t}(Ul.Emitter);dt.DeepstreamClient=Bl});var Ws=y(te=>{"use strict";u();Object.defineProperty(te,"__esModule",{value:!0});te.Options=te.C=te.DeepstreamClient=void 0;var Xr=qs();Object.defineProperty(te,"DeepstreamClient",{enumerable:!0,get:function(){return Xr.DeepstreamClient}});Object.defineProperty(te,"C",{enumerable:!0,get:function(){return Xr.C}});Object.defineProperty(te,"Options",{enumerable:!0,get:function(){return Xr.DefaultOptions}})});u();u();var Ql=Ei("log","party-debug","background-color: #888; color: #fff; padding: 2px 5px; border-radius: 2px"),di=Ei("log","party-log","background-color: #88F; color: #00ffff; padding: 2px 5px; border-radius: 2px"),rt=Ei("warn","party-warn","background-color: #FF0; color: #000; padding: 2px 5px; border-radius: 2px"),L=Ei("error","party-error","background-color: #ff0000; color: #ffffff; padding: 2px 5px; border-radius: 2px");function Ei(i,t,e){return console[i].bind(window.console,`%c${t}`,e)}var br=console.log.bind(window.console,"%cparty-log%c %c%s","background-color: #88F; color: #00ffff; padding: 2px 5px; border-radius: 2px","background: none;");u();var Hn="0.9.1";u();var ec=Er(Ws());u();u();function kl(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];var r=Array.from(typeof i=="string"?[i]:i);r[r.length-1]=r[r.length-1].replace(/\r?\n([\t ]*)$/,"");var n=r.reduce(function(c,a){var l=a.match(/\n([\t ]+|(?!\s).)/g);return l?c.concat(l.map(function(f){var p,T;return(T=(p=f.match(/[\t ]/g))===null||p===void 0?void 0:p.length)!==null&&T!==void 0?T:0})):c},[]);if(n.length){var o=new RegExp(`
[	 ]{`+Math.min.apply(Math,n)+"}","g");r=r.map(function(c){return c.replace(o,`
`)})}r[0]=r[0].replace(/^\r?\n/,"");var s=r[0];return t.forEach(function(c,a){var l=s.match(/(?:^|\n)( *)$/),f=l?l[1]:"",p=c;typeof c=="string"&&c.includes(`
`)&&(p=String(c).split(`
`).map(function(T,I){return I===0?T:""+f+T}).join(`
`)),s+=p+r[a+1]}),s}var Zr=kl;var en=Er(F()),xl=Er(Qr());function Ze(i,t="unknown"){let e=tn(i,"");if(!e){let r="";kt&&(r=`
"${t}${kt.path}" ${kt.message}`),rt(`User provided data is not JSON serializable.${r}`)}return e}function er(i,t){return typeof i!="object"?(rt("User provided data is not an object."),!1):Ze(i,t)}function ir(i){return typeof i!="object"?!1:Object.keys(i).length===0}function Ys(i){return typeof i!="undefined"}var kt;function tn(i,t=""){if(kt=null,["string","number","boolean"].includes(typeof i)||i===null)return!0;if(Array.isArray(i)){for(let[e,r]of Object.entries(i))if(!tn(r,`${t}[${e}]`))return!1;return!0}if(typeof i=="object"&&i.constructor===Object){for(let[e,r]of Object.entries(i))if(!tn(r,`${t}.${e}`))return!1;return!0}return typeof i=="function"?(kt={path:t,message:"is a function. Functions are not allowed."},!1):typeof i=="symbol"?(kt={path:t,message:"is a symbol. Symbols are not allowed."},!1):typeof i=="object"&&Ys(window.p5)&&i.constructor===window.p5.Color?(kt={path:t,message:Zr`is a p5.Color. p5.Colors are not allowed.

        You can't share p5.Colors with p5.party.

        In many cases you can convert a p5.Color to a string and share that.
        const c = color(255, 0, 0);
        shared.color = c.toString();
    `},!1):typeof i=="object"&&Ys(window.p5)&&i.constructor===window.p5.Vector?(kt={path:t,message:Zr`is a p5.Vector. p5.Vector are not allowed.

        You can't share p5.Vector with p5.party.

        In some cases you can unpack just the x, y, and z values and share those.
        const v = createVector(1, 2);
        shared.pos = {x: v.x, y: v.y};
    `},!1):typeof i=="object"||typeof i=="undefined"?!0:(kt={path:t,message:"is an unknown type. p5.party doesn't know what to do with it."},!1)}u();u();u();var Ue=".",ti=Symbol("target"),rn=Symbol("unsubscribe");u();function ei(i){return i instanceof Date||i instanceof Set||i instanceof Map||i instanceof WeakSet||i instanceof WeakMap||ArrayBuffer.isView(i)}function Js(i){return(typeof i=="object"?i===null:typeof i!="function")||i instanceof RegExp}u();u();var ct=Array.isArray;u();function fe(i){return typeof i=="symbol"}var jl={after:(i,t)=>ct(i)?i.slice(t.length):t===""?i:i.slice(t.length+1),concat:(i,t)=>ct(i)?(i=[...i],t&&i.push(t),i):t&&t.toString!==void 0?(i!==""&&(i+=Ue),fe(t)?i+t.toString():i+t):i,initial:i=>{if(ct(i))return i.slice(0,-1);if(i==="")return i;let t=i.lastIndexOf(Ue);return t===-1?"":i.slice(0,t)},last:i=>{if(ct(i))return i[i.length-1]||"";if(i==="")return i;let t=i.lastIndexOf(Ue);return t===-1?i:i.slice(t+1)},walk:(i,t)=>{if(ct(i))for(let e of i)t(e);else if(i!==""){let e=0,r=i.indexOf(Ue);if(r===-1)t(i);else for(;e<i.length;)r===-1&&(r=i.length),t(i.slice(e,r)),e=r+1,r=i.indexOf(Ue,e)}},get(i,t){return this.walk(t,e=>{i&&(i=i[e])}),i}},tt=jl;u();function nn(i){return typeof i=="object"&&typeof i.next=="function"}u();function on(i,t,e,r,n){let o=i.next;if(t.name==="entries")i.next=function(){let s=o.call(this);return s.done===!1&&(s.value[0]=n(s.value[0],t,s.value[0],r),s.value[1]=n(s.value[1],t,s.value[0],r)),s};else if(t.name==="values"){let s=e[ti].keys();i.next=function(){let c=o.call(this);return c.done===!1&&(c.value=n(c.value,t,s.next().value,r)),c}}else i.next=function(){let s=o.call(this);return s.done===!1&&(s.value=n(s.value,t,s.value,r)),s};return i}u();function rr(i,t,e){return i.isUnsubscribed||t.ignoreSymbols&&fe(e)||t.ignoreUnderscores&&e.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(e)}u();var ii=class{constructor(t){this._equals=t,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(t){let e=this._getDescriptorCache(),r=e.get(t);return r===void 0&&(r={},e.set(t,r)),r}_getOwnPropertyDescriptor(t,e){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(t,e);let r=this._getProperties(t),n=r[e];return n===void 0&&(n=Reflect.getOwnPropertyDescriptor(t,e),r[e]=n),n}getProxy(t,e,r,n){if(this.isUnsubscribed)return t;let o=t[n],s=o||t;this._pathCache.set(s,e);let c=this._proxyCache.get(s);return c===void 0&&(c=o===void 0?new Proxy(t,r):t,this._proxyCache.set(s,c)),c}getPath(t){return this.isUnsubscribed?void 0:this._pathCache.get(t)}isDetached(t,e){return!Object.is(t,tt.get(e,this.getPath(t)))}defineProperty(t,e,r){return Reflect.defineProperty(t,e,r)?(this.isUnsubscribed||(this._getProperties(t)[e]=r),!0):!1}setProperty(t,e,r,n,o){if(!this._equals(o,r)||!(e in t)){let s=this._getOwnPropertyDescriptor(t,e);return s!==void 0&&"set"in s?Reflect.set(t,e,r,n):Reflect.set(t,e,r)}return!0}deleteProperty(t,e,r){if(Reflect.deleteProperty(t,e)){if(!this.isUnsubscribed){let n=this._getDescriptorCache().get(t);n&&(delete n[e],this._pathCache.delete(r))}return!0}return!1}isSameDescriptor(t,e,r){let n=this._getOwnPropertyDescriptor(e,r);return t!==void 0&&n!==void 0&&Object.is(t.value,n.value)&&(t.writable||!1)===(n.writable||!1)&&(t.enumerable||!1)===(n.enumerable||!1)&&(t.configurable||!1)===(n.configurable||!1)&&t.get===n.get&&t.set===n.set}isGetInvariant(t,e){let r=this._getOwnPropertyDescriptor(t,e);return r!==void 0&&r.configurable!==!0&&r.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};u();u();function Le(i){return toString.call(i)==="[object Object]"}u();u();u();function Me(){return!0}u();function ee(i,t){return i.length!==t.length||i.some((e,r)=>t[r]!==e)}u();var nr=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]);var Vl=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),sn={push:Me,pop:Me,shift:Me,unshift:Me,copyWithin:ee,reverse:ee,sort:ee,splice:ee,flat:ee,fill:ee},Ks=new Set([...nr,...Vl,...Object.keys(sn)]);u();u();function Be(i,t){if(i.size!==t.size)return!0;for(let e of i)if(!t.has(e))return!0;return!1}var cn=["keys","values","entries"],an=new Set(["has","toString"]),un={add:Be,clear:Be,delete:Be,forEach:Be},$s=new Set([...an,...Object.keys(un),...cn]);u();u();function ke(i,t){if(i.size!==t.size)return!0;let e;for(let[r,n]of i)if(e=t.get(r),e!==n||e===void 0&&!t.has(r))return!0;return!1}var Fl=new Set([...an,"get"]),ln={set:ke,clear:ke,delete:ke,forEach:ke},Qs=new Set([...Fl,...Object.keys(ln),...cn]);var $=class{constructor(t,e,r,n){this._path=e,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=n,this._changes=n?[]:null,this.clone=e===void 0?t:this._shallowClone(t)}static isHandledMethod(t){return nr.has(t)}_shallowClone(t){let e=t;if(Le(t))e=He({},t);else if(ct(t)||ArrayBuffer.isView(t))e=[...t];else if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set([...t].map(r=>this._shallowClone(r)));else if(t instanceof Map){e=new Map;for(let[r,n]of t.entries())e.set(r,this._shallowClone(n))}return this._clonedCache.add(e),e}preferredThisArg(t,e,r,n){return t?(ct(n)?this._onIsChanged=sn[e]:n instanceof Set?this._onIsChanged=un[e]:n instanceof Map&&(this._onIsChanged=ln[e]),n):r}update(t,e,r){let n=tt.after(t,this._path);if(e!=="length"){let o=this.clone;tt.walk(n,s=>{o&&o[s]&&(this._clonedCache.has(o[s])||(o[s]=this._shallowClone(o[s])),o=o[s])}),this._hasOnValidate&&this._changes.push({path:n,property:e,previous:r}),o&&o[e]&&(o[e]=r)}this._isChanged=!0}undo(t){let e;for(let r=this._changes.length-1;r!==-1;r--)e=this._changes[r],tt.get(t,e.path)[e.property]=e.previous}isChanged(t){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,t)}};u();var xe=class extends ${static isHandledMethod(t){return Ks.has(t)}};u();var ri=class extends ${undo(t){t.setTime(this.clone.getTime())}isChanged(t,e){return!e(this.clone.valueOf(),t.valueOf())}};u();var je=class extends ${static isHandledMethod(t){return $s.has(t)}undo(t){for(let e of this.clone)t.add(e);for(let e of t)this.clone.has(e)||t.delete(e)}};u();var Ve=class extends ${static isHandledMethod(t){return Qs.has(t)}undo(t){for(let[e,r]of this.clone.entries())t.set(e,r);for(let e of t.keys())this.clone.has(e)||t.delete(e)}};u();var ni=class extends ${constructor(t,e,r,n){super(void 0,e,r,n),this._arg1=r[0],this._weakValue=t.has(this._arg1)}isChanged(t){return this._weakValue!==t.has(this._arg1)}undo(t){this._weakValue&&!t.has(this._arg1)?t.add(this._arg1):t.delete(this._arg1)}};u();var oi=class extends ${constructor(t,e,r,n){super(void 0,e,r,n),this._weakKey=r[0],this._weakHas=t.has(this._weakKey),this._weakValue=t.get(this._weakKey)}isChanged(t){return this._weakValue!==t.get(this._weakKey)}undo(t){let e=t.has(this._weakKey);this._weakHas&&!e?t.set(this._weakKey,this._weakValue):!this._weakHas&&e?t.delete(this._weakKey):this._weakValue!==t.get(this._weakKey)&&t.set(this._weakKey,this._weakValue)}};var St=class{constructor(t){this._stack=[],this._hasOnValidate=t}static isHandledType(t){return Le(t)||ct(t)||ei(t)}static isHandledMethod(t,e){return Le(t)?$.isHandledMethod(e):ct(t)?xe.isHandledMethod(e):t instanceof Set?je.isHandledMethod(e):t instanceof Map?Ve.isHandledMethod(e):ei(t)}get isCloning(){return this._stack.length>0}start(t,e,r){let n=$;ct(t)?n=xe:t instanceof Date?n=ri:t instanceof Set?n=je:t instanceof Map?n=Ve:t instanceof WeakSet?n=ni:t instanceof WeakMap&&(n=oi),this._stack.push(new n(t,e,r,this._hasOnValidate))}update(t,e,r){this._stack[this._stack.length-1].update(t,e,r)}preferredThisArg(t,e,r){let{name:n}=t,o=St.isHandledMethod(r,n);return this._stack[this._stack.length-1].preferredThisArg(o,n,e,r)}isChanged(t,e,r){return this._stack[this._stack.length-1].isChanged(t,e,r)}undo(t){this._previousClone!==void 0&&this._previousClone.undo(t)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}};var Hl={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},hn=(i,t,e={})=>{e=He(He({},Hl),e);let r=Symbol("ProxyTarget"),{equals:n,isShallow:o,ignoreDetached:s,details:c}=e,a=new ii(n),l=typeof e.onValidate=="function",f=new St(l),p=(_,O,v,m,k)=>!l||f.isCloning||e.onValidate(tt.concat(a.getPath(_),O),v,m,k)===!0,T=(_,O,v,m)=>{!rr(a,e,O)&&!(s&&a.isDetached(_,i))&&I(a.getPath(_),O,v,m)},I=(_,O,v,m,k)=>{f.isCloning?f.update(_,O,m):t(tt.concat(_,O),v,m,k)},q=_=>_&&(_[r]||_),B=(_,O,v,m)=>Js(_)||v==="constructor"||o&&!St.isHandledMethod(O,v)||rr(a,e,v)||a.isGetInvariant(O,v)||s&&a.isDetached(O,i)?_:(m===void 0&&(m=a.getPath(O)),a.getProxy(_,tt.concat(m,v),Et,r)),Et={get(_,O,v){if(fe(O)){if(O===r||O===ti)return _;if(O===rn&&!a.isUnsubscribed&&a.getPath(_).length===0)return a.unsubscribe(),_}let m=ei(_)?Reflect.get(_,O):Reflect.get(_,O,v);return B(m,_,O)},set(_,O,v,m){v=q(v);let k=_[r]||_,Tt=k[O];if(n(Tt,v)&&O in _)return!0;let at=p(_,O,v,Tt);return at&&a.setProperty(k,O,v,m,Tt)?(T(_,O,_[O],Tt),!0):!at},defineProperty(_,O,v){if(!a.isSameDescriptor(v,_,O)){let m=_[O];p(_,O,v.value,m)&&a.defineProperty(_,O,v,m)&&T(_,O,v.value,m)}return!0},deleteProperty(_,O){if(!Reflect.has(_,O))return!0;let v=Reflect.get(_,O),m=p(_,O,void 0,v);return m&&a.deleteProperty(_,O,v)?(T(_,O,void 0,v),!0):!m},apply(_,O,v){let m=O[r]||O;if(a.isUnsubscribed)return Reflect.apply(_,m,v);if((c===!1||c!==!0&&!c.includes(_.name))&&St.isHandledType(m)){let k=tt.initial(a.getPath(_)),Tt=St.isHandledMethod(m,_.name);f.start(m,k,v);let at=Reflect.apply(_,f.preferredThisArg(_,O,m),Tt?v.map(ui=>q(ui)):v),oc=f.isChanged(m,n),pn=f.stop();if(St.isHandledType(at)&&Tt&&(O instanceof Map&&_.name==="get"&&(k=tt.concat(k,v[0])),at=a.getProxy(at,k,Et)),oc){let ui={name:_.name,args:v,result:at},Rn=f.isCloning?tt.initial(k):k,yn=f.isCloning?tt.last(k):"";p(tt.get(i,Rn),yn,m,pn,ui)?I(Rn,yn,m,pn,ui):f.undo(m)}return(O instanceof Map||O instanceof Set)&&nn(at)?on(at,_,O,k,B):at}return Reflect.apply(_,O,v)}},Nt=a.getProxy(i,e.pathAsArray?[]:"",Et);return t=t.bind(Nt),l&&(e.onValidate=e.onValidate.bind(Nt)),Nt};hn.target=i=>i&&i[ti]||i;hn.unsubscribe=i=>i[rn]||i;var fn=hn;u();function or(i,t,e=""){if(typeof i!="object"){L("_old is not an object");return}if(typeof t!="object"){L("_new is not an object");return}let r=Object.keys(i).reverse(),n=Object.keys(t);for(let o of r)Object.prototype.hasOwnProperty.call(t,o)||(Array.isArray(i)?i.splice(parseInt(o),1):delete i[o]);for(let o of n)Object.prototype.hasOwnProperty.call(i,o)||(i[o]=t[o]);for(let o of n)if(Object.prototype.hasOwnProperty.call(i,o)){let s=zs(i[o]),c=zs(t[o]);if(c==="unsupported"){L(`${e}.${o} is unsupported type: ${typeof t[o]}`);continue}if(s==="object"&&c==="object"){or(i[o],t[o],`${e}.${o}`);continue}if(s==="array"&&c==="array"){or(i[o],t[o],`${e}.${o}`);continue}i[o]!==t[o]&&(i[o]=t[o])}}function zs(i){return i===null?"null":Array.isArray(i)?"array":typeof i=="object"?"object":typeof i=="boolean"||typeof i=="number"&&Number.isFinite(i)||typeof i=="string"?"primitive":"unsupported"}var dn=new WeakMap,Fe,et,G,de,si,Pt,sr,Xs,cr,Zs,ar,tc,_t=class{constructor(t,e){P(this,sr);P(this,cr);P(this,ar);P(this,Fe,void 0);P(this,et,void 0);P(this,G,void 0);P(this,de,void 0);P(this,si,void 0);P(this,Pt,void 0);U(this,Fe,t),U(this,et,e),U(this,G,null),U(this,de,{}),U(this,si,fn(E(this,de),It(this,cr,Zs).bind(this),{onValidate:It(this,sr,Xs).bind(this)})),U(this,Pt,null),dn.set(E(this,de),this)}load(t){return st(this,null,function*(){if(E(this,Pt))return rt("Record.load() called twice!",E(this,et)),E(this,Pt);if(E(this,Fe).getConnectionState()!=="OPEN"){L("Record.load() called before room is connected.",E(this,et));return}return U(this,Pt,(()=>st(this,null,function*(){U(this,G,E(this,Fe).record.getRecord(E(this,et))),E(this,G).subscribe(It(this,ar,tc).bind(this),!0),yield E(this,G).whenReady(),t&&(yield this.initData(t))}))()),E(this,Pt)})}get whenLoaded(){return E(this,Pt)===null?(L("Record.whenLoaded called before load().",E(this,et)),Promise.reject(new Error("Record.whenLoaded called before load()."))):E(this,Pt)}initData(t){return st(this,null,function*(){var e;if(!((e=E(this,G))!=null&&e.isReady)){L("Record.initData() called before record ready.",E(this,et));return}!ir(E(this,G).get())||!er(t,"init-data")||(yield E(this,G).setWithAck(t))})}setData(t){var e;if(!((e=E(this,G))!=null&&e.isReady)){L(`Record.setData() called before record ready. ${E(this,et)}
 Ignored: ${JSON.stringify(t)}`);return}!er(t,"set-data")||E(this,G).set(t)}watchShared(t,e,r){var n;if(!((n=E(this,G))!=null&&n.isReady)){rt(`watchShared() called on '${E(this,et)}' before ready.`);return}E(this,G).subscribe(t,e,r)}get shared(){return E(this,si)}get name(){return E(this,et)}delete(){return st(this,null,function*(){var t;if(!((t=E(this,G))!=null&&t.isReady)){L(`delete() called on ${E(this,et)} before ready.`);return}return new Promise(e=>{var r,n;(r=E(this,G))==null||r.once("delete",e),(n=E(this,G))==null||n.delete()})})}_set(t,e){return st(this,null,function*(){var r;yield(r=E(this,G))==null?void 0:r.setWithAck(t,e)})}_get(t){var e;return(e=E(this,G))==null?void 0:e.get(t)}static recordForShared(t){let e=fn.target(t);if(!dn.has(e)){L("No record found for shared object.");return}return dn.get(e)}};Fe=new WeakMap,et=new WeakMap,G=new WeakMap,de=new WeakMap,si=new WeakMap,Pt=new WeakMap,sr=new WeakSet,Xs=function(t,e,r){return Ze(e,`${E(this,et)}/${t}`)},cr=new WeakSet,Zs=function(t,e,r){var n;if(!((n=E(this,G))!=null&&n.isReady)){rt(`Shared object written to before ready. ${E(this,et)}
 Ignored: ${t} = ${JSON.stringify(e)}`);return}this._set(t,e)},ar=new WeakSet,tc=function(t){er(t,"server-data")||L("Incoming server data not valid."),or(E(this,de),t,"shared")};var z,Ot,Ut,ie,re,Ee,Lt,ci,ot,ne,lr,ic,hr,rc,fr,nc,ai,En,ur=class{constructor(t,e,r){P(this,lr);P(this,hr);P(this,fr);P(this,ai);P(this,z,void 0);P(this,Ot,void 0);P(this,Ut,void 0);P(this,ie,void 0);P(this,re,void 0);P(this,Ee,void 0);P(this,Lt,void 0);P(this,ci,void 0);P(this,ot,void 0);P(this,ne,void 0);U(this,z,new ec.DeepstreamClient(t)),U(this,Ot,`${e}-${r}`),U(this,Ut,`${E(this,Ot)}/${E(this,z).getUid()}`),U(this,ie,new Map),U(this,re,[]),U(this,Ee,[]),U(this,Lt,new _t(E(this,z),E(this,Ut))),U(this,ot,[]),U(this,ne,void 0),U(this,ci,It(this,lr,ic).call(this))}_isConnected(){return E(this,z).getConnectionState()==="OPEN"}get whenConnected(){return E(this,ci)}disconnect(){!this._isConnected()||E(this,z).close()}getRecord(t){return new _t(E(this,z),`${E(this,Ot)}/${t}`)}subscribe(t,e){E(this,z).event.subscribe(`${E(this,Ot)}/${t}`,e)}unsubscribe(t,e){E(this,z).event.unsubscribe(`${E(this,Ot)}/${t}`,e)}emit(t,e){(e===void 0||Ze(e,"emit-data"))&&E(this,z).event.emit(`${E(this,Ot)}/${t}`,e)}get hostName(){return E(this,ne)}get _guestNames(){return[...E(this,ot)]}get myGuestRecord(){return E(this,Lt)}get guestShareds(){return new Proxy(E(this,Ee),{set(){return L("The guestShared array is read-only."),!0}})}isHost(){return E(this,ne)===E(this,Ut)}};z=new WeakMap,Ot=new WeakMap,Ut=new WeakMap,ie=new WeakMap,re=new WeakMap,Ee=new WeakMap,Lt=new WeakMap,ci=new WeakMap,ot=new WeakMap,ne=new WeakMap,lr=new WeakSet,ic=function(){return(()=>st(this,null,function*(){E(this,z).on("error",(e,r,n)=>L("ds error",e,r,n)),E(this,z).presence.subscribe(It(this,fr,nc).bind(this)),yield E(this,z).login({username:E(this,Ut)}),E(this,Lt).load(),yield It(this,hr,rc).call(this),It(this,ai,En).call(this)}))()},hr=new WeakSet,rc=function(){return st(this,null,function*(){let t=yield E(this,z).presence.getAll();U(this,ot,t.filter(e=>e.startsWith(`${E(this,Ot)}/`)).concat(E(this,Ut)).sort()),U(this,ne,E(this,ot)[0])})},fr=new WeakSet,nc=function(t,e){!t.startsWith(`${E(this,Ot)}/`)||(e?(E(this,ot).push(t),E(this,ot).sort()):U(this,ot,E(this,ot).filter(r=>r!==t)),U(this,ne,E(this,ot)[0]),It(this,ai,En).call(this))},ai=new WeakSet,En=function(){let t=()=>{E(this,Ee).length=0;let e=E(this,re).filter(r=>!ir(r));E(this,Ee).push(...e)};for(let e of E(this,ot))if(!E(this,ie).has(e))if(e===E(this,Ut))E(this,ie).set(e,E(this,Lt)),E(this,Lt).whenLoaded.then(()=>{E(this,Lt).watchShared(t.bind(this),!0)});else{let r=new _t(E(this,z),e);E(this,ie).set(e,r),r.load().then(()=>{r.watchShared(t.bind(this),!0)})}E(this,re).length=0;for(let e of E(this,ot))if(e===E(this,Ut))E(this,re).push(E(this,Lt).shared);else{let r=E(this,ie).get(e);r&&E(this,re).push(r.shared)}t()};var V=window.p5;V?Gl():rt("p5.js not found.");function Gl(){let i=V.prototype.VERSION?`p5.js v${V.prototype.VERSION}`:"p5.js is older than 1.3.1";br("font-weight: bold",i),br("font-weight: bold",`p5.party v${Hn}`);let t=null;V.prototype.partyConnect=function(e,r,n,o){if(t!==null){rt("You should call partyConnect() only one time");return}(()=>st(this,null,function*(){t=new ur(e,r,n),yield t.whenConnected,window.addEventListener("beforeunload",()=>{t==null||t.disconnect()}),di("partyConnect done!"),this._decrementPreload(),o==null||o()}))()},V.prototype.registerPreloadMethod("partyConnect",V.prototype),V.prototype.registerPreloadMethod("partyLoadShared",V.prototype),V.prototype.partyLoadShared=function(e,r={},n){if(t===null){L("partyLoadShared() called before partyConnect()");return}let o=t.getRecord(e);return(()=>st(this,null,function*(){yield t==null?void 0:t.whenConnected,yield o.load(r),di(`partyLoadShared "${e}" done!`),n==null||n(o.shared),this._decrementPreload()}))(),o.shared},V.prototype.registerPreloadMethod("partyLoadMyShared",V.prototype),V.prototype.partyLoadMyShared=function(e={},r){if(t===null){L("partyLoadMyShared() called before partyConnect()");return}let n=t.myGuestRecord;return(()=>st(this,null,function*(){yield t==null?void 0:t.whenConnected,yield n.whenLoaded,yield n.initData(e),di("partyLoadMyShared done!"),r==null||r(n.shared),this._decrementPreload()}))(),n.shared},V.prototype.partyLoadGuestShareds=function(){if(t===null){L("partyLoadGuestShareds() called before partyConnect()");return}return t.guestShareds},V.prototype.partyLoadParticipantShareds=function(){if(rt("partyLoadParticipantShareds is deprecated. Use partyLoadGuestShareds instead."),t===null){L("partyLoadParticipantShareds() called before partyConnect()");return}return t.guestShareds},V.prototype.partyIsHost=function(){return t===null?(L("partyIsHost() called before partyConnect()"),!1):t.isHost()},V.prototype.partySetShared=function(e,r){var n;if(!_t.recordForShared(e)){rt("partySetShared() doesn't recognize the provided shared object.",e);return}(n=_t.recordForShared(e))==null||n.setData(r)},V.prototype.partyWatchShared=function(e,r,n,o){var s;if(!_t.recordForShared(e)){rt("partyWatchShared() doesn't recognize the provided shared object.",e);return}(s=_t.recordForShared(e))==null||s.watchShared(r,n,o)},V.prototype.partySubscribe=function(e,r){if(t===null){L("partySubscribe() called before partyConnect()");return}t.subscribe(e,r)},V.prototype.partyUnsubscribe=function(e,r){if(t===null){L("partyUnsubscribe() called before partyConnect()");return}t.unsubscribe(e,r)},V.prototype.partyEmit=function(e,r){if(t===null){L("partyEmit() called before partyConnect()");return}t.emit(e,r)},V.prototype.partyToggleInfo=function(){rt("partyToggleInfo is no longer available in this version of p5.party.")}}})();
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
//# sourceMappingURL=p5.party.js.map
